import{S as De,i as Se,s as qe,e as d,a as w,b as u,d as S,f as i,l as W,n as $,h as q,r as ee,t as L,z as H,x as Ce,j as fe,w as Fe,B as _e,y as Be,D as Oe}from"./index.4914e6e5.js";import{g as Ee,p as Ie}from"./index.3965b917.js";import{m as Ae}from"./controllers.49cfa159.js";import{x as Le,B as Te,o as Me,A as Pe,C as ze,D as Ne}from"./index.b561a64b.js";import Ue from"./FoodEntryModal.bc5081c8.js";import{a as We,s as je}from"./alert.d06707d0.js";import{S as He}from"./supabase.data.service.fab7ecff.js";import{S as Re}from"./supabase.auth.service.b8e2aee0.js";import"./overlays-ab6211c7.e7d97763.js";import"./FoodSearchModal.4fa2c477.js";import"./BehaviorSubject.59e5b4b7.js";import"./network.service.65f4e909.js";function ue(n,o,e){const s=n.slice();return s[22]=o[e],s[24]=e,s}function pe(n){let o,e,s,r,a,l,m;return{c(){o=d("ion-button"),e=d("ion-icon"),s=w(),r=d("ion-button"),a=d("ion-icon"),u(e,"slot","icon-only"),u(e,"icon",Le),u(a,"slot","icon-only"),u(a,"icon",Te)},m(c,p){S(c,o,p),i(o,e),S(c,s,p),S(c,r,p),i(r,a),l||(m=[W(o,"click",n[5]),W(r,"click",n[11])],l=!0)},p:$,d(c){c&&q(o),c&&q(s),c&&q(r),l=!1,ee(m)}}}function me(n){let o,e,s,r,a,l,m;return{c(){o=d("ion-button"),e=d("ion-icon"),s=w(),r=d("ion-button"),a=d("ion-icon"),u(e,"slot","icon-only"),u(e,"icon",Me),u(a,"slot","icon-only"),u(a,"icon",Pe)},m(c,p){S(c,o,p),i(o,e),S(c,s,p),S(c,r,p),i(r,a),l||(m=[W(o,"click",n[12]),W(r,"click",n[13])],l=!0)},p:$,d(c){c&&q(o),c&&q(s),c&&q(r),l=!1,ee(m)}}}function be(n){var te,oe,le,ie,ne;let o,e,s,r,a=(((te=n[2])==null?void 0:te.food_total)||0).toFixed(2)+"",l,m,c,p,t,_,B,F,T,b,y,g,k,D,P,K,R,G,Q,f,h,M=new Date((oe=n[2])==null?void 0:oe.created_at).toLocaleDateString()+"",z,N,J=new Date((le=n[2])==null?void 0:le.created_at).toLocaleTimeString()+"",V,Y,j,Z,X,x,C=n[1]==="view"&&ge(n),O=n[1]==="edit"&&ye(n),E=n[1]==="view"&&ke(n),I=n[1]==="edit"&&he(n),A=((ne=(ie=n[2])==null?void 0:ie.food_log)==null?void 0:ne.entries)&&ve(n);return{c(){o=d("ion-card"),e=d("ion-card-header"),s=d("ion-card-subtitle"),r=L("Total: "),l=L(a),m=w(),c=d("ion-card-title"),C&&C.c(),p=w(),O&&O.c(),t=w(),_=d("ion-card-content"),E&&E.c(),B=w(),I&&I.c(),F=w(),T=d("br"),b=w(),y=d("ion-list"),g=d("ion-reorder-group"),A&&A.c(),k=w(),D=d("ion-item"),P=d("ion-icon"),K=L(`
						add new entry`),R=w(),G=d("br"),Q=w(),f=d("br"),h=L(`
				created: `),z=L(M),N=w(),V=L(J),Y=d("br"),j=w(),Z=d("br"),u(g,"id","food_log_group"),u(g,"disabled","false"),u(P,"icon",ze),u(P,"slot","start"),u(y,"lines","full")},m(v,U){S(v,o,U),i(o,e),i(e,s),i(s,r),i(s,l),i(e,m),i(e,c),C&&C.m(c,null),i(c,p),O&&O.m(c,null),i(o,t),i(o,_),E&&E.m(_,null),i(_,B),I&&I.m(_,null),i(_,F),i(_,T),i(_,b),i(_,y),i(y,g),A&&A.m(g,null),i(y,k),i(y,D),i(D,P),i(D,K),i(_,R),i(_,G),i(_,Q),i(_,f),i(_,h),i(_,z),i(_,N),i(_,V),i(_,Y),i(_,j),i(_,Z),X||(x=[W(g,"ionItemReorder",n[9]),W(D,"click",n[7])],X=!0)},p(v,U){var se,re,ae,ce,de;U&4&&a!==(a=(((se=v[2])==null?void 0:se.food_total)||0).toFixed(2)+"")&&H(l,a),v[1]==="view"?C?C.p(v,U):(C=ge(v),C.c(),C.m(c,p)):C&&(C.d(1),C=null),v[1]==="edit"?O?O.p(v,U):(O=ye(v),O.c(),O.m(c,null)):O&&(O.d(1),O=null),v[1]==="view"?E?E.p(v,U):(E=ke(v),E.c(),E.m(_,B)):E&&(E.d(1),E=null),v[1]==="edit"?I?I.p(v,U):(I=he(v),I.c(),I.m(_,F)):I&&(I.d(1),I=null),(ae=(re=v[2])==null?void 0:re.food_log)!=null&&ae.entries?A?A.p(v,U):(A=ve(v),A.c(),A.m(g,null)):A&&(A.d(1),A=null),U&4&&M!==(M=new Date((ce=v[2])==null?void 0:ce.created_at).toLocaleDateString()+"")&&H(z,M),U&4&&J!==(J=new Date((de=v[2])==null?void 0:de.created_at).toLocaleTimeString()+"")&&H(V,J)},d(v){v&&q(o),C&&C.d(),O&&O.d(),E&&E.d(),I&&I.d(),A&&A.d(),X=!1,ee(x)}}}function ge(n){var s;let o=((s=n[2])==null?void 0:s.date)+"",e;return{c(){e=L(o)},m(r,a){S(r,e,a)},p(r,a){var l;a&4&&o!==(o=((l=r[2])==null?void 0:l.date)+"")&&H(e,o)},d(r){r&&q(e)}}}function ye(n){let o,e,s,r,a;return{c(){o=d("ion-label"),o.textContent="Date:",e=d("ion-input"),u(o,"class","svelte-8l8qbx"),u(e,"value",s=n[2].date),u(e,"required",""),u(e,"name","date"),u(e,"type","text"),u(e,"class","svelte-8l8qbx")},m(l,m){S(l,o,m),S(l,e,m),r||(a=W(e,"ionChange",n[3]),r=!0)},p(l,m){m&4&&s!==(s=l[2].date)&&u(e,"value",s)},d(l){l&&q(o),l&&q(e),r=!1,a()}}}function ke(n){var s;let o=((s=n[2])==null?void 0:s.notes)+"",e;return{c(){e=L(o)},m(r,a){S(r,e,a)},p(r,a){var l;a&4&&o!==(o=((l=r[2])==null?void 0:l.notes)+"")&&H(e,o)},d(r){r&&q(e)}}}function he(n){let o,e,s,r,a;return{c(){o=d("ion-label"),o.textContent="Notes:",e=d("ion-input"),u(o,"class","svelte-8l8qbx"),u(e,"value",s=n[2].notes),u(e,"required",""),u(e,"name","notes"),u(e,"type","text"),u(e,"class","svelte-8l8qbx")},m(l,m){S(l,o,m),S(l,e,m),r||(a=W(e,"ionChange",n[3]),r=!0)},p(l,m){m&4&&s!==(s=l[2].notes)&&u(e,"value",s)},d(l){l&&q(o),l&&q(e),r=!1,a()}}}function ve(n){var r,a;let o,e=(a=(r=n[2])==null?void 0:r.food_log)==null?void 0:a.entries,s=[];for(let l=0;l<e.length;l+=1)s[l]=we(ue(n,e,l));return{c(){for(let l=0;l<s.length;l+=1)s[l].c();o=Ce()},m(l,m){for(let c=0;c<s.length;c+=1)s[c].m(l,m);S(l,o,m)},p(l,m){var c,p;if(m&260){e=(p=(c=l[2])==null?void 0:c.food_log)==null?void 0:p.entries;let t;for(t=0;t<e.length;t+=1){const _=ue(l,e,t);s[t]?s[t].p(_,m):(s[t]=we(_),s[t].c(),s[t].m(o.parentNode,o))}for(;t<s.length;t+=1)s[t].d(1);s.length=e.length}},d(l){Fe(s,l),l&&q(o)}}}function we(n){var z,N,J,V;let o,e,s,r,a=((z=n[22])==null?void 0:z.title)+"",l,m,c,p,t=(((N=n[22])==null?void 0:N.desc)||"")+"",_,B,F,T,b,y=(((J=n[22])==null?void 0:J.amt)||0).toFixed(2)+"",g,k,D,P,K,R=(((V=n[22])==null?void 0:V.cat)||"")+"",G,Q,f,h;function M(){return n[14](n[24])}return{c(){o=d("ion-item"),e=d("ion-reorder"),s=w(),r=d("div"),l=L(a),m=d("br"),c=w(),p=d("span"),_=L(t),B=L("\xA0"),F=w(),T=d("ion-note"),b=d("div"),g=L(y),k=d("br"),D=w(),P=d("span"),K=L("\xA0"),G=L(R),Q=w(),u(e,"slot","start"),fe(p,"class","description svelte-8l8qbx"),fe(P,"class","description svelte-8l8qbx"),u(T,"slot","end"),u(T,"class","right svelte-8l8qbx")},m(Y,j){S(Y,o,j),i(o,e),i(o,s),i(o,r),i(r,l),i(r,m),i(r,c),i(r,p),i(p,_),i(p,B),i(o,F),i(o,T),i(T,b),i(b,g),i(b,k),i(b,D),i(b,P),i(P,K),i(P,G),i(o,Q),f||(h=W(o,"click",M),f=!0)},p(Y,j){var Z,X,x,C;n=Y,j&4&&a!==(a=((Z=n[22])==null?void 0:Z.title)+"")&&H(l,a),j&4&&t!==(t=(((X=n[22])==null?void 0:X.desc)||"")+"")&&H(_,t),j&4&&y!==(y=(((x=n[22])==null?void 0:x.amt)||0).toFixed(2)+"")&&H(g,y),j&4&&R!==(R=(((C=n[22])==null?void 0:C.cat)||"")+"")&&H(G,R)},d(Y){Y&&q(o),f=!1,h()}}}function Ye(n){let o,e,s,r,a,l,m,c,p,t,_,B,F,T,b=n[1]==="view"&&pe(n),y=n[1]==="edit"&&me(n),g=n[2]&&be(n);return{c(){o=d("ion-header"),e=d("ion-toolbar"),s=d("ion-buttons"),r=d("ion-button"),a=d("ion-icon"),l=w(),m=d("ion-title"),m.textContent="Day",c=w(),p=d("ion-buttons"),b&&b.c(),t=w(),y&&y.c(),_=w(),B=d("ion-content"),g&&g.c(),u(a,"slot","icon-only"),u(a,"icon",Ne),u(s,"slot","start"),u(p,"slot","end"),u(o,"translucent","true"),u(B,"class","ion-padding")},m(k,D){S(k,o,D),i(o,e),i(e,s),i(s,r),i(r,a),i(e,l),i(e,m),i(e,c),i(e,p),b&&b.m(p,null),i(p,t),y&&y.m(p,null),S(k,_,D),S(k,B,D),g&&g.m(B,null),F||(T=W(r,"click",n[10]),F=!0)},p(k,[D]){k[1]==="view"?b?b.p(k,D):(b=pe(k),b.c(),b.m(p,t)):b&&(b.d(1),b=null),k[1]==="edit"?y?y.p(k,D):(y=me(k),y.c(),y.m(p,null)):y&&(y.d(1),y=null),k[2]?g?g.p(k,D):(g=be(k),g.c(),g.m(B,null)):g&&(g.d(1),g=null)},i:$,o:$,d(k){k&&q(o),b&&b.d(),y&&y.d(),k&&q(_),k&&q(B),g&&g.d(),F=!1,T()}}}function Ge(n,o,e){let s,r;_e(n,Ee,f=>e(18,s=f)),_e(n,Ie,f=>e(19,r=f));const a=He.getInstance();let l=null,m,c=r.id,p="view",t={};console.log("*** id",c);let _;c==="new"?(console.log("it is new"),t={id:a.gen_random_uuid(),user_id:(l==null?void 0:l.id)||null,created_at:new Date().toISOString(),date:new Date().toISOString().substring(0,10),food_log:{entries:[]},activity_log:{entries:[]},water_log:{entries:[]},weight:0,notes:""},p="edit",console.log("*** new day",t)):_=a.getDataSubscription("day",{id:c}).subscribe(f=>{e(2,t=f),console.log("*** day",t)}),Be(()=>{m=Re.user.subscribe(f=>{l=f})}),Oe(()=>{try{_.unsubscribe(),m.unsubscribe()}catch(f){console.error("error unsubscribing",f)}});const B=f=>{if(typeof t[f.target.name]=="number")try{e(2,t[f.target.name]=parseFloat(f.target.value),t)}catch{e(2,t[f.target.name]=0,t)}else e(2,t[f.target.name]=f.target.value,t)},F=async()=>{console.log("save the day",t),t.user_id||e(2,t.user_id=l.id,t);try{e(2,t.food_total=0,t),t.food_log.entries.forEach(h=>{e(2,t.food_total+=h.amt,t)})}catch(h){console.error("error calculating food total",h)}const{error:f}=await a.save_day(t);f?(console.log("error message is: ",f.message),f.message.startsWith("duplicate key value violates unique constraint")?(console.log("DUPLICATE DAY"),We({header:"Duplicate Day",message:"This day already exists.  Please edit the existing day."})):console.error("save day error",f)):(e(0,c=t.id),e(1,p="view"))},T=async()=>{await je({header:"Delete Day",message:"Are you sure?",okHander:async()=>{const{data:f,error:h}=await a.delete_day(t);h?console.error("Error deleting day",h):b()}})},b=()=>{s("/days")},y=async f=>{t.food_log.entries||e(2,t.food_log.entries=[],t);const h={id:a.gen_random_uuid(),food_id:"",title:"",desc:"",cat:"",cps:0,qty:1,amt:0,created:new Date().toISOString()},M=await D(h,t.food_log.entries.length,!0);console.log("done calling openFoodEntryBox",M),console.log("day.food_log.entries",t.food_log.entries),e(2,t.food_log.entries=[...t.food_log.entries],t),F()},g=async f=>{const h=await D(t.food_log.entries[f],f,!1);console.log("edit_food_log_entry is done calling openFoodEntryBox",h),console.log("day.food_log.entries",t.food_log.entries),e(2,t.food_log.entries=[...t.food_log.entries],t),F()},k=({detail:f})=>{const{from:h,to:M}=f,z=t.food_log.entries.splice(h,1)[0];t.food_log.entries.splice(M,0,z),f.complete(),console.log("reorder_food_log: day",t),F()},D=async(f,h,M)=>{const z=await Ae.create({component:Ue,componentProps:{entry:f,isNew:M},showBackdrop:!0,backdropDismiss:!0});await z.present();const{data:N}=await z.onWillDismiss();return(N==null?void 0:N.data)!==null?(N.data.deleted?t.food_log.entries.splice(h,1):e(2,t.food_log.entries[h]=N.data,t),console.log("*** day.food_log.entries",t.food_log.entries),!0):!1};return[c,p,t,B,F,T,b,y,g,k,()=>{b()},()=>{e(1,p="edit")},()=>{e(1,p="view"),c==="add"&&b()},()=>{F()},f=>{g(f)}]}class it extends De{constructor(o){super(),Se(this,o,Ge,Ye,qe,{})}}export{it as default};
