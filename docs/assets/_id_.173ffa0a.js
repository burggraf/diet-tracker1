import{S as uo,i as bo,s as go,b as t,c as p,d as _,a as S,f as e,l as N,H as ve,g as C,v as Te,t as O,j as fe,k as X,o as R,e as mo,u as po,w as Oe,x as vo,z as wo}from"./index.96f83d63.js";import{g as ho,p as yo}from"./index.032b7884.js";import{m as ko}from"./controllers.d245880a.js";import{y as Do,C as So,r as Co,B as Fo,D as eo,E as Oo,F as To}from"./index.f1a9933f.js";import Bo from"./FoodEntryModal.0d9b5fde.js";import{a as Io,s as zo}from"./alert.5e81abcc.js";import{S as Eo,U as Wo}from"./supabase.data.service.83cdb649.js";import{c as No}from"./user.store.362cd591.js";import"./overlays-ab6211c7.484f3bb7.js";import"./FoodSearchModal.d92c1f52.js";import"./BehaviorSubject.c6630b10.js";import"./loadingMessage.74ebf756.js";function to(i,n,o){const s=i.slice();return s[26]=n[o],s[28]=o,s}function oo(i){let n,o,s,a,f,r,d;return{c(){n=t("ion-button"),o=t("ion-icon"),s=p(),a=t("ion-button"),f=t("ion-icon"),_(o,"slot","icon-only"),_(o,"icon",Do),_(f,"slot","icon-only"),_(f,"icon",So)},m(u,l){S(u,n,l),e(n,o),S(u,s,l),S(u,a,l),e(a,f),r||(d=[N(n,"click",i[6]),N(a,"click",i[16])],r=!0)},p:ve,d(u){u&&C(n),u&&C(s),u&&C(a),r=!1,Te(d)}}}function lo(i){let n,o,s,a,f,r,d;return{c(){n=t("ion-button"),o=t("ion-icon"),s=p(),a=t("ion-button"),f=t("ion-icon"),_(o,"slot","icon-only"),_(o,"icon",Co),_(f,"slot","icon-only"),_(f,"icon",Fo)},m(u,l){S(u,n,l),e(n,o),S(u,s,l),S(u,a,l),e(a,f),r||(d=[N(n,"click",i[17]),N(a,"click",i[18])],r=!0)},p:ve,d(u){u&&C(n),u&&C(s),u&&C(a),r=!1,Te(d)}}}function io(i){var Mt,Pt,Ht,Vt,jt,Rt,Yt;let n,o,s,a,f,r,d,u=(((Mt=i[2])==null?void 0:Mt.food_total)||0).toFixed(2)+"",l,v,D,F,T,B,y,g,k,h,E,Y,V,L,x,K,Q,te,re,b,w,W,G,I=new Date((Pt=i[2])==null?void 0:Pt.created_at).toLocaleDateString()+"",J,se,$=new Date((Ht=i[2])==null?void 0:Ht.created_at).toLocaleTimeString()+"",oe,ae,Be,Ie,we,c,he,ye,ke,ce,De,le,_e,ze,ue,j,be,Ee,Se,ie,ge,We,Z,ee,me,Ne,ne,Le,pe=(i[2].water_total||0)+"",Ce,qe,Ue,de,Ae,Me,Pe,He,Ve,je,Re,Ye,Ge,Je,Ke,Qe,Xe,Ze,xe,$e,et,tt,ot,lt,it,nt,rt,st,at,ct,dt,ft,_t,ut,bt,gt,mt,pt,vt,wt,ht,yt,kt,Dt,St,Ct,Ft,Ot,Tt,Bt,It,zt,Et,Wt,Nt,Lt,qt,Ut,Fe,At,q=((jt=(Vt=i[3])==null?void 0:Vt.user_metadata)==null?void 0:jt.daily_budget)&&no(i),U=i[1]==="view"&&ro(i),A=i[1]==="edit"&&so(i),M=i[1]==="view"&&ao(i),P=i[1]==="edit"&&co(i),H=((Yt=(Rt=i[2])==null?void 0:Rt.food_log)==null?void 0:Yt.entries)&&fo(i);return{c(){var m;n=t("ion-card"),o=t("ion-card-header"),s=t("ion-card-subtitle"),a=t("ion-grid"),f=t("ion-row"),r=t("ion-col"),d=O("Total: "),l=O(u),v=p(),D=t("ion-col"),q&&q.c(),F=p(),T=t("ion-card-title"),U&&U.c(),B=p(),A&&A.c(),y=p(),g=t("ion-card-content"),M&&M.c(),k=p(),P&&P.c(),h=p(),E=t("br"),Y=p(),V=t("ion-list"),L=t("ion-reorder-group"),H&&H.c(),x=p(),K=t("ion-item"),Q=t("ion-icon"),te=O(`
						new food entry`),re=p(),b=t("br"),w=p(),W=t("br"),G=O(`
				created: `),J=O(I),se=p(),oe=O($),ae=t("br"),Be=p(),Ie=t("br"),we=p(),c=t("ion-footer"),he=t("ion-card"),ye=t("ion-card-content"),ke=t("ion-grid"),ce=t("ion-row"),De=t("ion-col"),le=t("div"),_e=t("div"),_e.textContent="Weight",ze=p(),ue=t("div"),j=t("ion-input"),Ee=p(),Se=t("ion-col"),ie=t("div"),ge=t("div"),ge.textContent="Water",We=p(),Z=t("div"),ee=t("ion-icon"),Ne=p(),ne=t("span"),Le=O("\xA0"),Ce=O(pe),qe=O("\xA0"),Ue=p(),de=t("ion-icon"),Ae=p(),Me=t("br"),Pe=t("br"),He=t("br"),Ve=t("br"),je=t("br"),Re=t("br"),Ye=t("br"),Ge=t("br"),Je=t("br"),Ke=t("br"),Qe=t("br"),Xe=t("br"),Ze=t("br"),xe=t("br"),$e=t("br"),et=t("br"),tt=t("br"),ot=p(),lt=t("br"),it=t("br"),nt=t("br"),rt=t("br"),st=t("br"),at=t("br"),ct=t("br"),dt=t("br"),ft=t("br"),_t=t("br"),ut=t("br"),bt=t("br"),gt=t("br"),mt=t("br"),pt=t("br"),vt=t("br"),wt=t("br"),ht=p(),yt=t("br"),kt=t("br"),Dt=t("br"),St=t("br"),Ct=t("br"),Ft=t("br"),Ot=t("br"),Tt=t("br"),Bt=t("br"),It=t("br"),zt=t("br"),Et=t("br"),Wt=t("br"),Nt=t("br"),Lt=t("br"),qt=t("br"),Ut=t("br"),fe(r,"text-align","left"),fe(r,"font-weight","bold"),fe(D,"text-align","right"),fe(D,"font-weight","bold"),fe(T,"text-align","center"),_(L,"id","food_log_group"),_(L,"disabled","false"),_(Q,"icon",eo),_(Q,"slot","start"),_(V,"lines","full"),X(_e,"class","footertitle svelte-15ns3sv"),_(j,"name","weight"),_(j,"class","weightBox svelte-15ns3sv"),_(j,"type","decimal"),_(j,"inputmode","decimal"),_(j,"value",be=(m=i[2])==null?void 0:m.weight),X(ue,"class","footertitle svelte-15ns3sv"),X(le,"class","left svelte-15ns3sv"),X(ge,"class","footertitle svelte-15ns3sv"),_(ee,"color",me=i[2].water_total<=0?"medium":"dark"),_(ee,"icon",Oo),_(ee,"size","large"),X(ne,"class","water-digits svelte-15ns3sv"),_(de,"icon",eo),_(de,"size","large"),X(Z,"class","footertitle together svelte-15ns3sv"),X(ie,"class","right svelte-15ns3sv")},m(m,z){S(m,n,z),e(n,o),e(o,s),e(s,a),e(a,f),e(f,r),e(r,d),e(r,l),e(f,v),e(f,D),q&&q.m(D,null),e(o,F),e(o,T),U&&U.m(T,null),e(T,B),A&&A.m(T,null),e(n,y),e(n,g),M&&M.m(g,null),e(g,k),P&&P.m(g,null),e(g,h),e(g,E),e(g,Y),e(g,V),e(V,L),H&&H.m(L,null),e(V,x),e(V,K),e(K,Q),e(K,te),e(g,re),e(g,b),e(g,w),e(g,W),e(g,G),e(g,J),e(g,se),e(g,oe),e(g,ae),e(g,Be),e(g,Ie),S(m,we,z),S(m,c,z),e(c,he),e(he,ye),e(ye,ke),e(ke,ce),e(ce,De),e(De,le),e(le,_e),e(le,ze),e(le,ue),e(ue,j),e(ce,Ee),e(ce,Se),e(Se,ie),e(ie,ge),e(ie,We),e(ie,Z),e(Z,ee),e(Z,Ne),e(Z,ne),e(ne,Le),e(ne,Ce),e(ne,qe),e(Z,Ue),e(Z,de),e(c,Ae),e(c,Me),e(c,Pe),e(c,He),e(c,Ve),e(c,je),e(c,Re),e(c,Ye),e(c,Ge),e(c,Je),e(c,Ke),e(c,Qe),e(c,Xe),e(c,Ze),e(c,xe),e(c,$e),e(c,et),e(c,tt),e(c,ot),e(c,lt),e(c,it),e(c,nt),e(c,rt),e(c,st),e(c,at),e(c,ct),e(c,dt),e(c,ft),e(c,_t),e(c,ut),e(c,bt),e(c,gt),e(c,mt),e(c,pt),e(c,vt),e(c,wt),e(c,ht),e(c,yt),e(c,kt),e(c,Dt),e(c,St),e(c,Ct),e(c,Ft),e(c,Ot),e(c,Tt),e(c,Bt),e(c,It),e(c,zt),e(c,Et),e(c,Wt),e(c,Nt),e(c,Lt),e(c,qt),e(c,Ut),Fe||(At=[N(L,"ionItemReorder",i[10]),N(K,"click",i[8]),N(j,"ionChange",i[13]),N(j,"ionFocus",qo),N(j,"ionBlur",i[14]),N(ee,"click",i[12]),N(de,"click",i[11])],Fe=!0)},p(m,z){var Gt,Jt,Kt,Qt,Xt,Zt,xt,$t;z&4&&u!==(u=(((Gt=m[2])==null?void 0:Gt.food_total)||0).toFixed(2)+"")&&R(l,u),(Kt=(Jt=m[3])==null?void 0:Jt.user_metadata)!=null&&Kt.daily_budget?q?q.p(m,z):(q=no(m),q.c(),q.m(D,null)):q&&(q.d(1),q=null),m[1]==="view"?U?U.p(m,z):(U=ro(m),U.c(),U.m(T,B)):U&&(U.d(1),U=null),m[1]==="edit"?A?A.p(m,z):(A=so(m),A.c(),A.m(T,null)):A&&(A.d(1),A=null),m[1]==="view"?M?M.p(m,z):(M=ao(m),M.c(),M.m(g,k)):M&&(M.d(1),M=null),m[1]==="edit"?P?P.p(m,z):(P=co(m),P.c(),P.m(g,h)):P&&(P.d(1),P=null),(Xt=(Qt=m[2])==null?void 0:Qt.food_log)!=null&&Xt.entries?H?H.p(m,z):(H=fo(m),H.c(),H.m(L,null)):H&&(H.d(1),H=null),z&4&&I!==(I=new Date((Zt=m[2])==null?void 0:Zt.created_at).toLocaleDateString()+"")&&R(J,I),z&4&&$!==($=new Date((xt=m[2])==null?void 0:xt.created_at).toLocaleTimeString()+"")&&R(oe,$),z&4&&be!==(be=($t=m[2])==null?void 0:$t.weight)&&_(j,"value",be),z&4&&me!==(me=m[2].water_total<=0?"medium":"dark")&&_(ee,"color",me),z&4&&pe!==(pe=(m[2].water_total||0)+"")&&R(Ce,pe)},d(m){m&&C(n),q&&q.d(),U&&U.d(),A&&A.d(),M&&M.d(),P&&P.d(),H&&H.d(),m&&C(we),m&&C(c),Fe=!1,Te(At)}}}function no(i){var a,f,r;let n,o=(((f=(a=i[3])==null?void 0:a.user_metadata)==null?void 0:f.daily_budget)-((r=i[2])==null?void 0:r.food_total)||0).toFixed(2)+"",s;return{c(){n=O("Left: "),s=O(o)},m(d,u){S(d,n,u),S(d,s,u)},p(d,u){var l,v,D;u&12&&o!==(o=(((v=(l=d[3])==null?void 0:l.user_metadata)==null?void 0:v.daily_budget)-((D=d[2])==null?void 0:D.food_total)||0).toFixed(2)+"")&&R(s,o)},d(d){d&&C(n),d&&C(s)}}}function ro(i){var s,a;let n=new Date(new Date((s=i[2])==null?void 0:s.date).getTime()+new Date((a=i[2])==null?void 0:a.date).getTimezoneOffset()*6e4).toDateString()+"",o;return{c(){o=O(n)},m(f,r){S(f,o,r)},p(f,r){var d,u;r&4&&n!==(n=new Date(new Date((d=f[2])==null?void 0:d.date).getTime()+new Date((u=f[2])==null?void 0:u.date).getTimezoneOffset()*6e4).toDateString()+"")&&R(o,n)},d(f){f&&C(o)}}}function so(i){let n,o,s,a,f;return{c(){n=t("ion-label"),n.textContent="Date:",o=t("ion-input"),_(n,"class","svelte-15ns3sv"),_(o,"value",s=i[2].date),_(o,"required",""),_(o,"name","date"),_(o,"type","text"),_(o,"class","svelte-15ns3sv")},m(r,d){S(r,n,d),S(r,o,d),a||(f=N(o,"ionChange",i[4]),a=!0)},p(r,d){d&4&&s!==(s=r[2].date)&&_(o,"value",s)},d(r){r&&C(n),r&&C(o),a=!1,f()}}}function ao(i){var s;let n=((s=i[2])==null?void 0:s.notes)+"",o;return{c(){o=O(n)},m(a,f){S(a,o,f)},p(a,f){var r;f&4&&n!==(n=((r=a[2])==null?void 0:r.notes)+"")&&R(o,n)},d(a){a&&C(o)}}}function co(i){let n,o,s,a,f;return{c(){n=t("ion-label"),n.textContent="Notes:",o=t("ion-input"),_(n,"class","svelte-15ns3sv"),_(o,"value",s=i[2].notes),_(o,"required",""),_(o,"name","notes"),_(o,"type","text"),_(o,"class","svelte-15ns3sv")},m(r,d){S(r,n,d),S(r,o,d),a||(f=N(o,"ionChange",i[4]),a=!0)},p(r,d){d&4&&s!==(s=r[2].notes)&&_(o,"value",s)},d(r){r&&C(n),r&&C(o),a=!1,f()}}}function fo(i){var a,f;let n,o=(f=(a=i[2])==null?void 0:a.food_log)==null?void 0:f.entries,s=[];for(let r=0;r<o.length;r+=1)s[r]=_o(to(i,o,r));return{c(){for(let r=0;r<s.length;r+=1)s[r].c();n=mo()},m(r,d){for(let u=0;u<s.length;u+=1)s[u].m(r,d);S(r,n,d)},p(r,d){var u,l;if(d&516){o=(l=(u=r[2])==null?void 0:u.food_log)==null?void 0:l.entries;let v;for(v=0;v<o.length;v+=1){const D=to(r,o,v);s[v]?s[v].p(D,d):(s[v]=_o(D),s[v].c(),s[v].m(n.parentNode,n))}for(;v<s.length;v+=1)s[v].d(1);s.length=o.length}},d(r){po(s,r),r&&C(n)}}}function _o(i){var b,w,W,G;let n,o,s,a,f=((b=i[26])==null?void 0:b.title)+"",r,d,u,l,v=(((w=i[26])==null?void 0:w.desc)||"")+"",D,F,T,B,y,g=(((W=i[26])==null?void 0:W.amt)||0).toFixed(2)+"",k,h,E,Y,V,L=(((G=i[26])==null?void 0:G.cat)||"")+"",x,K,Q,te;function re(){return i[19](i[28])}return{c(){n=t("ion-item"),o=t("ion-reorder"),s=p(),a=t("div"),r=O(f),d=t("br"),u=p(),l=t("span"),D=O(v),F=O("\xA0"),T=p(),B=t("ion-note"),y=t("div"),k=O(g),h=t("br"),E=p(),Y=t("span"),V=O("\xA0"),x=O(L),K=p(),_(o,"slot","start"),X(l,"class","description svelte-15ns3sv"),X(Y,"class","description svelte-15ns3sv"),_(B,"slot","end"),_(B,"class","right svelte-15ns3sv")},m(I,J){S(I,n,J),e(n,o),e(n,s),e(n,a),e(a,r),e(a,d),e(a,u),e(a,l),e(l,D),e(l,F),e(n,T),e(n,B),e(B,y),e(y,k),e(y,h),e(y,E),e(y,Y),e(Y,V),e(Y,x),e(n,K),Q||(te=N(n,"click",re),Q=!0)},p(I,J){var se,$,oe,ae;i=I,J&4&&f!==(f=((se=i[26])==null?void 0:se.title)+"")&&R(r,f),J&4&&v!==(v=((($=i[26])==null?void 0:$.desc)||"")+"")&&R(D,v),J&4&&g!==(g=(((oe=i[26])==null?void 0:oe.amt)||0).toFixed(2)+"")&&R(k,g),J&4&&L!==(L=(((ae=i[26])==null?void 0:ae.cat)||"")+"")&&R(x,L)},d(I){I&&C(n),Q=!1,te()}}}function Lo(i){let n,o,s,a,f,r,d,u,l,v,D,F,T,B,y=i[1]==="view"&&oo(i),g=i[1]==="edit"&&lo(i),k=i[2]&&io(i);return{c(){n=t("ion-header"),o=t("ion-toolbar"),s=t("ion-buttons"),a=t("ion-button"),f=t("ion-icon"),r=p(),d=t("ion-title"),d.textContent="Day",u=p(),l=t("ion-buttons"),y&&y.c(),v=p(),g&&g.c(),D=p(),F=t("ion-content"),k&&k.c(),_(f,"slot","icon-only"),_(f,"icon",To),_(s,"slot","start"),_(l,"slot","end"),_(n,"translucent","true"),_(F,"class","ion-padding")},m(h,E){S(h,n,E),e(n,o),e(o,s),e(s,a),e(a,f),e(o,r),e(o,d),e(o,u),e(o,l),y&&y.m(l,null),e(l,v),g&&g.m(l,null),S(h,D,E),S(h,F,E),k&&k.m(F,null),T||(B=N(a,"click",i[15]),T=!0)},p(h,[E]){h[1]==="view"?y?y.p(h,E):(y=oo(h),y.c(),y.m(l,v)):y&&(y.d(1),y=null),h[1]==="edit"?g?g.p(h,E):(g=lo(h),g.c(),g.m(l,null)):g&&(g.d(1),g=null),h[2]?k?k.p(h,E):(k=io(h),k.c(),k.m(F,null)):k&&(k.d(1),k=null)},i:ve,o:ve,d(h){h&&C(n),y&&y.d(),g&&g.d(),h&&C(D),h&&C(F),k&&k.d(),T=!1,B()}}}function qo(i){console.log("event.target.scrollTop",i.target.scrollTop),i.target.scrollTop=0;try{(parseFloat(i.target.value)||0)===0&&(i.target.value="")}catch(n){console.error("error clearing zero value",n)}}function Uo(i,n,o){let s,a,f;Oe(i,ho,b=>o(21,s=b)),Oe(i,No,b=>o(3,a=b)),Oe(i,yo,b=>o(22,f=b));const r=Eo.getInstance();Wo.getInstance();let d=f.id,u="view",l={};console.log("*** id",d);let v;d==="new"?(console.log("it is new"),l={id:r.gen_random_uuid(),user_id:(a==null?void 0:a.id)||null,created_at:new Date().toISOString(),date:new Date().toISOString().substring(0,10),food_log:{entries:[]},food_total:0,activity_log:{entries:[]},water_log:{entries:[]},water_total:0,weight:0,notes:""},u="edit",console.log("*** new day",l)):v=r.getDataSubscription("day",{id:d}).subscribe(b=>{o(2,l=b),console.log("*** day",l)}),vo(async()=>{if(!a){s("/info");return}if(d==="new")try{const{data:b,error:w}=await r.getCurrentWeight();w?(console.error("getCurrentWeight error",w),o(2,l.weight=0,l)):o(2,l.weight=b.weight,l)}catch(b){console.log("exception",b),o(2,l.weight=0,l)}}),wo(()=>{try{v&&v.unsubscribe()}catch(b){console.error("error unsubscribing",b)}});const D=b=>{if(typeof l[b.target.name]=="number")try{o(2,l[b.target.name]=parseFloat(b.target.value),l)}catch{o(2,l[b.target.name]=0,l)}else o(2,l[b.target.name]=b.target.value,l)},F=async()=>{let b=!1;d==="new"&&(b=!0),l.user_id||o(2,l.user_id=a.id,l);try{o(2,l.food_total=0,l),l.food_log.entries.forEach(W=>{o(2,l.food_total+=W.amt,l)})}catch(W){console.error("error calculating food total",W)}const{error:w}=await r.save_day(l);w?(console.log("error message is: ",w.message),w.message.startsWith("duplicate key value violates unique constraint")?(console.log("DUPLICATE DAY"),Io({header:"Duplicate Day",message:"This day already exists.  Please edit the existing day."})):console.error("save day error",w)):(o(0,d=l.id),o(1,u="view")),b&&(console.log("*** day is new, redirect to","/day/"+l.id),s("/day/"+l.id))},T=async()=>{await zo({header:"Delete Day",message:"Are you sure?",okHander:async()=>{const{data:b,error:w}=await r.delete_day(l);w?console.error("Error deleting day",w):B()}})},B=()=>{s("/calendar")},y=async b=>{l.food_log.entries||o(2,l.food_log.entries=[],l);const w={id:r.gen_random_uuid(),food_id:"",title:"",desc:"",cat:"",cps:0,qty:1,amt:0,created:new Date().toISOString()},W=await h(w,l.food_log.entries.length,!0);console.log("done calling openFoodEntryBox",W),console.log("day.food_log.entries",l.food_log.entries),o(2,l.food_log.entries=[...l.food_log.entries],l),F()},g=async b=>{const w=await h(l.food_log.entries[b],b,!1);console.log("edit_food_log_entry is done calling openFoodEntryBox",w),console.log("day.food_log.entries",l.food_log.entries),o(2,l.food_log.entries=[...l.food_log.entries],l),F()},k=({detail:b})=>{const{from:w,to:W}=b,G=l.food_log.entries.splice(w,1)[0];l.food_log.entries.splice(W,0,G),b.complete(),console.log("reorder_food_log: day",l),F()},h=async(b,w,W)=>{const G=await ko.create({component:Bo,componentProps:{entry:b,isNew:W},showBackdrop:!0,backdropDismiss:!0});await G.present();const{data:I}=await G.onWillDismiss();return(I==null?void 0:I.data)!==null?(I.data.deleted?l.food_log.entries.splice(w,1):o(2,l.food_log.entries[w]=I.data,l),console.log("*** day.food_log.entries",l.food_log.entries),!0):!1};async function E(){l.water_log.entries.push({id:r.gen_random_uuid(),amt:1,created:new Date().toISOString()}),o(2,l.water_total++,l),F()}async function Y(){l.water_total<=0||(l.water_log.entries.pop(),o(2,l.water_total--,l),F())}function V(b){try{o(2,l[b.target.name]=parseFloat(b.target.value)||0,l)}catch(w){console.error("handleNumberValue error",w),o(2,l[b.target.name]=0,l)}}function L(b){F(),setTimeout(()=>{window.scrollTo({top:0,behavior:"smooth"})},1e3)}return[d,u,l,a,D,F,T,B,y,g,k,E,Y,V,L,()=>{B()},()=>{o(1,u="edit")},()=>{o(1,u="view"),d==="add"&&B()},()=>{F()},b=>{g(b)}]}class Xo extends uo{constructor(n){super(),bo(this,n,Uo,Lo,go,{})}}export{Xo as default};
