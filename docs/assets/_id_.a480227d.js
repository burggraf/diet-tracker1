import{S as ve,i as De,s as Se,e as d,a as w,b as m,d as S,f as s,l as U,n as R,h as C,r as V,t as N,z as W,x as Ce,w as Fe,B as fe,y as Ee,D as Oe}from"./index.d2ad4e6f.js";import{g as Be,p as Ie}from"./index.078cc128.js";import{A as qe,D as Ae,o as Le,C as Te,E as Me,F as Pe}from"./index.8b2cdf33.js";import{m as Ne}from"./controllers.24ddf2c6.js";import Ue from"./FoodEntryModal.c10a8f46.js";import{a as We,s as ze}from"./alert.e0cf4099.js";import{S as He}from"./supabase.data.service.838a1994.js";import{S as Re}from"./supabase.auth.service.c64e88b8.js";import"./BehaviorSubject.2a878591.js";import"./network.service.c42da76f.js";function _e(n,o,e){const i=n.slice();return i[22]=o[e],i[24]=e,i}function ue(n){let o,e,i,r,a,l,u;return{c(){o=d("ion-button"),e=d("ion-icon"),i=w(),r=d("ion-button"),a=d("ion-icon"),m(e,"slot","icon-only"),m(e,"icon",qe),m(a,"slot","icon-only"),m(a,"icon",Ae)},m(c,p){S(c,o,p),s(o,e),S(c,i,p),S(c,r,p),s(r,a),l||(u=[U(o,"click",n[5]),U(r,"click",n[11])],l=!0)},p:R,d(c){c&&C(o),c&&C(i),c&&C(r),l=!1,V(u)}}}function me(n){let o,e,i,r,a,l,u;return{c(){o=d("ion-button"),e=d("ion-icon"),i=w(),r=d("ion-button"),a=d("ion-icon"),m(e,"slot","icon-only"),m(e,"icon",Le),m(a,"slot","icon-only"),m(a,"icon",Te)},m(c,p){S(c,o,p),s(o,e),S(c,i,p),S(c,r,p),s(r,a),l||(u=[U(o,"click",n[12]),U(r,"click",n[13])],l=!0)},p:R,d(c){c&&C(o),c&&C(i),c&&C(r),l=!1,V(u)}}}function pe(n){var oe,te,le,ie,ne;let o,e,i,r,a=(((oe=n[2])==null?void 0:oe.food_total)||0).toFixed(2)+"",l,u,c,p,t,f,F,E,M,y,g,b,k,v,z,Y,j,G,J,_,D,L=new Date((te=n[2])==null?void 0:te.created_at).toLocaleDateString()+"",T,X,H=new Date((le=n[2])==null?void 0:le.created_at).toLocaleTimeString()+"",K,Z,x,$,Q,ee,O=n[1]==="view"&&be(n),B=n[1]==="edit"&&ge(n),I=n[1]==="view"&&ye(n),q=n[1]==="edit"&&ke(n),A=((ne=(ie=n[2])==null?void 0:ie.food_log)==null?void 0:ne.entries)&&he(n);return{c(){o=d("ion-card"),e=d("ion-card-header"),i=d("ion-card-subtitle"),r=N("Total: "),l=N(a),u=w(),c=d("ion-card-title"),O&&O.c(),p=w(),B&&B.c(),t=w(),f=d("ion-card-content"),I&&I.c(),F=w(),q&&q.c(),E=w(),M=d("br"),y=w(),g=d("ion-list"),b=d("ion-reorder-group"),A&&A.c(),k=w(),v=d("ion-item"),z=d("ion-icon"),Y=N(`
						add new entry`),j=w(),G=d("br"),J=w(),_=d("br"),D=N(`
				created: `),T=N(L),X=w(),K=N(H),Z=d("br"),x=w(),$=d("br"),m(b,"id","food_log_group"),m(b,"disabled","false"),m(z,"icon",Me),m(z,"slot","start"),m(g,"lines","full")},m(h,P){S(h,o,P),s(o,e),s(e,i),s(i,r),s(i,l),s(e,u),s(e,c),O&&O.m(c,null),s(c,p),B&&B.m(c,null),s(o,t),s(o,f),I&&I.m(f,null),s(f,F),q&&q.m(f,null),s(f,E),s(f,M),s(f,y),s(f,g),s(g,b),A&&A.m(b,null),s(g,k),s(g,v),s(v,z),s(v,Y),s(f,j),s(f,G),s(f,J),s(f,_),s(f,D),s(f,T),s(f,X),s(f,K),s(f,Z),s(f,x),s(f,$),Q||(ee=[U(b,"ionItemReorder",n[9]),U(v,"click",n[7])],Q=!0)},p(h,P){var se,re,ae,ce,de;P&4&&a!==(a=(((se=h[2])==null?void 0:se.food_total)||0).toFixed(2)+"")&&W(l,a),h[1]==="view"?O?O.p(h,P):(O=be(h),O.c(),O.m(c,p)):O&&(O.d(1),O=null),h[1]==="edit"?B?B.p(h,P):(B=ge(h),B.c(),B.m(c,null)):B&&(B.d(1),B=null),h[1]==="view"?I?I.p(h,P):(I=ye(h),I.c(),I.m(f,F)):I&&(I.d(1),I=null),h[1]==="edit"?q?q.p(h,P):(q=ke(h),q.c(),q.m(f,E)):q&&(q.d(1),q=null),(ae=(re=h[2])==null?void 0:re.food_log)!=null&&ae.entries?A?A.p(h,P):(A=he(h),A.c(),A.m(b,null)):A&&(A.d(1),A=null),P&4&&L!==(L=new Date((ce=h[2])==null?void 0:ce.created_at).toLocaleDateString()+"")&&W(T,L),P&4&&H!==(H=new Date((de=h[2])==null?void 0:de.created_at).toLocaleTimeString()+"")&&W(K,H)},d(h){h&&C(o),O&&O.d(),B&&B.d(),I&&I.d(),q&&q.d(),A&&A.d(),Q=!1,V(ee)}}}function be(n){var i;let o=((i=n[2])==null?void 0:i.date)+"",e;return{c(){e=N(o)},m(r,a){S(r,e,a)},p(r,a){var l;a&4&&o!==(o=((l=r[2])==null?void 0:l.date)+"")&&W(e,o)},d(r){r&&C(e)}}}function ge(n){let o,e,i,r,a;return{c(){o=d("ion-label"),o.textContent="Date:",e=d("ion-input"),m(o,"class","svelte-1bxwl0a"),m(e,"value",i=n[2].date),m(e,"required",""),m(e,"name","date"),m(e,"type","text"),m(e,"class","svelte-1bxwl0a")},m(l,u){S(l,o,u),S(l,e,u),r||(a=U(e,"ionChange",n[3]),r=!0)},p(l,u){u&4&&i!==(i=l[2].date)&&m(e,"value",i)},d(l){l&&C(o),l&&C(e),r=!1,a()}}}function ye(n){var i;let o=((i=n[2])==null?void 0:i.notes)+"",e;return{c(){e=N(o)},m(r,a){S(r,e,a)},p(r,a){var l;a&4&&o!==(o=((l=r[2])==null?void 0:l.notes)+"")&&W(e,o)},d(r){r&&C(e)}}}function ke(n){let o,e,i,r,a;return{c(){o=d("ion-label"),o.textContent="Notes:",e=d("ion-input"),m(o,"class","svelte-1bxwl0a"),m(e,"value",i=n[2].notes),m(e,"required",""),m(e,"name","notes"),m(e,"type","text"),m(e,"class","svelte-1bxwl0a")},m(l,u){S(l,o,u),S(l,e,u),r||(a=U(e,"ionChange",n[3]),r=!0)},p(l,u){u&4&&i!==(i=l[2].notes)&&m(e,"value",i)},d(l){l&&C(o),l&&C(e),r=!1,a()}}}function he(n){var r,a;let o,e=(a=(r=n[2])==null?void 0:r.food_log)==null?void 0:a.entries,i=[];for(let l=0;l<e.length;l+=1)i[l]=we(_e(n,e,l));return{c(){for(let l=0;l<i.length;l+=1)i[l].c();o=Ce()},m(l,u){for(let c=0;c<i.length;c+=1)i[c].m(l,u);S(l,o,u)},p(l,u){var c,p;if(u&260){e=(p=(c=l[2])==null?void 0:c.food_log)==null?void 0:p.entries;let t;for(t=0;t<e.length;t+=1){const f=_e(l,e,t);i[t]?i[t].p(f,u):(i[t]=we(f),i[t].c(),i[t].m(o.parentNode,o))}for(;t<i.length;t+=1)i[t].d(1);i.length=e.length}},d(l){Fe(i,l),l&&C(o)}}}function we(n){var M,y;let o,e=((M=n[22])==null?void 0:M.title)+"",i,r,a,l=(((y=n[22])==null?void 0:y.amt)||0).toFixed(2)+"",u,c,p,t,f,F;function E(){return n[14](n[24])}return{c(){o=d("ion-item"),i=N(e),r=w(),a=d("ion-note"),u=N(l),c=w(),p=d("ion-reorder"),t=w(),m(a,"slot","end"),m(p,"slot","start")},m(g,b){S(g,o,b),s(o,i),s(o,r),s(o,a),s(a,u),s(o,c),s(o,p),s(o,t),f||(F=U(o,"click",E),f=!0)},p(g,b){var k,v;n=g,b&4&&e!==(e=((k=n[22])==null?void 0:k.title)+"")&&W(i,e),b&4&&l!==(l=(((v=n[22])==null?void 0:v.amt)||0).toFixed(2)+"")&&W(u,l)},d(g){g&&C(o),f=!1,F()}}}function Ye(n){let o,e,i,r,a,l,u,c,p,t,f,F,E,M,y=n[1]==="view"&&ue(n),g=n[1]==="edit"&&me(n),b=n[2]&&pe(n);return{c(){o=d("ion-header"),e=d("ion-toolbar"),i=d("ion-buttons"),r=d("ion-button"),a=d("ion-icon"),l=w(),u=d("ion-title"),u.textContent="Day",c=w(),p=d("ion-buttons"),y&&y.c(),t=w(),g&&g.c(),f=w(),F=d("ion-content"),b&&b.c(),m(a,"slot","icon-only"),m(a,"icon",Pe),m(i,"slot","start"),m(p,"slot","end"),m(o,"translucent","true"),m(F,"class","ion-padding")},m(k,v){S(k,o,v),s(o,e),s(e,i),s(i,r),s(r,a),s(e,l),s(e,u),s(e,c),s(e,p),y&&y.m(p,null),s(p,t),g&&g.m(p,null),S(k,f,v),S(k,F,v),b&&b.m(F,null),E||(M=U(r,"click",n[10]),E=!0)},p(k,[v]){k[1]==="view"?y?y.p(k,v):(y=ue(k),y.c(),y.m(p,t)):y&&(y.d(1),y=null),k[1]==="edit"?g?g.p(k,v):(g=me(k),g.c(),g.m(p,null)):g&&(g.d(1),g=null),k[2]?b?b.p(k,v):(b=pe(k),b.c(),b.m(F,null)):b&&(b.d(1),b=null)},i:R,o:R,d(k){k&&C(o),y&&y.d(),g&&g.d(),k&&C(f),k&&C(F),b&&b.d(),E=!1,M()}}}function je(n,o,e){let i,r;fe(n,Be,_=>e(18,i=_)),fe(n,Ie,_=>e(19,r=_));const a=He.getInstance();let l=null,u,c=r.id,p="view",t={};console.log("*** id",c);let f;c==="new"?(console.log("it is new"),t={id:a.gen_random_uuid(),user_id:(l==null?void 0:l.id)||null,created_at:new Date().toISOString(),date:new Date().toISOString().substring(0,10),food_log:{entries:[]},activity_log:{entries:[]},water_log:{entries:[]},weight:0,notes:""},p="edit",console.log("*** new day",t)):f=a.getDataSubscription("day",{id:c}).subscribe(_=>{e(2,t=_),console.log("*** day",t)}),Ee(()=>{u=Re.user.subscribe(_=>{l=_})}),Oe(()=>{try{f.unsubscribe(),u.unsubscribe()}catch(_){console.error("error unsubscribing",_)}});const F=_=>{if(typeof t[_.target.name]=="number")try{e(2,t[_.target.name]=parseFloat(_.target.value),t)}catch{e(2,t[_.target.name]=0,t)}else e(2,t[_.target.name]=_.target.value,t)},E=async()=>{console.log("save the day",t),t.user_id||e(2,t.user_id=l.id,t);try{e(2,t.food_total=0,t),t.food_log.entries.forEach(D=>{e(2,t.food_total+=D.amt,t)})}catch(D){console.error("error calculating food total",D)}const{error:_}=await a.save_day(t);_?(console.log("error message is: ",_.message),_.message.startsWith("duplicate key value violates unique constraint")?(console.log("DUPLICATE DAY"),We({header:"Duplicate Day",message:"This day already exists.  Please edit the existing day."})):console.error("save day error",_)):(e(0,c=t.id),e(1,p="view"))},M=async()=>{await ze({header:"Delete Day",message:"Are you sure?",okHander:async()=>{const{data:_,error:D}=await a.delete_day(t);D?console.error("Error deleting day",D):y()}})},y=()=>{i("/days")},g=async _=>{t.food_log.entries||e(2,t.food_log.entries=[],t);const D={id:a.gen_random_uuid(),food_id:"",title:"",desc:"",cat:"",cps:0,qty:0,amt:0,created:new Date().toISOString()},L=await v(D,t.food_log.entries.length);console.log("done calling openFoodEntryBox",L),console.log("day.food_log.entries",t.food_log.entries),e(2,t.food_log.entries=[...t.food_log.entries],t),E()},b=async _=>{const D=await v(t.food_log.entries[_],_);console.log("edit_food_log_entry is done calling openFoodEntryBox",D),console.log("day.food_log.entries",t.food_log.entries),e(2,t.food_log.entries=[...t.food_log.entries],t),E()},k=({detail:_})=>{const{from:D,to:L}=_,T=t.food_log.entries.splice(D,1)[0];t.food_log.entries.splice(L,0,T),_.complete(),console.log("reorder_food_log: day",t),E()},v=async(_,D)=>{const L=await Ne.create({component:Ue,componentProps:{entry:_},showBackdrop:!0,backdropDismiss:!0});await L.present();const{data:T}=await L.onWillDismiss();return(T==null?void 0:T.data)!==null?(T.data.deleted?t.food_log.entries.splice(D,1):e(2,t.food_log.entries[D]=T.data,t),console.log("*** day.food_log.entries",t.food_log.entries),!0):!1};return[c,p,t,F,E,M,y,g,b,k,()=>{y()},()=>{e(1,p="edit")},()=>{e(1,p="view"),c==="add"&&y()},()=>{E()},_=>{b(_)}]}class oo extends ve{constructor(o){super(),De(this,o,je,Ye,Se,{})}}export{oo as default};
