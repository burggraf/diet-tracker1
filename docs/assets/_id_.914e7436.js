import{S as De,i as Se,s as qe,e as d,a as w,b as u,d as S,f as i,l as U,n as $,h as q,r as ee,t as T,z as j,x as Ce,j as fe,w as Fe,B as _e,y as Ee,D as Oe}from"./index.dbf26c8d.js";import{g as Be,p as Ie}from"./index.89c9e2e1.js";import{A as Ae,D as Le,o as Te,C as Me,E as Pe,F as ze}from"./index.9cfe1f2c.js";import{m as Ne}from"./controllers.43daeafe.js";import Ue from"./FoodEntryModal.f1be9fd5.js";import{a as We,s as je}from"./alert.fd2bb636.js";import{S as He}from"./supabase.data.service.edc93321.js";import{S as Re}from"./supabase.auth.service.10fe8a42.js";import"./BehaviorSubject.43c20909.js";import"./network.service.6bd88427.js";function ue(n,o,e){const s=n.slice();return s[22]=o[e],s[24]=e,s}function pe(n){let o,e,s,r,a,l,m;return{c(){o=d("ion-button"),e=d("ion-icon"),s=w(),r=d("ion-button"),a=d("ion-icon"),u(e,"slot","icon-only"),u(e,"icon",Ae),u(a,"slot","icon-only"),u(a,"icon",Le)},m(c,p){S(c,o,p),i(o,e),S(c,s,p),S(c,r,p),i(r,a),l||(m=[U(o,"click",n[5]),U(r,"click",n[11])],l=!0)},p:$,d(c){c&&q(o),c&&q(s),c&&q(r),l=!1,ee(m)}}}function me(n){let o,e,s,r,a,l,m;return{c(){o=d("ion-button"),e=d("ion-icon"),s=w(),r=d("ion-button"),a=d("ion-icon"),u(e,"slot","icon-only"),u(e,"icon",Te),u(a,"slot","icon-only"),u(a,"icon",Me)},m(c,p){S(c,o,p),i(o,e),S(c,s,p),S(c,r,p),i(r,a),l||(m=[U(o,"click",n[12]),U(r,"click",n[13])],l=!0)},p:$,d(c){c&&q(o),c&&q(s),c&&q(r),l=!1,ee(m)}}}function be(n){var te,oe,le,ie,ne;let o,e,s,r,a=(((te=n[2])==null?void 0:te.food_total)||0).toFixed(2)+"",l,m,c,p,t,_,E,F,M,b,y,g,k,D,z,H,Y,J,K,f,h,P=new Date((oe=n[2])==null?void 0:oe.created_at).toLocaleDateString()+"",O,X,G=new Date((le=n[2])==null?void 0:le.created_at).toLocaleTimeString()+"",Q,R,W,Z,V,x,C=n[1]==="view"&&ge(n),B=n[1]==="edit"&&ye(n),I=n[1]==="view"&&ke(n),A=n[1]==="edit"&&he(n),L=((ne=(ie=n[2])==null?void 0:ie.food_log)==null?void 0:ne.entries)&&ve(n);return{c(){o=d("ion-card"),e=d("ion-card-header"),s=d("ion-card-subtitle"),r=T("Total: "),l=T(a),m=w(),c=d("ion-card-title"),C&&C.c(),p=w(),B&&B.c(),t=w(),_=d("ion-card-content"),I&&I.c(),E=w(),A&&A.c(),F=w(),M=d("br"),b=w(),y=d("ion-list"),g=d("ion-reorder-group"),L&&L.c(),k=w(),D=d("ion-item"),z=d("ion-icon"),H=T(`
						add new entry`),Y=w(),J=d("br"),K=w(),f=d("br"),h=T(`
				created: `),O=T(P),X=w(),Q=T(G),R=d("br"),W=w(),Z=d("br"),u(g,"id","food_log_group"),u(g,"disabled","false"),u(z,"icon",Pe),u(z,"slot","start"),u(y,"lines","full")},m(v,N){S(v,o,N),i(o,e),i(e,s),i(s,r),i(s,l),i(e,m),i(e,c),C&&C.m(c,null),i(c,p),B&&B.m(c,null),i(o,t),i(o,_),I&&I.m(_,null),i(_,E),A&&A.m(_,null),i(_,F),i(_,M),i(_,b),i(_,y),i(y,g),L&&L.m(g,null),i(y,k),i(y,D),i(D,z),i(D,H),i(_,Y),i(_,J),i(_,K),i(_,f),i(_,h),i(_,O),i(_,X),i(_,Q),i(_,R),i(_,W),i(_,Z),V||(x=[U(g,"ionItemReorder",n[9]),U(D,"click",n[7])],V=!0)},p(v,N){var se,re,ae,ce,de;N&4&&a!==(a=(((se=v[2])==null?void 0:se.food_total)||0).toFixed(2)+"")&&j(l,a),v[1]==="view"?C?C.p(v,N):(C=ge(v),C.c(),C.m(c,p)):C&&(C.d(1),C=null),v[1]==="edit"?B?B.p(v,N):(B=ye(v),B.c(),B.m(c,null)):B&&(B.d(1),B=null),v[1]==="view"?I?I.p(v,N):(I=ke(v),I.c(),I.m(_,E)):I&&(I.d(1),I=null),v[1]==="edit"?A?A.p(v,N):(A=he(v),A.c(),A.m(_,F)):A&&(A.d(1),A=null),(ae=(re=v[2])==null?void 0:re.food_log)!=null&&ae.entries?L?L.p(v,N):(L=ve(v),L.c(),L.m(g,null)):L&&(L.d(1),L=null),N&4&&P!==(P=new Date((ce=v[2])==null?void 0:ce.created_at).toLocaleDateString()+"")&&j(O,P),N&4&&G!==(G=new Date((de=v[2])==null?void 0:de.created_at).toLocaleTimeString()+"")&&j(Q,G)},d(v){v&&q(o),C&&C.d(),B&&B.d(),I&&I.d(),A&&A.d(),L&&L.d(),V=!1,ee(x)}}}function ge(n){var s;let o=((s=n[2])==null?void 0:s.date)+"",e;return{c(){e=T(o)},m(r,a){S(r,e,a)},p(r,a){var l;a&4&&o!==(o=((l=r[2])==null?void 0:l.date)+"")&&j(e,o)},d(r){r&&q(e)}}}function ye(n){let o,e,s,r,a;return{c(){o=d("ion-label"),o.textContent="Date:",e=d("ion-input"),u(o,"class","svelte-8l8qbx"),u(e,"value",s=n[2].date),u(e,"required",""),u(e,"name","date"),u(e,"type","text"),u(e,"class","svelte-8l8qbx")},m(l,m){S(l,o,m),S(l,e,m),r||(a=U(e,"ionChange",n[3]),r=!0)},p(l,m){m&4&&s!==(s=l[2].date)&&u(e,"value",s)},d(l){l&&q(o),l&&q(e),r=!1,a()}}}function ke(n){var s;let o=((s=n[2])==null?void 0:s.notes)+"",e;return{c(){e=T(o)},m(r,a){S(r,e,a)},p(r,a){var l;a&4&&o!==(o=((l=r[2])==null?void 0:l.notes)+"")&&j(e,o)},d(r){r&&q(e)}}}function he(n){let o,e,s,r,a;return{c(){o=d("ion-label"),o.textContent="Notes:",e=d("ion-input"),u(o,"class","svelte-8l8qbx"),u(e,"value",s=n[2].notes),u(e,"required",""),u(e,"name","notes"),u(e,"type","text"),u(e,"class","svelte-8l8qbx")},m(l,m){S(l,o,m),S(l,e,m),r||(a=U(e,"ionChange",n[3]),r=!0)},p(l,m){m&4&&s!==(s=l[2].notes)&&u(e,"value",s)},d(l){l&&q(o),l&&q(e),r=!1,a()}}}function ve(n){var r,a;let o,e=(a=(r=n[2])==null?void 0:r.food_log)==null?void 0:a.entries,s=[];for(let l=0;l<e.length;l+=1)s[l]=we(ue(n,e,l));return{c(){for(let l=0;l<s.length;l+=1)s[l].c();o=Ce()},m(l,m){for(let c=0;c<s.length;c+=1)s[c].m(l,m);S(l,o,m)},p(l,m){var c,p;if(m&260){e=(p=(c=l[2])==null?void 0:c.food_log)==null?void 0:p.entries;let t;for(t=0;t<e.length;t+=1){const _=ue(l,e,t);s[t]?s[t].p(_,m):(s[t]=we(_),s[t].c(),s[t].m(o.parentNode,o))}for(;t<s.length;t+=1)s[t].d(1);s.length=e.length}},d(l){Fe(s,l),l&&q(o)}}}function we(n){var O,X,G,Q;let o,e,s,r,a=((O=n[22])==null?void 0:O.title)+"",l,m,c,p,t=(((X=n[22])==null?void 0:X.desc)||"")+"",_,E,F,M,b,y=(((G=n[22])==null?void 0:G.amt)||0).toFixed(2)+"",g,k,D,z,H=(((Q=n[22])==null?void 0:Q.cat)||"")+"",Y,J,K,f,h;function P(){return n[14](n[24])}return{c(){o=d("ion-item"),e=d("ion-reorder"),s=w(),r=d("div"),l=T(a),m=d("br"),c=w(),p=d("span"),_=T(t),E=T("\xA0"),F=w(),M=d("ion-note"),b=d("div"),g=T(y),k=d("br"),D=w(),z=d("span"),Y=T(H),J=T("\xA0"),K=w(),u(e,"slot","start"),fe(p,"class","description svelte-8l8qbx"),fe(z,"class","description svelte-8l8qbx"),u(M,"slot","end"),u(M,"class","right svelte-8l8qbx")},m(R,W){S(R,o,W),i(o,e),i(o,s),i(o,r),i(r,l),i(r,m),i(r,c),i(r,p),i(p,_),i(p,E),i(o,F),i(o,M),i(M,b),i(b,g),i(b,k),i(b,D),i(b,z),i(z,Y),i(z,J),i(o,K),f||(h=U(o,"click",P),f=!0)},p(R,W){var Z,V,x,C;n=R,W&4&&a!==(a=((Z=n[22])==null?void 0:Z.title)+"")&&j(l,a),W&4&&t!==(t=(((V=n[22])==null?void 0:V.desc)||"")+"")&&j(_,t),W&4&&y!==(y=(((x=n[22])==null?void 0:x.amt)||0).toFixed(2)+"")&&j(g,y),W&4&&H!==(H=(((C=n[22])==null?void 0:C.cat)||"")+"")&&j(Y,H)},d(R){R&&q(o),f=!1,h()}}}function Ye(n){let o,e,s,r,a,l,m,c,p,t,_,E,F,M,b=n[1]==="view"&&pe(n),y=n[1]==="edit"&&me(n),g=n[2]&&be(n);return{c(){o=d("ion-header"),e=d("ion-toolbar"),s=d("ion-buttons"),r=d("ion-button"),a=d("ion-icon"),l=w(),m=d("ion-title"),m.textContent="Day",c=w(),p=d("ion-buttons"),b&&b.c(),t=w(),y&&y.c(),_=w(),E=d("ion-content"),g&&g.c(),u(a,"slot","icon-only"),u(a,"icon",ze),u(s,"slot","start"),u(p,"slot","end"),u(o,"translucent","true"),u(E,"class","ion-padding")},m(k,D){S(k,o,D),i(o,e),i(e,s),i(s,r),i(r,a),i(e,l),i(e,m),i(e,c),i(e,p),b&&b.m(p,null),i(p,t),y&&y.m(p,null),S(k,_,D),S(k,E,D),g&&g.m(E,null),F||(M=U(r,"click",n[10]),F=!0)},p(k,[D]){k[1]==="view"?b?b.p(k,D):(b=pe(k),b.c(),b.m(p,t)):b&&(b.d(1),b=null),k[1]==="edit"?y?y.p(k,D):(y=me(k),y.c(),y.m(p,null)):y&&(y.d(1),y=null),k[2]?g?g.p(k,D):(g=be(k),g.c(),g.m(E,null)):g&&(g.d(1),g=null)},i:$,o:$,d(k){k&&q(o),b&&b.d(),y&&y.d(),k&&q(_),k&&q(E),g&&g.d(),F=!1,M()}}}function Ge(n,o,e){let s,r;_e(n,Be,f=>e(18,s=f)),_e(n,Ie,f=>e(19,r=f));const a=He.getInstance();let l=null,m,c=r.id,p="view",t={};console.log("*** id",c);let _;c==="new"?(console.log("it is new"),t={id:a.gen_random_uuid(),user_id:(l==null?void 0:l.id)||null,created_at:new Date().toISOString(),date:new Date().toISOString().substring(0,10),food_log:{entries:[]},activity_log:{entries:[]},water_log:{entries:[]},weight:0,notes:""},p="edit",console.log("*** new day",t)):_=a.getDataSubscription("day",{id:c}).subscribe(f=>{e(2,t=f),console.log("*** day",t)}),Ee(()=>{m=Re.user.subscribe(f=>{l=f})}),Oe(()=>{try{_.unsubscribe(),m.unsubscribe()}catch(f){console.error("error unsubscribing",f)}});const E=f=>{if(typeof t[f.target.name]=="number")try{e(2,t[f.target.name]=parseFloat(f.target.value),t)}catch{e(2,t[f.target.name]=0,t)}else e(2,t[f.target.name]=f.target.value,t)},F=async()=>{console.log("save the day",t),t.user_id||e(2,t.user_id=l.id,t);try{e(2,t.food_total=0,t),t.food_log.entries.forEach(h=>{e(2,t.food_total+=h.amt,t)})}catch(h){console.error("error calculating food total",h)}const{error:f}=await a.save_day(t);f?(console.log("error message is: ",f.message),f.message.startsWith("duplicate key value violates unique constraint")?(console.log("DUPLICATE DAY"),We({header:"Duplicate Day",message:"This day already exists.  Please edit the existing day."})):console.error("save day error",f)):(e(0,c=t.id),e(1,p="view"))},M=async()=>{await je({header:"Delete Day",message:"Are you sure?",okHander:async()=>{const{data:f,error:h}=await a.delete_day(t);h?console.error("Error deleting day",h):b()}})},b=()=>{s("/days")},y=async f=>{t.food_log.entries||e(2,t.food_log.entries=[],t);const h={id:a.gen_random_uuid(),food_id:"",title:"",desc:"",cat:"",cps:0,qty:0,amt:0,created:new Date().toISOString()},P=await D(h,t.food_log.entries.length);console.log("done calling openFoodEntryBox",P),console.log("day.food_log.entries",t.food_log.entries),e(2,t.food_log.entries=[...t.food_log.entries],t),F()},g=async f=>{const h=await D(t.food_log.entries[f],f);console.log("edit_food_log_entry is done calling openFoodEntryBox",h),console.log("day.food_log.entries",t.food_log.entries),e(2,t.food_log.entries=[...t.food_log.entries],t),F()},k=({detail:f})=>{const{from:h,to:P}=f,O=t.food_log.entries.splice(h,1)[0];t.food_log.entries.splice(P,0,O),f.complete(),console.log("reorder_food_log: day",t),F()},D=async(f,h)=>{const P=await Ne.create({component:Ue,componentProps:{entry:f},showBackdrop:!0,backdropDismiss:!0});await P.present();const{data:O}=await P.onWillDismiss();return(O==null?void 0:O.data)!==null?(O.data.deleted?t.food_log.entries.splice(h,1):e(2,t.food_log.entries[h]=O.data,t),console.log("*** day.food_log.entries",t.food_log.entries),!0):!1};return[c,p,t,E,F,M,b,y,g,k,()=>{b()},()=>{e(1,p="edit")},()=>{e(1,p="view"),c==="add"&&b()},()=>{F()},f=>{g(f)}]}class ot extends De{constructor(o){super(),Se(this,o,Ge,Ye,qe,{})}}export{ot as default};
