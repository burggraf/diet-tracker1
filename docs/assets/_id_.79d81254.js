import{S as De,i as Se,s as qe,e as d,a as w,b as u,d as S,f as i,l as U,n as $,h as q,r as ee,t as T,z as j,x as Be,j as fe,w as Ce,B as _e,y as Ae,D as Fe}from"./index.8b422737.js";import{g as Oe,p as Ee}from"./index.49d789a5.js";import{A as Ie,D as Le,o as Te,C as Me,E as Pe,F as ze}from"./index.27aeaf2e.js";import{m as Ne}from"./controllers.57dc12f3.js";import Ue from"./FoodEntryModal.73910a8c.js";import{a as We,s as je}from"./alert.3d2efee2.js";import{S as He}from"./supabase.data.service.1ecfb808.js";import{S as Re}from"./supabase.auth.service.2021fa90.js";import"./BehaviorSubject.d2d4e9e1.js";import"./network.service.31bf06e6.js";function ue(n,o,e){const s=n.slice();return s[22]=o[e],s[24]=e,s}function pe(n){let o,e,s,r,a,l,m;return{c(){o=d("ion-button"),e=d("ion-icon"),s=w(),r=d("ion-button"),a=d("ion-icon"),u(e,"slot","icon-only"),u(e,"icon",Ie),u(a,"slot","icon-only"),u(a,"icon",Le)},m(c,p){S(c,o,p),i(o,e),S(c,s,p),S(c,r,p),i(r,a),l||(m=[U(o,"click",n[5]),U(r,"click",n[11])],l=!0)},p:$,d(c){c&&q(o),c&&q(s),c&&q(r),l=!1,ee(m)}}}function me(n){let o,e,s,r,a,l,m;return{c(){o=d("ion-button"),e=d("ion-icon"),s=w(),r=d("ion-button"),a=d("ion-icon"),u(e,"slot","icon-only"),u(e,"icon",Te),u(a,"slot","icon-only"),u(a,"icon",Me)},m(c,p){S(c,o,p),i(o,e),S(c,s,p),S(c,r,p),i(r,a),l||(m=[U(o,"click",n[12]),U(r,"click",n[13])],l=!0)},p:$,d(c){c&&q(o),c&&q(s),c&&q(r),l=!1,ee(m)}}}function ge(n){var te,oe,le,ie,ne;let o,e,s,r,a=(((te=n[2])==null?void 0:te.food_total)||0).toFixed(2)+"",l,m,c,p,t,_,A,C,M,g,y,b,k,D,z,J,H,Y,K,f,h,P=new Date((oe=n[2])==null?void 0:oe.created_at).toLocaleDateString()+"",F,X,G=new Date((le=n[2])==null?void 0:le.created_at).toLocaleTimeString()+"",Q,R,W,Z,V,x,B=n[1]==="view"&&be(n),O=n[1]==="edit"&&ye(n),E=n[1]==="view"&&he(n),I=n[1]==="edit"&&ke(n),L=((ne=(ie=n[2])==null?void 0:ie.food_log)==null?void 0:ne.entries)&&ve(n);return{c(){o=d("ion-card"),e=d("ion-card-header"),s=d("ion-card-subtitle"),r=T("Total: "),l=T(a),m=w(),c=d("ion-card-title"),B&&B.c(),p=w(),O&&O.c(),t=w(),_=d("ion-card-content"),E&&E.c(),A=w(),I&&I.c(),C=w(),M=d("br"),g=w(),y=d("ion-list"),b=d("ion-reorder-group"),L&&L.c(),k=w(),D=d("ion-item"),z=d("ion-icon"),J=T(`
						add new entry`),H=w(),Y=d("br"),K=w(),f=d("br"),h=T(`
				created: `),F=T(P),X=w(),Q=T(G),R=d("br"),W=w(),Z=d("br"),u(b,"id","food_log_group"),u(b,"disabled","false"),u(z,"icon",Pe),u(z,"slot","start"),u(y,"lines","full")},m(v,N){S(v,o,N),i(o,e),i(e,s),i(s,r),i(s,l),i(e,m),i(e,c),B&&B.m(c,null),i(c,p),O&&O.m(c,null),i(o,t),i(o,_),E&&E.m(_,null),i(_,A),I&&I.m(_,null),i(_,C),i(_,M),i(_,g),i(_,y),i(y,b),L&&L.m(b,null),i(y,k),i(y,D),i(D,z),i(D,J),i(_,H),i(_,Y),i(_,K),i(_,f),i(_,h),i(_,F),i(_,X),i(_,Q),i(_,R),i(_,W),i(_,Z),V||(x=[U(b,"ionItemReorder",n[9]),U(D,"click",n[7])],V=!0)},p(v,N){var se,re,ae,ce,de;N&4&&a!==(a=(((se=v[2])==null?void 0:se.food_total)||0).toFixed(2)+"")&&j(l,a),v[1]==="view"?B?B.p(v,N):(B=be(v),B.c(),B.m(c,p)):B&&(B.d(1),B=null),v[1]==="edit"?O?O.p(v,N):(O=ye(v),O.c(),O.m(c,null)):O&&(O.d(1),O=null),v[1]==="view"?E?E.p(v,N):(E=he(v),E.c(),E.m(_,A)):E&&(E.d(1),E=null),v[1]==="edit"?I?I.p(v,N):(I=ke(v),I.c(),I.m(_,C)):I&&(I.d(1),I=null),(ae=(re=v[2])==null?void 0:re.food_log)!=null&&ae.entries?L?L.p(v,N):(L=ve(v),L.c(),L.m(b,null)):L&&(L.d(1),L=null),N&4&&P!==(P=new Date((ce=v[2])==null?void 0:ce.created_at).toLocaleDateString()+"")&&j(F,P),N&4&&G!==(G=new Date((de=v[2])==null?void 0:de.created_at).toLocaleTimeString()+"")&&j(Q,G)},d(v){v&&q(o),B&&B.d(),O&&O.d(),E&&E.d(),I&&I.d(),L&&L.d(),V=!1,ee(x)}}}function be(n){var s;let o=((s=n[2])==null?void 0:s.date)+"",e;return{c(){e=T(o)},m(r,a){S(r,e,a)},p(r,a){var l;a&4&&o!==(o=((l=r[2])==null?void 0:l.date)+"")&&j(e,o)},d(r){r&&q(e)}}}function ye(n){let o,e,s,r,a;return{c(){o=d("ion-label"),o.textContent="Date:",e=d("ion-input"),u(o,"class","svelte-8l8qbx"),u(e,"value",s=n[2].date),u(e,"required",""),u(e,"name","date"),u(e,"type","text"),u(e,"class","svelte-8l8qbx")},m(l,m){S(l,o,m),S(l,e,m),r||(a=U(e,"ionChange",n[3]),r=!0)},p(l,m){m&4&&s!==(s=l[2].date)&&u(e,"value",s)},d(l){l&&q(o),l&&q(e),r=!1,a()}}}function he(n){var s;let o=((s=n[2])==null?void 0:s.notes)+"",e;return{c(){e=T(o)},m(r,a){S(r,e,a)},p(r,a){var l;a&4&&o!==(o=((l=r[2])==null?void 0:l.notes)+"")&&j(e,o)},d(r){r&&q(e)}}}function ke(n){let o,e,s,r,a;return{c(){o=d("ion-label"),o.textContent="Notes:",e=d("ion-input"),u(o,"class","svelte-8l8qbx"),u(e,"value",s=n[2].notes),u(e,"required",""),u(e,"name","notes"),u(e,"type","text"),u(e,"class","svelte-8l8qbx")},m(l,m){S(l,o,m),S(l,e,m),r||(a=U(e,"ionChange",n[3]),r=!0)},p(l,m){m&4&&s!==(s=l[2].notes)&&u(e,"value",s)},d(l){l&&q(o),l&&q(e),r=!1,a()}}}function ve(n){var r,a;let o,e=(a=(r=n[2])==null?void 0:r.food_log)==null?void 0:a.entries,s=[];for(let l=0;l<e.length;l+=1)s[l]=we(ue(n,e,l));return{c(){for(let l=0;l<s.length;l+=1)s[l].c();o=Be()},m(l,m){for(let c=0;c<s.length;c+=1)s[c].m(l,m);S(l,o,m)},p(l,m){var c,p;if(m&260){e=(p=(c=l[2])==null?void 0:c.food_log)==null?void 0:p.entries;let t;for(t=0;t<e.length;t+=1){const _=ue(l,e,t);s[t]?s[t].p(_,m):(s[t]=we(_),s[t].c(),s[t].m(o.parentNode,o))}for(;t<s.length;t+=1)s[t].d(1);s.length=e.length}},d(l){Ce(s,l),l&&q(o)}}}function we(n){var F,X,G,Q;let o,e,s,r,a=((F=n[22])==null?void 0:F.title)+"",l,m,c,p,t=(((X=n[22])==null?void 0:X.desc)||"")+"",_,A,C,M,g,y=(((G=n[22])==null?void 0:G.amt)||0).toFixed(2)+"",b,k,D,z,J,H=(((Q=n[22])==null?void 0:Q.cat)||"")+"",Y,K,f,h;function P(){return n[14](n[24])}return{c(){o=d("ion-item"),e=d("ion-reorder"),s=w(),r=d("div"),l=T(a),m=d("br"),c=w(),p=d("span"),_=T(t),A=T("\xA0"),C=w(),M=d("ion-note"),g=d("div"),b=T(y),k=d("br"),D=w(),z=d("span"),J=T("\xA0"),Y=T(H),K=w(),u(e,"slot","start"),fe(p,"class","description svelte-8l8qbx"),fe(z,"class","description svelte-8l8qbx"),u(M,"slot","end"),u(M,"class","right svelte-8l8qbx")},m(R,W){S(R,o,W),i(o,e),i(o,s),i(o,r),i(r,l),i(r,m),i(r,c),i(r,p),i(p,_),i(p,A),i(o,C),i(o,M),i(M,g),i(g,b),i(g,k),i(g,D),i(g,z),i(z,J),i(z,Y),i(o,K),f||(h=U(o,"click",P),f=!0)},p(R,W){var Z,V,x,B;n=R,W&4&&a!==(a=((Z=n[22])==null?void 0:Z.title)+"")&&j(l,a),W&4&&t!==(t=(((V=n[22])==null?void 0:V.desc)||"")+"")&&j(_,t),W&4&&y!==(y=(((x=n[22])==null?void 0:x.amt)||0).toFixed(2)+"")&&j(b,y),W&4&&H!==(H=(((B=n[22])==null?void 0:B.cat)||"")+"")&&j(Y,H)},d(R){R&&q(o),f=!1,h()}}}function Ye(n){let o,e,s,r,a,l,m,c,p,t,_,A,C,M,g=n[1]==="view"&&pe(n),y=n[1]==="edit"&&me(n),b=n[2]&&ge(n);return{c(){o=d("ion-header"),e=d("ion-toolbar"),s=d("ion-buttons"),r=d("ion-button"),a=d("ion-icon"),l=w(),m=d("ion-title"),m.textContent="Day",c=w(),p=d("ion-buttons"),g&&g.c(),t=w(),y&&y.c(),_=w(),A=d("ion-content"),b&&b.c(),u(a,"slot","icon-only"),u(a,"icon",ze),u(s,"slot","start"),u(p,"slot","end"),u(o,"translucent","true"),u(A,"class","ion-padding")},m(k,D){S(k,o,D),i(o,e),i(e,s),i(s,r),i(r,a),i(e,l),i(e,m),i(e,c),i(e,p),g&&g.m(p,null),i(p,t),y&&y.m(p,null),S(k,_,D),S(k,A,D),b&&b.m(A,null),C||(M=U(r,"click",n[10]),C=!0)},p(k,[D]){k[1]==="view"?g?g.p(k,D):(g=pe(k),g.c(),g.m(p,t)):g&&(g.d(1),g=null),k[1]==="edit"?y?y.p(k,D):(y=me(k),y.c(),y.m(p,null)):y&&(y.d(1),y=null),k[2]?b?b.p(k,D):(b=ge(k),b.c(),b.m(A,null)):b&&(b.d(1),b=null)},i:$,o:$,d(k){k&&q(o),g&&g.d(),y&&y.d(),k&&q(_),k&&q(A),b&&b.d(),C=!1,M()}}}function Ge(n,o,e){let s,r;_e(n,Oe,f=>e(18,s=f)),_e(n,Ee,f=>e(19,r=f));const a=He.getInstance();let l=null,m,c=r.id,p="view",t={};console.log("*** id",c);let _;c==="new"?(console.log("it is new"),t={id:a.gen_random_uuid(),user_id:(l==null?void 0:l.id)||null,created_at:new Date().toISOString(),date:new Date().toISOString().substring(0,10),food_log:{entries:[]},activity_log:{entries:[]},water_log:{entries:[]},weight:0,notes:""},p="edit",console.log("*** new day",t)):_=a.getDataSubscription("day",{id:c}).subscribe(f=>{e(2,t=f),console.log("*** day",t)}),Ae(()=>{m=Re.user.subscribe(f=>{l=f})}),Fe(()=>{try{_.unsubscribe(),m.unsubscribe()}catch(f){console.error("error unsubscribing",f)}});const A=f=>{if(typeof t[f.target.name]=="number")try{e(2,t[f.target.name]=parseFloat(f.target.value),t)}catch{e(2,t[f.target.name]=0,t)}else e(2,t[f.target.name]=f.target.value,t)},C=async()=>{console.log("save the day",t),t.user_id||e(2,t.user_id=l.id,t);try{e(2,t.food_total=0,t),t.food_log.entries.forEach(h=>{e(2,t.food_total+=h.amt,t)})}catch(h){console.error("error calculating food total",h)}const{error:f}=await a.save_day(t);f?(console.log("error message is: ",f.message),f.message.startsWith("duplicate key value violates unique constraint")?(console.log("DUPLICATE DAY"),We({header:"Duplicate Day",message:"This day already exists.  Please edit the existing day."})):console.error("save day error",f)):(e(0,c=t.id),e(1,p="view"),new Date().toISOString().substring(0,10)===t.date&&"setAppBadge"in navigator&&"clearAppBadge"in navigator&&(t.food_total?navigator.setAppBadge(t.food_total).catch(h=>{console.error("setAppBadge error",h)}):navigator.clearAppBadge.catch(h=>{console.error("clearAppBadge error",h)})))},M=async()=>{await je({header:"Delete Day",message:"Are you sure?",okHander:async()=>{const{data:f,error:h}=await a.delete_day(t);h?console.error("Error deleting day",h):g()}})},g=()=>{s("/days")},y=async f=>{t.food_log.entries||e(2,t.food_log.entries=[],t);const h={id:a.gen_random_uuid(),food_id:"",title:"",desc:"",cat:"",cps:0,qty:1,amt:0,created:new Date().toISOString()},P=await D(h,t.food_log.entries.length);console.log("done calling openFoodEntryBox",P),console.log("day.food_log.entries",t.food_log.entries),e(2,t.food_log.entries=[...t.food_log.entries],t),C()},b=async f=>{const h=await D(t.food_log.entries[f],f);console.log("edit_food_log_entry is done calling openFoodEntryBox",h),console.log("day.food_log.entries",t.food_log.entries),e(2,t.food_log.entries=[...t.food_log.entries],t),C()},k=({detail:f})=>{const{from:h,to:P}=f,F=t.food_log.entries.splice(h,1)[0];t.food_log.entries.splice(P,0,F),f.complete(),console.log("reorder_food_log: day",t),C()},D=async(f,h)=>{const P=await Ne.create({component:Ue,componentProps:{entry:f},showBackdrop:!0,backdropDismiss:!0});await P.present();const{data:F}=await P.onWillDismiss();return(F==null?void 0:F.data)!==null?(F.data.deleted?t.food_log.entries.splice(h,1):e(2,t.food_log.entries[h]=F.data,t),console.log("*** day.food_log.entries",t.food_log.entries),!0):!1};return[c,p,t,A,C,M,g,y,b,k,()=>{g()},()=>{e(1,p="edit")},()=>{e(1,p="view"),c==="add"&&g()},()=>{C()},f=>{b(f)}]}class ot extends De{constructor(o){super(),Se(this,o,Ge,Ye,qe,{})}}export{ot as default};
