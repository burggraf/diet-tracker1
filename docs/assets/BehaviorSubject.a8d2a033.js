import{_ as q,O as ne,P as J,Q as z,R as U}from"./index.578304cd.js";const De="1.35.7",Ee={"X-Client-Info":`supabase-js/${De}`},Ne="supabase.auth.token";function Le(i){return i.replace(/\/$/,"")}const Me=()=>typeof window!="undefined",Be="1.23.1",Fe="http://localhost:9999",Ge={"X-Client-Info":`gotrue-js/${Be}`},M=10,$={ERROR_MESSAGE:"Request Failed",MAX_RETRIES:10,RETRY_INTERVAL:2},P="supabase.auth.token",He={name:"sb",lifetime:60*60*8,domain:"",path:"/",sameSite:"lax"};var D=globalThis&&globalThis.__awaiter||function(i,t,e,r){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(l){o(l)}}function h(c){try{u(r.throw(c))}catch(l){o(l)}}function u(c){c.done?s(c.value):n(c.value).then(a,h)}u((r=r.apply(i,t||[])).next())})};const Je=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),ze=(i,t)=>{if(!(i!=null&&i.status))return t({message:$.ERROR_MESSAGE});if(typeof i.json!="function")return t(i);i.json().then(e=>t({message:Je(e),status:(i==null?void 0:i.status)||500}))},qe=(i,t,e)=>{const r={method:i,headers:(t==null?void 0:t.headers)||{}};return i==="GET"||(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),r.body=JSON.stringify(e)),r};function W(i,t,e,r,n){return D(this,void 0,void 0,function*(){return new Promise((s,o)=>{i(e,qe(t,r,n)).then(a=>{if(!a.ok)throw a;return r!=null&&r.noResolveJson?s:a.json()}).then(a=>s(a)).catch(a=>ze(a,o))})})}function Z(i,t,e){return D(this,void 0,void 0,function*(){return W(i,"GET",t,e)})}function v(i,t,e,r){return D(this,void 0,void 0,function*(){return W(i,"POST",t,r,e)})}function ve(i,t,e,r){return D(this,void 0,void 0,function*(){return W(i,"PUT",t,r,e)})}function We(i,t,e,r){return D(this,void 0,void 0,function*(){return W(i,"DELETE",t,r,e)})}function Ke(i,t,e){const r=e||{},n=encodeURIComponent,s=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;if(typeof n!="function")throw new TypeError("option encode is invalid");if(!s.test(i))throw new TypeError("argument name is invalid");const o=n(t);if(o&&!s.test(o))throw new TypeError("argument val is invalid");let a=i+"="+o;if(r.maxAge!=null){const h=r.maxAge-0;if(isNaN(h)||!isFinite(h))throw new TypeError("option maxAge is invalid");a+="; Max-Age="+Math.floor(h)}if(r.domain){if(!s.test(r.domain))throw new TypeError("option domain is invalid");a+="; Domain="+r.domain}if(r.path){if(!s.test(r.path))throw new TypeError("option path is invalid");a+="; Path="+r.path}if(r.expires){if(typeof r.expires.toUTCString!="function")throw new TypeError("option expires is invalid");a+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(a+="; HttpOnly"),r.secure&&(a+="; Secure"),r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return a}function Ve(i){if(!i||!i.headers||!i.headers.host)throw new Error('The "host" request header is not available');const t=i.headers.host.indexOf(":")>-1&&i.headers.host.split(":")[0]||i.headers.host;return!(["localhost","127.0.0.1"].indexOf(t)>-1||t.endsWith(".local"))}function Ye(i,t){var e,r,n;return Ke(i.name,i.value,{maxAge:i.maxAge,expires:new Date(Date.now()+i.maxAge*1e3),httpOnly:!0,secure:t,path:(e=i.path)!==null&&e!==void 0?e:"/",domain:(r=i.domain)!==null&&r!==void 0?r:"",sameSite:(n=i.sameSite)!==null&&n!==void 0?n:"lax"})}function se(i,t,e){const r=e.map(s=>Ye(s,Ve(i))),n=t.getHeader("Set-Cookie");return n&&(n instanceof Array?Array.prototype.push.apply(r,n):typeof n=="string"&&r.push(n)),r}function B(i,t,e){t.setHeader("Set-Cookie",se(i,t,e))}var K=globalThis&&globalThis.__awaiter||function(i,t,e,r){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(l){o(l)}}function h(c){try{u(r.throw(c))}catch(l){o(l)}}function u(c){c.done?s(c.value):n(c.value).then(a,h)}u((r=r.apply(i,t||[])).next())})};function k(i){return Math.round(Date.now()/1e3)+i}function Xe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const t=Math.random()*16|0;return(i=="x"?t:t&3|8).toString(16)})}const E=()=>typeof window!="undefined";function S(i,t){var e;t||(t=((e=window==null?void 0:window.location)===null||e===void 0?void 0:e.href)||""),i=i.replace(/[\[\]]/g,"\\$&");const r=new RegExp("[?&#]"+i+"(=([^&#]*)|&|#|$)"),n=r.exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}const Qe=i=>{let t;return i?t=i:typeof fetch=="undefined"?t=(...e)=>K(void 0,void 0,void 0,function*(){return yield(yield q(()=>import("./browser-ponyfill.34bdb024.js").then(function(r){return r.b}),[])).fetch(...e)}):t=fetch,(...e)=>t(...e)},Ze=(i,t,e)=>K(void 0,void 0,void 0,function*(){E()&&(yield i==null?void 0:i.setItem(t,JSON.stringify(e)))}),et=(i,t)=>K(void 0,void 0,void 0,function*(){const e=E()&&(yield i==null?void 0:i.getItem(t));if(!e)return null;try{return JSON.parse(e)}catch{return e}}),tt=(i,t)=>{const e=E()&&(i==null?void 0:i.getItem(t));if(!e||typeof e!="string")return null;try{return JSON.parse(e)}catch{return e}},rt=(i,t)=>K(void 0,void 0,void 0,function*(){E()&&(yield i==null?void 0:i.removeItem(t))});var f=globalThis&&globalThis.__awaiter||function(i,t,e,r){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(l){o(l)}}function h(c){try{u(r.throw(c))}catch(l){o(l)}}function u(c){c.done?s(c.value):n(c.value).then(a,h)}u((r=r.apply(i,t||[])).next())})};class it{constructor({url:t="",headers:e={},cookieOptions:r,fetch:n}){this.url=t,this.headers=e,this.cookieOptions=Object.assign(Object.assign({},He),r),this.fetch=Qe(n)}_createRequestHeaders(t){const e=Object.assign({},this.headers);return e.Authorization=`Bearer ${t}`,e}cookieName(){var t;return(t=this.cookieOptions.name)!==null&&t!==void 0?t:""}getUrlForProvider(t,e){const r=[`provider=${encodeURIComponent(t)}`];if(e!=null&&e.redirectTo&&r.push(`redirect_to=${encodeURIComponent(e.redirectTo)}`),e!=null&&e.scopes&&r.push(`scopes=${encodeURIComponent(e.scopes)}`),e!=null&&e.queryParams){const n=new URLSearchParams(e.queryParams);r.push(`${n}`)}return`${this.url}/authorize?${r.join("&")}`}signUpWithEmail(t,e,r={}){return f(this,void 0,void 0,function*(){try{const n=Object.assign({},this.headers);let s="";r.redirectTo&&(s="?redirect_to="+encodeURIComponent(r.redirectTo));const o=yield v(this.fetch,`${this.url}/signup${s}`,{email:t,password:e,data:r.data,gotrue_meta_security:{captcha_token:r.captchaToken}},{headers:n}),a=Object.assign({},o);return a.expires_in&&(a.expires_at=k(o.expires_in)),{data:a,error:null}}catch(n){return{data:null,error:n}}})}signInWithEmail(t,e,r={}){return f(this,void 0,void 0,function*(){try{const n=Object.assign({},this.headers);let s="?grant_type=password";r.redirectTo&&(s+="&redirect_to="+encodeURIComponent(r.redirectTo));const o=yield v(this.fetch,`${this.url}/token${s}`,{email:t,password:e,gotrue_meta_security:{captcha_token:r.captchaToken}},{headers:n}),a=Object.assign({},o);return a.expires_in&&(a.expires_at=k(o.expires_in)),{data:a,error:null}}catch(n){return{data:null,error:n}}})}signUpWithPhone(t,e,r={}){return f(this,void 0,void 0,function*(){try{const n=Object.assign({},this.headers),s=yield v(this.fetch,`${this.url}/signup`,{phone:t,password:e,data:r.data,gotrue_meta_security:{captcha_token:r.captchaToken}},{headers:n}),o=Object.assign({},s);return o.expires_in&&(o.expires_at=k(s.expires_in)),{data:o,error:null}}catch(n){return{data:null,error:n}}})}signInWithPhone(t,e,r={}){return f(this,void 0,void 0,function*(){try{const n=Object.assign({},this.headers),s="?grant_type=password",o=yield v(this.fetch,`${this.url}/token${s}`,{phone:t,password:e,gotrue_meta_security:{captcha_token:r.captchaToken}},{headers:n}),a=Object.assign({},o);return a.expires_in&&(a.expires_at=k(o.expires_in)),{data:a,error:null}}catch(n){return{data:null,error:n}}})}signInWithOpenIDConnect({id_token:t,nonce:e,client_id:r,issuer:n,provider:s}){return f(this,void 0,void 0,function*(){try{const o=Object.assign({},this.headers),a="?grant_type=id_token",h=yield v(this.fetch,`${this.url}/token${a}`,{id_token:t,nonce:e,client_id:r,issuer:n,provider:s},{headers:o}),u=Object.assign({},h);return u.expires_in&&(u.expires_at=k(h.expires_in)),{data:u,error:null}}catch(o){return{data:null,error:o}}})}sendMagicLinkEmail(t,e={}){var r;return f(this,void 0,void 0,function*(){try{const n=Object.assign({},this.headers);let s="";e.redirectTo&&(s+="?redirect_to="+encodeURIComponent(e.redirectTo));const o=(r=e.shouldCreateUser)!==null&&r!==void 0?r:!0;return{data:yield v(this.fetch,`${this.url}/otp${s}`,{email:t,create_user:o,gotrue_meta_security:{captcha_token:e.captchaToken}},{headers:n}),error:null}}catch(n){return{data:null,error:n}}})}sendMobileOTP(t,e={}){var r;return f(this,void 0,void 0,function*(){try{const n=(r=e.shouldCreateUser)!==null&&r!==void 0?r:!0,s=Object.assign({},this.headers);return{data:yield v(this.fetch,`${this.url}/otp`,{phone:t,create_user:n,gotrue_meta_security:{captcha_token:e.captchaToken}},{headers:s}),error:null}}catch(n){return{data:null,error:n}}})}signOut(t){return f(this,void 0,void 0,function*(){try{return yield v(this.fetch,`${this.url}/logout`,{},{headers:this._createRequestHeaders(t),noResolveJson:!0}),{error:null}}catch(e){return{error:e}}})}verifyMobileOTP(t,e,r={}){return f(this,void 0,void 0,function*(){try{const n=Object.assign({},this.headers),s=yield v(this.fetch,`${this.url}/verify`,{phone:t,token:e,type:"sms",redirect_to:r.redirectTo},{headers:n}),o=Object.assign({},s);return o.expires_in&&(o.expires_at=k(s.expires_in)),{data:o,error:null}}catch(n){return{data:null,error:n}}})}verifyOTP({email:t,phone:e,token:r,type:n="sms"},s={}){return f(this,void 0,void 0,function*(){try{const o=Object.assign({},this.headers),a=yield v(this.fetch,`${this.url}/verify`,{email:t,phone:e,token:r,type:n,redirect_to:s.redirectTo},{headers:o}),h=Object.assign({},a);return h.expires_in&&(h.expires_at=k(a.expires_in)),{data:h,error:null}}catch(o){return{data:null,error:o}}})}inviteUserByEmail(t,e={}){return f(this,void 0,void 0,function*(){try{const r=Object.assign({},this.headers);let n="";return e.redirectTo&&(n+="?redirect_to="+encodeURIComponent(e.redirectTo)),{data:yield v(this.fetch,`${this.url}/invite${n}`,{email:t,data:e.data},{headers:r}),error:null}}catch(r){return{data:null,error:r}}})}resetPasswordForEmail(t,e={}){return f(this,void 0,void 0,function*(){try{const r=Object.assign({},this.headers);let n="";return e.redirectTo&&(n+="?redirect_to="+encodeURIComponent(e.redirectTo)),{data:yield v(this.fetch,`${this.url}/recover${n}`,{email:t,gotrue_meta_security:{captcha_token:e.captchaToken}},{headers:r}),error:null}}catch(r){return{data:null,error:r}}})}refreshAccessToken(t){return f(this,void 0,void 0,function*(){try{const e=yield v(this.fetch,`${this.url}/token?grant_type=refresh_token`,{refresh_token:t},{headers:this.headers}),r=Object.assign({},e);return r.expires_in&&(r.expires_at=k(e.expires_in)),{data:r,error:null}}catch(e){return{data:null,error:e}}})}setAuthCookie(t,e){t.method!=="POST"&&(e.setHeader("Allow","POST"),e.status(405).end("Method Not Allowed"));const{event:r,session:n}=t.body;if(!r)throw new Error("Auth event missing!");if(r==="SIGNED_IN"){if(!n)throw new Error("Auth session missing!");B(t,e,[{key:"access-token",value:n.access_token},{key:"refresh-token",value:n.refresh_token}].map(s=>{var o;return{name:`${this.cookieName()}-${s.key}`,value:s.value,domain:this.cookieOptions.domain,maxAge:(o=this.cookieOptions.lifetime)!==null&&o!==void 0?o:0,path:this.cookieOptions.path,sameSite:this.cookieOptions.sameSite}}))}r==="SIGNED_OUT"&&B(t,e,["access-token","refresh-token"].map(s=>({name:`${this.cookieName()}-${s}`,value:"",maxAge:-1}))),e.status(200).json({})}deleteAuthCookie(t,e,{redirectTo:r="/"}){return B(t,e,["access-token","refresh-token"].map(n=>({name:`${this.cookieName()}-${n}`,value:"",maxAge:-1}))),e.redirect(307,r)}getAuthCookieString(t,e){t.method!=="POST"&&(e.setHeader("Allow","POST"),e.status(405).end("Method Not Allowed"));const{event:r,session:n}=t.body;if(!r)throw new Error("Auth event missing!");if(r==="SIGNED_IN"){if(!n)throw new Error("Auth session missing!");return se(t,e,[{key:"access-token",value:n.access_token},{key:"refresh-token",value:n.refresh_token}].map(s=>{var o;return{name:`${this.cookieName()}-${s.key}`,value:s.value,domain:this.cookieOptions.domain,maxAge:(o=this.cookieOptions.lifetime)!==null&&o!==void 0?o:0,path:this.cookieOptions.path,sameSite:this.cookieOptions.sameSite}}))}return r==="SIGNED_OUT"?se(t,e,["access-token","refresh-token"].map(s=>({name:`${this.cookieName()}-${s}`,value:"",maxAge:-1}))):e.getHeader("Set-Cookie")}generateLink(t,e,r={}){return f(this,void 0,void 0,function*(){try{return{data:yield v(this.fetch,`${this.url}/admin/generate_link`,{type:t,email:e,password:r.password,data:r.data,redirect_to:r.redirectTo},{headers:this.headers}),error:null}}catch(n){return{data:null,error:n}}})}createUser(t){return f(this,void 0,void 0,function*(){try{const e=yield v(this.fetch,`${this.url}/admin/users`,t,{headers:this.headers});return{user:e,data:e,error:null}}catch(e){return{user:null,data:null,error:e}}})}listUsers(){return f(this,void 0,void 0,function*(){try{return{data:(yield Z(this.fetch,`${this.url}/admin/users`,{headers:this.headers})).users,error:null}}catch(t){return{data:null,error:t}}})}getUserById(t){return f(this,void 0,void 0,function*(){try{return{data:yield Z(this.fetch,`${this.url}/admin/users/${t}`,{headers:this.headers}),error:null}}catch(e){return{data:null,error:e}}})}getUserByCookie(t,e){return f(this,void 0,void 0,function*(){try{if(!t.cookies)throw new Error("Not able to parse cookies! When using Express make sure the cookie-parser middleware is in use!");const r=t.cookies[`${this.cookieName()}-access-token`],n=t.cookies[`${this.cookieName()}-refresh-token`];if(!r)throw new Error("No cookie found!");const{user:s,error:o}=yield this.getUser(r);if(o){if(!n)throw new Error("No refresh_token cookie found!");if(!e)throw new Error("You need to pass the res object to automatically refresh the session!");const{data:a,error:h}=yield this.refreshAccessToken(n);if(h)throw h;if(a)return B(t,e,[{key:"access-token",value:a.access_token},{key:"refresh-token",value:a.refresh_token}].map(u=>{var c;return{name:`${this.cookieName()}-${u.key}`,value:u.value,domain:this.cookieOptions.domain,maxAge:(c=this.cookieOptions.lifetime)!==null&&c!==void 0?c:0,path:this.cookieOptions.path,sameSite:this.cookieOptions.sameSite}})),{token:a.access_token,user:a.user,data:a.user,error:null}}return{token:r,user:s,data:s,error:null}}catch(r){return{token:null,user:null,data:null,error:r}}})}updateUserById(t,e){return f(this,void 0,void 0,function*(){try{const r=yield ve(this.fetch,`${this.url}/admin/users/${t}`,e,{headers:this.headers});return{user:r,data:r,error:null}}catch(r){return{user:null,data:null,error:r}}})}deleteUser(t){return f(this,void 0,void 0,function*(){try{const e=yield We(this.fetch,`${this.url}/admin/users/${t}`,{},{headers:this.headers});return{user:e,data:e,error:null}}catch(e){return{user:null,data:null,error:e}}})}getUser(t){return f(this,void 0,void 0,function*(){try{const e=yield Z(this.fetch,`${this.url}/user`,{headers:this._createRequestHeaders(t)});return{user:e,data:e,error:null}}catch(e){return{user:null,data:null,error:e}}})}updateUser(t,e){return f(this,void 0,void 0,function*(){try{const r=yield ve(this.fetch,`${this.url}/user`,e,{headers:this._createRequestHeaders(t)});return{user:r,data:r,error:null}}catch(r){return{user:null,data:null,error:r}}})}}function nt(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self!="undefined"&&(self.globalThis=self)}}var m=globalThis&&globalThis.__awaiter||function(i,t,e,r){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(l){o(l)}}function h(c){try{u(r.throw(c))}catch(l){o(l)}}function u(c){c.done?s(c.value):n(c.value).then(a,h)}u((r=r.apply(i,t||[])).next())})};nt();const st={url:Fe,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,multiTab:!0,headers:Ge};class ot{constructor(t){this.stateChangeEmitters=new Map,this.networkRetries=0;const e=Object.assign(Object.assign({},st),t);this.currentUser=null,this.currentSession=null,this.autoRefreshToken=e.autoRefreshToken,this.persistSession=e.persistSession,this.multiTab=e.multiTab,this.localStorage=e.localStorage||globalThis.localStorage,this.api=new it({url:e.url,headers:e.headers,cookieOptions:e.cookieOptions,fetch:e.fetch}),this._recoverSession(),this._recoverAndRefresh(),this._listenForMultiTabEvents(),this._handleVisibilityChange(),e.detectSessionInUrl&&E()&&!!S("access_token")&&this.getSessionFromUrl({storeSession:!0}).then(({error:r})=>{if(r)throw new Error("Error getting session from URL.")})}signUp({email:t,password:e,phone:r},n={}){return m(this,void 0,void 0,function*(){try{this._removeSession();const{data:s,error:o}=r&&e?yield this.api.signUpWithPhone(r,e,{data:n.data,captchaToken:n.captchaToken}):yield this.api.signUpWithEmail(t,e,{redirectTo:n.redirectTo,data:n.data,captchaToken:n.captchaToken});if(o)throw o;if(!s)throw"An error occurred on sign up.";let a=null,h=null;return s.access_token&&(a=s,h=a.user,this._saveSession(a),this._notifyAllSubscribers("SIGNED_IN")),s.id&&(h=s),{user:h,session:a,error:null}}catch(s){return{user:null,session:null,error:s}}})}signIn({email:t,phone:e,password:r,refreshToken:n,provider:s,oidc:o},a={}){return m(this,void 0,void 0,function*(){try{if(this._removeSession(),t&&!r){const{error:h}=yield this.api.sendMagicLinkEmail(t,{redirectTo:a.redirectTo,shouldCreateUser:a.shouldCreateUser,captchaToken:a.captchaToken});return{user:null,session:null,error:h}}if(t&&r)return this._handleEmailSignIn(t,r,{redirectTo:a.redirectTo,captchaToken:a.captchaToken});if(e&&!r){const{error:h}=yield this.api.sendMobileOTP(e,{shouldCreateUser:a.shouldCreateUser,captchaToken:a.captchaToken});return{user:null,session:null,error:h}}if(e&&r)return this._handlePhoneSignIn(e,r);if(n){const{error:h}=yield this._callRefreshToken(n);if(h)throw h;return{user:this.currentUser,session:this.currentSession,error:null}}if(s)return this._handleProviderSignIn(s,{redirectTo:a.redirectTo,scopes:a.scopes,queryParams:a.queryParams});if(o)return this._handleOpenIDConnectSignIn(o);throw new Error("You must provide either an email, phone number, a third-party provider or OpenID Connect.")}catch(h){return{user:null,session:null,error:h}}})}verifyOTP(t,e={}){return m(this,void 0,void 0,function*(){try{this._removeSession();const{data:r,error:n}=yield this.api.verifyOTP(t,e);if(n)throw n;if(!r)throw"An error occurred on token verification.";let s=null,o=null;return r.access_token&&(s=r,o=s.user,this._saveSession(s),this._notifyAllSubscribers("SIGNED_IN")),r.id&&(o=r),{user:o,session:s,error:null}}catch(r){return{user:null,session:null,error:r}}})}user(){return this.currentUser}session(){return this.currentSession}refreshSession(){var t;return m(this,void 0,void 0,function*(){try{if(!(!((t=this.currentSession)===null||t===void 0)&&t.access_token))throw new Error("Not logged in.");const{error:e}=yield this._callRefreshToken();if(e)throw e;return{data:this.currentSession,user:this.currentUser,error:null}}catch(e){return{data:null,user:null,error:e}}})}update(t){var e;return m(this,void 0,void 0,function*(){try{if(!(!((e=this.currentSession)===null||e===void 0)&&e.access_token))throw new Error("Not logged in.");const{user:r,error:n}=yield this.api.updateUser(this.currentSession.access_token,t);if(n)throw n;if(!r)throw Error("Invalid user data.");const s=Object.assign(Object.assign({},this.currentSession),{user:r});return this._saveSession(s),this._notifyAllSubscribers("USER_UPDATED"),{data:r,user:r,error:null}}catch(r){return{data:null,user:null,error:r}}})}setSession(t){return m(this,void 0,void 0,function*(){try{if(!t)throw new Error("No current session.");const{data:e,error:r}=yield this.api.refreshAccessToken(t);return r?{session:null,error:r}:(this._saveSession(e),this._notifyAllSubscribers("SIGNED_IN"),{session:e,error:null})}catch(e){return{error:e,session:null}}})}setAuth(t){return this.currentSession=Object.assign(Object.assign({},this.currentSession),{access_token:t,token_type:"bearer",user:this.user()}),this._notifyAllSubscribers("TOKEN_REFRESHED"),this.currentSession}getSessionFromUrl(t){return m(this,void 0,void 0,function*(){try{if(!E())throw new Error("No browser detected.");const e=S("error_description");if(e)throw new Error(e);const r=S("provider_token"),n=S("provider_refresh_token"),s=S("access_token");if(!s)throw new Error("No access_token detected.");const o=S("expires_in");if(!o)throw new Error("No expires_in detected.");const a=S("refresh_token");if(!a)throw new Error("No refresh_token detected.");const h=S("token_type");if(!h)throw new Error("No token_type detected.");const c=Math.round(Date.now()/1e3)+parseInt(o),{user:l,error:g}=yield this.api.getUser(s);if(g)throw g;const y={provider_token:r,provider_refresh_token:n,access_token:s,expires_in:parseInt(o),expires_at:c,refresh_token:a,token_type:h,user:l};if(t!=null&&t.storeSession){this._saveSession(y);const L=S("type");this._notifyAllSubscribers("SIGNED_IN"),L==="recovery"&&this._notifyAllSubscribers("PASSWORD_RECOVERY")}return window.location.hash="",{data:y,error:null}}catch(e){return{data:null,error:e}}})}signOut(){var t;return m(this,void 0,void 0,function*(){const e=(t=this.currentSession)===null||t===void 0?void 0:t.access_token;if(this._removeSession(),this._notifyAllSubscribers("SIGNED_OUT"),e){const{error:r}=yield this.api.signOut(e);if(r)return{error:r}}return{error:null}})}onAuthStateChange(t){try{const e=Xe(),r={id:e,callback:t,unsubscribe:()=>{this.stateChangeEmitters.delete(e)}};return this.stateChangeEmitters.set(e,r),{data:r,error:null}}catch(e){return{data:null,error:e}}}_handleEmailSignIn(t,e,r={}){var n,s;return m(this,void 0,void 0,function*(){try{const{data:o,error:a}=yield this.api.signInWithEmail(t,e,{redirectTo:r.redirectTo,captchaToken:r.captchaToken});return a||!o?{data:null,user:null,session:null,error:a}:((((n=o==null?void 0:o.user)===null||n===void 0?void 0:n.confirmed_at)||((s=o==null?void 0:o.user)===null||s===void 0?void 0:s.email_confirmed_at))&&(this._saveSession(o),this._notifyAllSubscribers("SIGNED_IN")),{data:o,user:o.user,session:o,error:null})}catch(o){return{data:null,user:null,session:null,error:o}}})}_handlePhoneSignIn(t,e,r={}){var n;return m(this,void 0,void 0,function*(){try{const{data:s,error:o}=yield this.api.signInWithPhone(t,e,r);return o||!s?{data:null,user:null,session:null,error:o}:(!((n=s==null?void 0:s.user)===null||n===void 0)&&n.phone_confirmed_at&&(this._saveSession(s),this._notifyAllSubscribers("SIGNED_IN")),{data:s,user:s.user,session:s,error:null})}catch(s){return{data:null,user:null,session:null,error:s}}})}_handleProviderSignIn(t,e={}){const r=this.api.getUrlForProvider(t,{redirectTo:e.redirectTo,scopes:e.scopes,queryParams:e.queryParams});try{return E()&&(window.location.href=r),{provider:t,url:r,data:null,session:null,user:null,error:null}}catch(n){return r?{provider:t,url:r,data:null,session:null,user:null,error:null}:{data:null,user:null,session:null,error:n}}}_handleOpenIDConnectSignIn({id_token:t,nonce:e,client_id:r,issuer:n,provider:s}){return m(this,void 0,void 0,function*(){if(t&&e&&(r&&n||s))try{const{data:o,error:a}=yield this.api.signInWithOpenIDConnect({id_token:t,nonce:e,client_id:r,issuer:n,provider:s});return a||!o?{user:null,session:null,error:a}:(this._saveSession(o),this._notifyAllSubscribers("SIGNED_IN"),{user:o.user,session:o,error:null})}catch(o){return{user:null,session:null,error:o}}throw new Error("You must provide a OpenID Connect provider with your id token and nonce.")})}_recoverSession(){try{const t=tt(this.localStorage,P);if(!t)return null;const{currentSession:e,expiresAt:r}=t,n=Math.round(Date.now()/1e3);r>=n+M&&(e==null?void 0:e.user)&&(this._saveSession(e),this._notifyAllSubscribers("SIGNED_IN"))}catch(t){console.log("error",t)}}_recoverAndRefresh(){return m(this,void 0,void 0,function*(){try{const t=yield et(this.localStorage,P);if(!t)return null;const{currentSession:e,expiresAt:r}=t,n=Math.round(Date.now()/1e3);if(r<n+M)if(this.autoRefreshToken&&e.refresh_token){this.networkRetries++;const{error:s}=yield this._callRefreshToken(e.refresh_token);if(s){if(console.log(s.message),s.message===$.ERROR_MESSAGE&&this.networkRetries<$.MAX_RETRIES){this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),this.refreshTokenTimer=setTimeout(()=>this._recoverAndRefresh(),Math.pow($.RETRY_INTERVAL,this.networkRetries)*100);return}yield this._removeSession()}this.networkRetries=0}else this._removeSession();else e?(this._saveSession(e),this._notifyAllSubscribers("SIGNED_IN")):(console.log("Current session is missing data."),this._removeSession())}catch(t){return console.error(t),null}})}_callRefreshToken(t){var e;return t===void 0&&(t=(e=this.currentSession)===null||e===void 0?void 0:e.refresh_token),m(this,void 0,void 0,function*(){try{if(!t)throw new Error("No current session.");const{data:r,error:n}=yield this.api.refreshAccessToken(t);if(n)throw n;if(!r)throw Error("Invalid session data.");return this._saveSession(r),this._notifyAllSubscribers("TOKEN_REFRESHED"),this._notifyAllSubscribers("SIGNED_IN"),{data:r,error:null}}catch(r){return{data:null,error:r}}})}_notifyAllSubscribers(t){this.stateChangeEmitters.forEach(e=>e.callback(t,this.currentSession))}_saveSession(t){this.currentSession=t,this.currentUser=t.user;const e=t.expires_at;if(e){const r=Math.round(Date.now()/1e3),n=e-r,s=n>M?M:.5;this._startAutoRefreshToken((n-s)*1e3)}this.persistSession&&t.expires_at&&this._persistSession(this.currentSession)}_persistSession(t){const e={currentSession:t,expiresAt:t.expires_at};Ze(this.localStorage,P,e)}_removeSession(){return m(this,void 0,void 0,function*(){this.currentSession=null,this.currentUser=null,this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),rt(this.localStorage,P)})}_startAutoRefreshToken(t){this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),!(t<=0||!this.autoRefreshToken)&&(this.refreshTokenTimer=setTimeout(()=>m(this,void 0,void 0,function*(){this.networkRetries++;const{error:e}=yield this._callRefreshToken();e||(this.networkRetries=0),(e==null?void 0:e.message)===$.ERROR_MESSAGE&&this.networkRetries<$.MAX_RETRIES&&this._startAutoRefreshToken(Math.pow($.RETRY_INTERVAL,this.networkRetries)*100)}),t),typeof this.refreshTokenTimer.unref=="function"&&this.refreshTokenTimer.unref())}_listenForMultiTabEvents(){if(!this.multiTab||!E()||!(window!=null&&window.addEventListener))return!1;try{window==null||window.addEventListener("storage",t=>{var e;if(t.key===P){const r=JSON.parse(String(t.newValue));!((e=r==null?void 0:r.currentSession)===null||e===void 0)&&e.access_token?(this._saveSession(r.currentSession),this._notifyAllSubscribers("SIGNED_IN")):(this._removeSession(),this._notifyAllSubscribers("SIGNED_OUT"))}})}catch(t){console.error("_listenForMultiTabEvents",t)}}_handleVisibilityChange(){if(!this.multiTab||!E()||!(window!=null&&window.addEventListener))return!1;try{window==null||window.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&this._recoverAndRefresh()})}catch(t){console.error("_handleVisibilityChange",t)}}}class at extends ot{constructor(t){super(t)}}var me=globalThis&&globalThis.__awaiter||function(i,t,e,r){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(l){o(l)}}function h(c){try{u(r.throw(c))}catch(l){o(l)}}function u(c){c.done?s(c.value):n(c.value).then(a,h)}u((r=r.apply(i,t||[])).next())})};class de{constructor(t){Object.assign(this,t);let e;t.fetch?e=t.fetch:typeof fetch=="undefined"?e=(...r)=>me(this,void 0,void 0,function*(){return yield(yield q(()=>import("./browser-ponyfill.34bdb024.js").then(function(n){return n.b}),[])).fetch(...r)}):e=fetch,this.fetch=(...r)=>e(...r),this.shouldThrowOnError=t.shouldThrowOnError||!1,this.allowEmpty=t.allowEmpty||!1}throwOnError(t){return t==null&&(t=!0),this.shouldThrowOnError=t,this}then(t,e){typeof this.schema=="undefined"||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");let r=this.fetch(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(n=>me(this,void 0,void 0,function*(){var s,o,a,h;let u=null,c=null,l=null,g=n.status,y=n.statusText;if(n.ok){const p=(s=this.headers.Prefer)===null||s===void 0?void 0:s.split(",").includes("return=minimal");if(this.method!=="HEAD"&&!p){const Q=yield n.text();Q&&(this.headers.Accept==="text/csv"?c=Q:c=JSON.parse(Q))}const pe=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),X=(a=n.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");pe&&X&&X.length>1&&(l=parseInt(X[1]))}else{const p=yield n.text();try{u=JSON.parse(p)}catch{u={message:p}}if(u&&this.allowEmpty&&((h=u==null?void 0:u.details)===null||h===void 0?void 0:h.includes("Results contain 0 rows"))&&(u=null,g=200,y="OK"),u&&this.shouldThrowOnError)throw u}return{error:u,data:c,count:l,status:g,statusText:y,body:c}}));return this.shouldThrowOnError||(r=r.catch(n=>({error:{message:`FetchError: ${n.message}`,details:"",hint:"",code:n.code||""},data:null,body:null,count:null,status:400,statusText:"Bad Request"}))),r.then(t,e)}}class ct extends de{select(t="*"){let e=!1;const r=t.split("").map(n=>/\s/.test(n)&&!e?"":(n==='"'&&(e=!e),n)).join("");return this.url.searchParams.set("select",r),this}order(t,{ascending:e=!0,nullsFirst:r=!1,foreignTable:n}={}){const s=typeof n=="undefined"?"order":`${n}.order`,o=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${o?`${o},`:""}${t}.${e?"asc":"desc"}.${r?"nullsfirst":"nullslast"}`),this}limit(t,{foreignTable:e}={}){const r=typeof e=="undefined"?"limit":`${e}.limit`;return this.url.searchParams.set(r,`${t}`),this}range(t,e,{foreignTable:r}={}){const n=typeof r=="undefined"?"offset":`${r}.offset`,s=typeof r=="undefined"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${t}`),this.url.searchParams.set(s,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.headers.Accept="application/vnd.pgrst.object+json",this.allowEmpty=!0,this}csv(){return this.headers.Accept="text/csv",this}}class A extends ct{constructor(){super(...arguments),this.cs=this.contains,this.cd=this.containedBy,this.sl=this.rangeLt,this.sr=this.rangeGt,this.nxl=this.rangeGte,this.nxr=this.rangeLte,this.adj=this.rangeAdjacent,this.ov=this.overlaps}not(t,e,r){return this.url.searchParams.append(`${t}`,`not.${e}.${r}`),this}or(t,{foreignTable:e}={}){const r=typeof e=="undefined"?"or":`${e}.or`;return this.url.searchParams.append(r,`(${t})`),this}eq(t,e){return this.url.searchParams.append(`${t}`,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(`${t}`,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(`${t}`,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(`${t}`,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(`${t}`,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(`${t}`,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(`${t}`,`like.${e}`),this}ilike(t,e){return this.url.searchParams.append(`${t}`,`ilike.${e}`),this}is(t,e){return this.url.searchParams.append(`${t}`,`is.${e}`),this}in(t,e){const r=e.map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(`${t}`,`in.(${r})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(`${t}`,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(`${t}`,`cs.{${e.join(",")}}`):this.url.searchParams.append(`${t}`,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(`${t}`,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(`${t}`,`cd.{${e.join(",")}}`):this.url.searchParams.append(`${t}`,`cd.${JSON.stringify(e)}`),this}rangeLt(t,e){return this.url.searchParams.append(`${t}`,`sl.${e}`),this}rangeGt(t,e){return this.url.searchParams.append(`${t}`,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(`${t}`,`nxl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(`${t}`,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(`${t}`,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(`${t}`,`ov.${e}`):this.url.searchParams.append(`${t}`,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:r,type:n=null}={}){let s="";n==="plain"?s="pl":n==="phrase"?s="ph":n==="websearch"&&(s="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(`${t}`,`${s}fts${o}.${e}`),this}fts(t,e,{config:r}={}){const n=typeof r=="undefined"?"":`(${r})`;return this.url.searchParams.append(`${t}`,`fts${n}.${e}`),this}plfts(t,e,{config:r}={}){const n=typeof r=="undefined"?"":`(${r})`;return this.url.searchParams.append(`${t}`,`plfts${n}.${e}`),this}phfts(t,e,{config:r}={}){const n=typeof r=="undefined"?"":`(${r})`;return this.url.searchParams.append(`${t}`,`phfts${n}.${e}`),this}wfts(t,e,{config:r}={}){const n=typeof r=="undefined"?"":`(${r})`;return this.url.searchParams.append(`${t}`,`wfts${n}.${e}`),this}filter(t,e,r){return this.url.searchParams.append(`${t}`,`${e}.${r}`),this}match(t){return Object.keys(t).forEach(e=>{this.url.searchParams.append(`${e}`,`eq.${t[e]}`)}),this}}class Te extends de{constructor(t,{headers:e={},schema:r,fetch:n,shouldThrowOnError:s}={}){super({fetch:n,shouldThrowOnError:s}),this.url=new URL(t),this.headers=Object.assign({},e),this.schema=r}select(t="*",{head:e=!1,count:r=null}={}){this.method="GET";let n=!1;const s=t.split("").map(o=>/\s/.test(o)&&!n?"":(o==='"'&&(n=!n),o)).join("");return this.url.searchParams.set("select",s),r&&(this.headers.Prefer=`count=${r}`),e&&(this.method="HEAD"),new A(this)}insert(t,{upsert:e=!1,onConflict:r,returning:n="representation",count:s=null}={}){this.method="POST";const o=[`return=${n}`];if(e&&o.push("resolution=merge-duplicates"),e&&r!==void 0&&this.url.searchParams.set("on_conflict",r),this.body=t,s&&o.push(`count=${s}`),this.headers.Prefer&&o.unshift(this.headers.Prefer),this.headers.Prefer=o.join(","),Array.isArray(t)){const a=t.reduce((h,u)=>h.concat(Object.keys(u)),[]);if(a.length>0){const h=[...new Set(a)].map(u=>`"${u}"`);this.url.searchParams.set("columns",h.join(","))}}return new A(this)}upsert(t,{onConflict:e,returning:r="representation",count:n=null,ignoreDuplicates:s=!1}={}){this.method="POST";const o=[`resolution=${s?"ignore":"merge"}-duplicates`,`return=${r}`];return e!==void 0&&this.url.searchParams.set("on_conflict",e),this.body=t,n&&o.push(`count=${n}`),this.headers.Prefer&&o.unshift(this.headers.Prefer),this.headers.Prefer=o.join(","),new A(this)}update(t,{returning:e="representation",count:r=null}={}){this.method="PATCH";const n=[`return=${e}`];return this.body=t,r&&n.push(`count=${r}`),this.headers.Prefer&&n.unshift(this.headers.Prefer),this.headers.Prefer=n.join(","),new A(this)}delete({returning:t="representation",count:e=null}={}){this.method="DELETE";const r=[`return=${t}`];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new A(this)}}class ht extends de{constructor(t,{headers:e={},schema:r,fetch:n,shouldThrowOnError:s}={}){super({fetch:n,shouldThrowOnError:s}),this.url=new URL(t),this.headers=Object.assign({},e),this.schema=r}rpc(t,{head:e=!1,count:r=null}={}){return e?(this.method="HEAD",t&&Object.entries(t).forEach(([n,s])=>{this.url.searchParams.append(n,s)})):(this.method="POST",this.body=t),r&&(this.headers.Prefer!==void 0?this.headers.Prefer+=`,count=${r}`:this.headers.Prefer=`count=${r}`),new A(this)}}const ut="0.37.4",lt={"X-Client-Info":`postgrest-js/${ut}`};class dt{constructor(t,{headers:e={},schema:r,fetch:n,throwOnError:s}={}){this.url=t,this.headers=Object.assign(Object.assign({},lt),e),this.schema=r,this.fetch=n,this.shouldThrowOnError=s}auth(t){return this.headers.Authorization=`Bearer ${t}`,this}from(t){const e=`${this.url}/${t}`;return new Te(e,{headers:this.headers,schema:this.schema,fetch:this.fetch,shouldThrowOnError:this.shouldThrowOnError})}rpc(t,e,{head:r=!1,count:n=null}={}){const s=`${this.url}/rpc/${t}`;return new ht(s,{headers:this.headers,schema:this.schema,fetch:this.fetch,shouldThrowOnError:this.shouldThrowOnError}).rpc(e,{head:r,count:n})}}var d;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(d||(d={}));const be=(i,t,e={})=>{var r;const n=(r=e.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(t).reduce((s,o)=>(s[o]=ft(o,i,t,n),s),{})},ft=(i,t,e,r)=>{const n=t.find(a=>a.name===i),s=n==null?void 0:n.type,o=e[i];return s&&!r.includes(s)?ke(s,o):oe(o)},ke=(i,t)=>{if(i.charAt(0)==="_"){const e=i.slice(1,i.length);return bt(t,e)}switch(i){case d.bool:return pt(t);case d.float4:case d.float8:case d.int2:case d.int4:case d.int8:case d.numeric:case d.oid:return vt(t);case d.json:case d.jsonb:return mt(t);case d.timestamp:return yt(t);case d.abstime:case d.date:case d.daterange:case d.int4range:case d.int8range:case d.money:case d.reltime:case d.text:case d.time:case d.timestamptz:case d.timetz:case d.tsrange:case d.tstzrange:return oe(t);default:return oe(t)}},oe=i=>i,pt=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},vt=i=>{if(typeof i=="string"){const t=parseFloat(i);if(!Number.isNaN(t))return t}return i},mt=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(t){return console.log(`JSON parse error: ${t}`),i}return i},bt=(i,t)=>{if(typeof i!="string")return i;const e=i.length-1,r=i[e];if(i[0]==="{"&&r==="}"){let s;const o=i.slice(1,e);try{s=JSON.parse("["+o+"]")}catch{s=o?o.split(","):[]}return s.map(a=>ke(t,a))}return i},yt=i=>typeof i=="string"?i.replace(" ","T"):i,_t="websocket",gt="Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",wt=["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],St="Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",Et=["I\xF1aki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],Tt="1.0.34",kt={type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},$t="https://github.com/theturtle32/WebSocket-Node",Ot={node:">=4.0.0"},Rt={bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},jt={"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},xt={verbose:!1},At={test:"tape test/unit/*.js",gulp:"gulp"},Pt="index",Ct={lib:"./lib"},It="lib/browser.js",Ut="Apache-2.0";var Dt={name:_t,description:gt,keywords:wt,author:St,contributors:Et,version:Tt,repository:kt,homepage:$t,engines:Ot,dependencies:Rt,devDependencies:jt,config:xt,scripts:At,main:Pt,directories:Ct,browser:It,license:Ut},Nt=Dt.version,O;if(typeof globalThis=="object")O=globalThis;else try{O=require("es5-ext/global")}catch{}finally{if(!O&&typeof window!="undefined"&&(O=window),!O)throw new Error("Could not determine global this")}var I=O.WebSocket||O.MozWebSocket,Lt=Nt;function $e(i,t){var e;return t?e=new I(i,t):e=new I(i),e}I&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(i){Object.defineProperty($e,i,{get:function(){return I[i]}})});var Mt={w3cwebsocket:I?$e:null,version:Lt};const Bt="1.7.5",Ft={"X-Client-Info":`realtime-js/${Bt}`},Gt="1.0.0",Oe=1e4,Ht=1e3;var C;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(C||(C={}));var b;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(b||(b={}));var _;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(_||(_={}));var ae;(function(i){i.websocket="websocket"})(ae||(ae={}));var R;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(R||(R={}));class Re{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class Jt{constructor(){this.HEADER_LENGTH=1}decode(t,e){return t.constructor===ArrayBuffer?e(this._binaryDecode(t)):e(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const e=new DataView(t),r=new TextDecoder;return this._decodeBroadcast(t,e,r)}_decodeBroadcast(t,e,r){const n=e.getUint8(1),s=e.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(t.slice(o,o+n));o=o+n;const h=r.decode(t.slice(o,o+s));o=o+s;const u=JSON.parse(r.decode(t.slice(o,t.byteLength)));return{ref:null,topic:a,event:h,payload:u}}}class ee{constructor(t,e,r={},n=Oe){this.channel=t,this.event=e,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel.joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var r;return this._hasReceived(t)&&e((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref);const t=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel.on(this.refEvent,t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,e){this.refEvent&&this.channel.trigger(this.refEvent,{status:t,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){!this.refEvent||this.channel.off(this.refEvent)}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:e}){this.recHooks.filter(r=>r.status===t).forEach(r=>r.callback(e))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}class zt{constructor(t,e={},r){this.topic=t,this.params=e,this.socket=r,this.bindings=[],this.state=b.closed,this.joinedOnce=!1,this.pushBuffer=[],this.timeout=this.socket.timeout,this.joinPush=new ee(this,_.join,this.params,this.timeout),this.rejoinTimer=new Re(()=>this.rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=b.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this.onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this.joinRef()}`),this.state=b.closed,this.socket.remove(this)}),this.onError(n=>{this.isLeaving()||this.isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=b.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{!this.isJoining()||(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=b.errored,this.rejoinTimer.scheduleTimeout())}),this.on(_.reply,(n,s)=>{this.trigger(this.replyEventName(s),n)})}rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.rejoin()}subscribe(t=this.timeout){if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";return this.joinedOnce=!0,this.rejoin(t),this.joinPush}onClose(t){this.on(_.close,t)}onError(t){this.on(_.error,e=>t(e))}on(t,e){this.bindings.push({event:t,callback:e})}off(t){this.bindings=this.bindings.filter(e=>e.event!==t)}canPush(){return this.socket.isConnected()&&this.isJoined()}push(t,e,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new ee(this,t,e,r);return this.canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=b.leaving;let e=()=>{this.socket.log("channel",`leave ${this.topic}`),this.trigger(_.close,"leave",this.joinRef())};this.joinPush.destroy();let r=new ee(this,_.leave,{},t);return r.receive("ok",()=>e()).receive("timeout",()=>e()),r.send(),this.canPush()||r.trigger("ok",{}),r}onMessage(t,e,r){return e}isMember(t){return this.topic===t}joinRef(){return this.joinPush.ref}rejoin(t=this.timeout){this.isLeaving()||(this.socket.leaveOpenTopic(this.topic),this.state=b.joining,this.joinPush.resend(t))}trigger(t,e,r){let{close:n,error:s,leave:o,join:a}=_;if(r&&[n,s,o,a].indexOf(t)>=0&&r!==this.joinRef())return;let u=this.onMessage(t,e,r);if(e&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";this.bindings.filter(c=>c.event==="*"?t===(e==null?void 0:e.type):c.event===t).map(c=>c.callback(u,r))}replyEventName(t){return`chan_reply_${t}`}isClosed(){return this.state===b.closed}isErrored(){return this.state===b.errored}isJoined(){return this.state===b.joined}isJoining(){return this.state===b.joining}isLeaving(){return this.state===b.leaving}}var qt=globalThis&&globalThis.__awaiter||function(i,t,e,r){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(l){o(l)}}function h(c){try{u(r.throw(c))}catch(l){o(l)}}function u(c){c.done?s(c.value):n(c.value).then(a,h)}u((r=r.apply(i,t||[])).next())})};const Wt=()=>{};class Kt{constructor(t,e){this.accessToken=null,this.channels=[],this.endPoint="",this.headers=Ft,this.params={},this.timeout=Oe,this.transport=Mt.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.longpollerTimeout=2e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Wt,this.conn=null,this.sendBuffer=[],this.serializer=new Jt,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.endPoint=`${t}/${ae.websocket}`,e!=null&&e.params&&(this.params=e.params),e!=null&&e.headers&&(this.headers=Object.assign(Object.assign({},this.headers),e.headers)),e!=null&&e.timeout&&(this.timeout=e.timeout),e!=null&&e.logger&&(this.logger=e.logger),e!=null&&e.transport&&(this.transport=e.transport),e!=null&&e.heartbeatIntervalMs&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs),e!=null&&e.longpollerTimeout&&(this.longpollerTimeout=e.longpollerTimeout),this.reconnectAfterMs=e!=null&&e.reconnectAfterMs?e.reconnectAfterMs:r=>[1e3,2e3,5e3,1e4][r-1]||1e4,this.encode=e!=null&&e.encode?e.encode:(r,n)=>n(JSON.stringify(r)),this.decode=e!=null&&e.decode?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Re(()=>qt(this,void 0,void 0,function*(){yield this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this.endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this.onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t)))}disconnect(t,e){return new Promise((r,n)=>{try{this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,e||""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset()),r({error:null,data:!0})}catch(s){r({error:s,data:!1})}})}log(t,e,r){this.logger(t,e,r)}onOpen(t){this.stateChangeCallbacks.open.push(t)}onClose(t){this.stateChangeCallbacks.close.push(t)}onError(t){this.stateChangeCallbacks.error.push(t)}onMessage(t){this.stateChangeCallbacks.message.push(t)}connectionState(){switch(this.conn&&this.conn.readyState){case C.connecting:return R.Connecting;case C.open:return R.Open;case C.closing:return R.Closing;default:return R.Closed}}isConnected(){return this.connectionState()===R.Open}remove(t){this.channels=this.channels.filter(e=>e.joinRef()!==t.joinRef())}channel(t,e={}){const r=new zt(t,e,this);return this.channels.push(r),r}push(t){const{topic:e,event:r,payload:n,ref:s}=t;let o=()=>{this.encode(t,a=>{var h;(h=this.conn)===null||h===void 0||h.send(a)})};this.log("push",`${e} ${r} (${s})`,n),this.isConnected()?o():this.sendBuffer.push(o)}onConnMessage(t){this.decode(t.data,e=>{let{topic:r,event:n,payload:s,ref:o}=e;(o&&o===this.pendingHeartbeatRef||n===(s==null?void 0:s.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${r} ${n} ${o&&"("+o+")"||""}`,s),this.channels.filter(a=>a.isMember(r)).forEach(a=>a.trigger(n,s,o)),this.stateChangeCallbacks.message.forEach(a=>a(e))})}endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Gt}))}makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}setAuth(t){this.accessToken=t,this.channels.forEach(e=>{t&&e.updateJoinPayload({user_token:t}),e.joinedOnce&&e.isJoined()&&e.push(_.access_token,{access_token:t})})}leaveOpenTopic(t){let e=this.channels.find(r=>r.topic===t&&(r.isJoined()||r.isJoining()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}_onConnOpen(){this.log("transport",`connected to ${this.endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(t=>t())}_onConnClose(t){this.log("transport","close",t),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(e=>e(t))}_onConnError(t){this.log("transport",t.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(e=>e(t))}_triggerChanError(){this.channels.forEach(t=>t.trigger(_.error))}_appendParams(t,e){if(Object.keys(e).length===0)return t;const r=t.match(/\?/)?"&":"?",n=new URLSearchParams(e);return`${t}${r}${n}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_sendHeartbeat(){var t;if(!!this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(t=this.conn)===null||t===void 0||t.close(Ht,"hearbeat timeout");return}this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class Vt{constructor(t,e,r,n){const s={},o=n==="*"?`realtime:${r}`:`realtime:${r}:${n}`,a=e.Authorization.split(" ")[1];a&&(s.user_token=a),this.subscription=t.channel(o,s)}getPayloadRecords(t){const e={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(e.new=be(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(e.old=be(t.columns,t.old_record)),e}on(t,e){return this.subscription.on(t,r=>{let n={schema:r.schema,table:r.table,commit_timestamp:r.commit_timestamp,eventType:r.type,new:{},old:{},errors:r.errors};n=Object.assign(Object.assign({},n),this.getPayloadRecords(r)),e(n)}),this}subscribe(t=()=>{}){return this.subscription.onError(e=>t("SUBSCRIPTION_ERROR",e)),this.subscription.onClose(()=>t("CLOSED")),this.subscription.subscribe().receive("ok",()=>t("SUBSCRIBED")).receive("error",e=>t("SUBSCRIPTION_ERROR",e)).receive("timeout",()=>t("RETRYING_AFTER_TIMEOUT")),this.subscription}}class Yt extends Te{constructor(t,{headers:e={},schema:r,realtime:n,table:s,fetch:o,shouldThrowOnError:a}){super(t,{headers:e,schema:r,fetch:o,shouldThrowOnError:a}),this._subscription=null,this._realtime=n,this._headers=e,this._schema=r,this._table=s}on(t,e){return this._realtime.isConnected()||this._realtime.connect(),this._subscription||(this._subscription=new Vt(this._realtime,this._headers,this._schema,this._table)),this._subscription.on(t,e)}}const Xt="1.7.3",Qt={"X-Client-Info":`storage-js/${Xt}`};var N=globalThis&&globalThis.__awaiter||function(i,t,e,r){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(l){o(l)}}function h(c){try{u(r.throw(c))}catch(l){o(l)}}function u(c){c.done?s(c.value):n(c.value).then(a,h)}u((r=r.apply(i,t||[])).next())})};const Zt=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),er=(i,t)=>{if(typeof i.json!="function")return t(i);i.json().then(e=>t({message:Zt(e),status:(i==null?void 0:i.status)||500}))},tr=(i,t,e,r)=>{const n={method:i,headers:(t==null?void 0:t.headers)||{}};return i==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),e))};function V(i,t,e,r,n,s){return N(this,void 0,void 0,function*(){return new Promise((o,a)=>{i(e,tr(t,r,n,s)).then(h=>{if(!h.ok)throw h;return r!=null&&r.noResolveJson?o(h):h.json()}).then(h=>o(h)).catch(h=>er(h,a))})})}function ce(i,t,e,r){return N(this,void 0,void 0,function*(){return V(i,"GET",t,e,r)})}function j(i,t,e,r,n){return N(this,void 0,void 0,function*(){return V(i,"POST",t,r,n,e)})}function rr(i,t,e,r,n){return N(this,void 0,void 0,function*(){return V(i,"PUT",t,r,n,e)})}function je(i,t,e,r,n){return N(this,void 0,void 0,function*(){return V(i,"DELETE",t,r,n,e)})}var ir=globalThis&&globalThis.__awaiter||function(i,t,e,r){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(l){o(l)}}function h(c){try{u(r.throw(c))}catch(l){o(l)}}function u(c){c.done?s(c.value):n(c.value).then(a,h)}u((r=r.apply(i,t||[])).next())})};const xe=i=>{let t;return i?t=i:typeof fetch=="undefined"?t=(...e)=>ir(void 0,void 0,void 0,function*(){return yield(yield q(()=>import("./browser-ponyfill.34bdb024.js").then(function(r){return r.b}),[])).fetch(...e)}):t=fetch,(...e)=>t(...e)};var x=globalThis&&globalThis.__awaiter||function(i,t,e,r){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(l){o(l)}}function h(c){try{u(r.throw(c))}catch(l){o(l)}}function u(c){c.done?s(c.value):n(c.value).then(a,h)}u((r=r.apply(i,t||[])).next())})};class nr{constructor(t,e={},r){this.url=t,this.headers=Object.assign(Object.assign({},Qt),e),this.fetch=xe(r)}listBuckets(){return x(this,void 0,void 0,function*(){try{return{data:yield ce(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){return{data:null,error:t}}})}getBucket(t){return x(this,void 0,void 0,function*(){try{return{data:yield ce(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(e){return{data:null,error:e}}})}createBucket(t,e={public:!1}){return x(this,void 0,void 0,function*(){try{return{data:(yield j(this.fetch,`${this.url}/bucket`,{id:t,name:t,public:e.public},{headers:this.headers})).name,error:null}}catch(r){return{data:null,error:r}}})}updateBucket(t,e){return x(this,void 0,void 0,function*(){try{return{data:yield rr(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:e.public},{headers:this.headers}),error:null}}catch(r){return{data:null,error:r}}})}emptyBucket(t){return x(this,void 0,void 0,function*(){try{return{data:yield j(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(e){return{data:null,error:e}}})}deleteBucket(t){return x(this,void 0,void 0,function*(){try{return{data:yield je(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(e){return{data:null,error:e}}})}}var w=globalThis&&globalThis.__awaiter||function(i,t,e,r){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(l){o(l)}}function h(c){try{u(r.throw(c))}catch(l){o(l)}}function u(c){c.done?s(c.value):n(c.value).then(a,h)}u((r=r.apply(i,t||[])).next())})};const sr={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},or={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class ar{constructor(t,e={},r,n){this.url=t,this.headers=e,this.bucketId=r,this.fetch=xe(n)}uploadOrUpdate(t,e,r,n){return w(this,void 0,void 0,function*(){try{let s;const o=Object.assign(Object.assign({},or),n),a=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(o.upsert)});typeof Blob!="undefined"&&r instanceof Blob?(s=new FormData,s.append("cacheControl",o.cacheControl),s.append("",r)):typeof FormData!="undefined"&&r instanceof FormData?(s=r,s.append("cacheControl",o.cacheControl)):(s=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);const h=this._removeEmptyFolders(e),u=this._getFinalPath(h),c=yield this.fetch(`${this.url}/object/${u}`,{method:t,body:s,headers:a});if(c.ok)return{data:{Key:u},error:null};{const l=yield c.json();return{data:null,error:l}}}catch(s){return{data:null,error:s}}})}upload(t,e,r){return w(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,e,r)})}update(t,e,r){return w(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,e,r)})}move(t,e){return w(this,void 0,void 0,function*(){try{return{data:yield j(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e},{headers:this.headers}),error:null}}catch(r){return{data:null,error:r}}})}copy(t,e){return w(this,void 0,void 0,function*(){try{return{data:yield j(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e},{headers:this.headers}),error:null}}catch(r){return{data:null,error:r}}})}createSignedUrl(t,e){return w(this,void 0,void 0,function*(){try{const r=this._getFinalPath(t);let n=yield j(this.fetch,`${this.url}/object/sign/${r}`,{expiresIn:e},{headers:this.headers});const s=`${this.url}${n.signedURL}`;return n={signedURL:s},{data:n,error:null,signedURL:s}}catch(r){return{data:null,error:r,signedURL:null}}})}createSignedUrls(t,e){return w(this,void 0,void 0,function*(){try{return{data:(yield j(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:t},{headers:this.headers})).map(n=>Object.assign(Object.assign({},n),{signedURL:n.signedURL?`${this.url}${n.signedURL}`:null})),error:null}}catch(r){return{data:null,error:r}}})}download(t){return w(this,void 0,void 0,function*(){try{const e=this._getFinalPath(t);return{data:yield(yield ce(this.fetch,`${this.url}/object/${e}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(e){return{data:null,error:e}}})}getPublicUrl(t){try{const e=this._getFinalPath(t),r=`${this.url}/object/public/${e}`;return{data:{publicURL:r},error:null,publicURL:r}}catch(e){return{data:null,error:e,publicURL:null}}}remove(t){return w(this,void 0,void 0,function*(){try{return{data:yield je(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(e){return{data:null,error:e}}})}list(t,e,r){return w(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},sr),e),{prefix:t||""});return{data:yield j(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){return{data:null,error:n}}})}_getFinalPath(t){return`${this.bucketId}/${t}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}}class cr extends nr{constructor(t,e={},r){super(t,e,r)}from(t){return new ar(this.url,this.headers,t,this.fetch)}}var hr=globalThis&&globalThis.__awaiter||function(i,t,e,r){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(l){o(l)}}function h(c){try{u(r.throw(c))}catch(l){o(l)}}function u(c){c.done?s(c.value):n(c.value).then(a,h)}u((r=r.apply(i,t||[])).next())})};const ur=i=>{let t;return i?t=i:typeof fetch=="undefined"?t=(...e)=>hr(void 0,void 0,void 0,function*(){return yield(yield q(()=>import("./browser-ponyfill.34bdb024.js").then(function(r){return r.b}),[])).fetch(...e)}):t=fetch,(...e)=>t(...e)};var lr=globalThis&&globalThis.__awaiter||function(i,t,e,r){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(l){o(l)}}function h(c){try{u(r.throw(c))}catch(l){o(l)}}function u(c){c.done?s(c.value):n(c.value).then(a,h)}u((r=r.apply(i,t||[])).next())})};class dr{constructor(t,{headers:e={},customFetch:r}={}){this.url=t,this.headers=e,this.fetch=ur(r)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,e){return lr(this,void 0,void 0,function*(){try{const{headers:r,body:n}=e!=null?e:{},s=yield this.fetch(`${this.url}/${t}`,{method:"POST",headers:Object.assign({},this.headers,r),body:n}),o=s.headers.get("x-relay-error");if(o&&o==="true")return{data:null,error:new Error(yield s.text())};let a;const{responseType:h}=e!=null?e:{};return!h||h==="json"?a=yield s.json():h==="arrayBuffer"?a=yield s.arrayBuffer():h==="blob"?a=yield s.blob():a=yield s.text(),{data:a,error:null}}catch(r){return{data:null,error:r}}})}}var te=globalThis&&globalThis.__awaiter||function(i,t,e,r){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(l){o(l)}}function h(c){try{u(r.throw(c))}catch(l){o(l)}}function u(c){c.done?s(c.value):n(c.value).then(a,h)}u((r=r.apply(i,t||[])).next())})};const fr={schema:"public",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,multiTab:!0,headers:Ee};class pr{constructor(t,e,r){if(this.supabaseUrl=t,this.supabaseKey=e,!t)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");const n=Le(t),s=Object.assign(Object.assign({},fr),r);if(this.restUrl=`${n}/rest/v1`,this.realtimeUrl=`${n}/realtime/v1`.replace("http","ws"),this.authUrl=`${n}/auth/v1`,this.storageUrl=`${n}/storage/v1`,n.match(/(supabase\.co)|(supabase\.in)/)){const a=n.split(".");this.functionsUrl=`${a[0]}.functions.${a[1]}.${a[2]}`}else this.functionsUrl=`${n}/functions/v1`;this.schema=s.schema,this.multiTab=s.multiTab,this.fetch=s.fetch,this.headers=Object.assign(Object.assign({},Ee),r==null?void 0:r.headers),this.shouldThrowOnError=s.shouldThrowOnError||!1,this.auth=this._initSupabaseAuthClient(s),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},s.realtime)),this._listenForAuthEvents(),this._listenForMultiTabEvents()}get functions(){return new dr(this.functionsUrl,{headers:this._getAuthHeaders(),customFetch:this.fetch})}get storage(){return new cr(this.storageUrl,this._getAuthHeaders(),this.fetch)}from(t){const e=`${this.restUrl}/${t}`;return new Yt(e,{headers:this._getAuthHeaders(),schema:this.schema,realtime:this.realtime,table:t,fetch:this.fetch,shouldThrowOnError:this.shouldThrowOnError})}rpc(t,e,{head:r=!1,count:n=null}={}){return this._initPostgRESTClient().rpc(t,e,{head:r,count:n})}removeAllSubscriptions(){return te(this,void 0,void 0,function*(){const t=this.getSubscriptions().slice(),e=t.map(n=>this.removeSubscription(n));return(yield Promise.all(e)).map(({error:n},s)=>({data:{subscription:t[s]},error:n}))})}removeSubscription(t){return te(this,void 0,void 0,function*(){const{error:e}=yield this._closeSubscription(t),r=this.getSubscriptions(),n=r.filter(s=>s.isJoined()).length;return r.length===0&&(yield this.realtime.disconnect()),{data:{openSubscriptions:n},error:e}})}_closeSubscription(t){return te(this,void 0,void 0,function*(){let e=null;if(!t.isClosed()){const{error:r}=yield this._unsubscribeSubscription(t);e=r}return this.realtime.remove(t),{error:e}})}_unsubscribeSubscription(t){return new Promise(e=>{t.unsubscribe().receive("ok",()=>e({error:null})).receive("error",r=>e({error:r})).receive("timeout",()=>e({error:new Error("timed out")}))})}getSubscriptions(){return this.realtime.channels}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,localStorage:n,headers:s,fetch:o,cookieOptions:a,multiTab:h}){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new at({url:this.authUrl,headers:Object.assign(Object.assign({},s),u),autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,localStorage:n,fetch:o,cookieOptions:a,multiTab:h})}_initRealtimeClient(t){return new Kt(this.realtimeUrl,Object.assign(Object.assign({},t),{params:Object.assign(Object.assign({},t==null?void 0:t.params),{apikey:this.supabaseKey})}))}_initPostgRESTClient(){return new dt(this.restUrl,{headers:this._getAuthHeaders(),schema:this.schema,fetch:this.fetch,throwOnError:this.shouldThrowOnError})}_getAuthHeaders(){var t,e;const r=Object.assign({},this.headers),n=(e=(t=this.auth.session())===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:this.supabaseKey;return r.apikey=this.supabaseKey,r.Authorization=r.Authorization||`Bearer ${n}`,r}_listenForMultiTabEvents(){if(!this.multiTab||!Me()||!(window!=null&&window.addEventListener))return null;try{return window==null?void 0:window.addEventListener("storage",t=>{var e,r,n;if(t.key===Ne){const s=JSON.parse(String(t.newValue)),o=(r=(e=s==null?void 0:s.currentSession)===null||e===void 0?void 0:e.access_token)!==null&&r!==void 0?r:void 0,a=(n=this.auth.session())===null||n===void 0?void 0:n.access_token;o?!a&&o?this._handleTokenChanged("SIGNED_IN",o,"STORAGE"):a!==o&&this._handleTokenChanged("TOKEN_REFRESHED",o,"STORAGE"):this._handleTokenChanged("SIGNED_OUT",o,"STORAGE")}})}catch(t){return console.error("_listenForMultiTabEvents",t),null}}_listenForAuthEvents(){let{data:t}=this.auth.onAuthStateChange((e,r)=>{this._handleTokenChanged(e,r==null?void 0:r.access_token,"CLIENT")});return t}_handleTokenChanged(t,e,r){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==e?(this.realtime.setAuth(e),r=="STORAGE"&&this.auth.setAuth(e),this.changedAccessToken=e):(t==="SIGNED_OUT"||t==="USER_DELETED")&&(this.realtime.setAuth(this.supabaseKey),r=="STORAGE"&&this.auth.signOut())}}const Or=(i,t,e)=>new pr(i,t,e);function T(i){return typeof i=="function"}function Ae(i){var t=function(r){Error.call(r),r.stack=new Error().stack},e=i(t);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var re=Ae(function(i){return function(e){i(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(r,n){return n+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function he(i,t){if(i){var e=i.indexOf(t);0<=e&&i.splice(e,1)}}var Y=function(){function i(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return i.prototype.unsubscribe=function(){var t,e,r,n,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=ne(o),h=a.next();!h.done;h=a.next()){var u=h.value;u.remove(this)}}catch(p){t={error:p}}finally{try{h&&!h.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}else o.remove(this);var c=this.initialTeardown;if(T(c))try{c()}catch(p){s=p instanceof re?p.errors:[p]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var g=ne(l),y=g.next();!y.done;y=g.next()){var L=y.value;try{ye(L)}catch(p){s=s!=null?s:[],p instanceof re?s=J(J([],z(s)),z(p.errors)):s.push(p)}}}catch(p){r={error:p}}finally{try{y&&!y.done&&(n=g.return)&&n.call(g)}finally{if(r)throw r.error}}}if(s)throw new re(s)}},i.prototype.add=function(t){var e;if(t&&t!==this)if(this.closed)ye(t);else{if(t instanceof i){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(t)}},i.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},i.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},i.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&he(e,t)},i.prototype.remove=function(t){var e=this._finalizers;e&&he(e,t),t instanceof i&&t._removeParent(this)},i.EMPTY=function(){var t=new i;return t.closed=!0,t}(),i}(),Pe=Y.EMPTY;function Ce(i){return i instanceof Y||i&&"closed"in i&&T(i.remove)&&T(i.add)&&T(i.unsubscribe)}function ye(i){T(i)?i():i.unsubscribe()}var fe={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ue={setTimeout:function(i,t){for(var e=[],r=2;r<arguments.length;r++)e[r-2]=arguments[r];var n=ue.delegate;return n!=null&&n.setTimeout?n.setTimeout.apply(n,J([i,t],z(e))):setTimeout.apply(void 0,J([i,t],z(e)))},clearTimeout:function(i){var t=ue.delegate;return((t==null?void 0:t.clearTimeout)||clearTimeout)(i)},delegate:void 0};function vr(i){ue.setTimeout(function(){throw i})}function _e(){}var F=null;function H(i){if(fe.useDeprecatedSynchronousErrorHandling){var t=!F;if(t&&(F={errorThrown:!1,error:null}),i(),t){var e=F,r=e.errorThrown,n=e.error;if(F=null,r)throw n}}else i()}var Ie=function(i){U(t,i);function t(e){var r=i.call(this)||this;return r.isStopped=!1,e?(r.destination=e,Ce(e)&&e.add(r)):r.destination=_r,r}return t.create=function(e,r,n){return new le(e,r,n)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,i.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Y),mr=Function.prototype.bind;function ie(i,t){return mr.call(i,t)}var br=function(){function i(t){this.partialObserver=t}return i.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(r){G(r)}},i.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(r){G(r)}else G(t)},i.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){G(e)}},i}(),le=function(i){U(t,i);function t(e,r,n){var s=i.call(this)||this,o;if(T(e)||!e)o={next:e!=null?e:void 0,error:r!=null?r:void 0,complete:n!=null?n:void 0};else{var a;s&&fe.useDeprecatedNextContext?(a=Object.create(e),a.unsubscribe=function(){return s.unsubscribe()},o={next:e.next&&ie(e.next,a),error:e.error&&ie(e.error,a),complete:e.complete&&ie(e.complete,a)}):o=e}return s.destination=new br(o),s}return t}(Ie);function G(i){vr(i)}function yr(i){throw i}var _r={closed:!0,next:_e,error:yr,complete:_e},gr=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function wr(i){return i}function Sr(i){return i.length===0?wr:i.length===1?i[0]:function(e){return i.reduce(function(r,n){return n(r)},e)}}var ge=function(){function i(t){t&&(this._subscribe=t)}return i.prototype.lift=function(t){var e=new i;return e.source=this,e.operator=t,e},i.prototype.subscribe=function(t,e,r){var n=this,s=Tr(t)?t:new le(t,e,r);return H(function(){var o=n,a=o.operator,h=o.source;s.add(a?a.call(s,h):h?n._subscribe(s):n._trySubscribe(s))}),s},i.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},i.prototype.forEach=function(t,e){var r=this;return e=we(e),new e(function(n,s){var o=new le({next:function(a){try{t(a)}catch(h){s(h),o.unsubscribe()}},error:s,complete:n});r.subscribe(o)})},i.prototype._subscribe=function(t){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(t)},i.prototype[gr]=function(){return this},i.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Sr(t)(this)},i.prototype.toPromise=function(t){var e=this;return t=we(t),new t(function(r,n){var s;e.subscribe(function(o){return s=o},function(o){return n(o)},function(){return r(s)})})},i.create=function(t){return new i(t)},i}();function we(i){var t;return(t=i!=null?i:fe.Promise)!==null&&t!==void 0?t:Promise}function Er(i){return i&&T(i.next)&&T(i.error)&&T(i.complete)}function Tr(i){return i&&i instanceof Ie||Er(i)&&Ce(i)}var kr=Ae(function(i){return function(){i(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Ue=function(i){U(t,i);function t(){var e=i.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return t.prototype.lift=function(e){var r=new Se(this,this);return r.operator=e,r},t.prototype._throwIfClosed=function(){if(this.closed)throw new kr},t.prototype.next=function(e){var r=this;H(function(){var n,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=ne(r.currentObservers),a=o.next();!a.done;a=o.next()){var h=a.value;h.next(e)}}catch(u){n={error:u}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(n)throw n.error}}}})},t.prototype.error=function(e){var r=this;H(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=e;for(var n=r.observers;n.length;)n.shift().error(e)}})},t.prototype.complete=function(){var e=this;H(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var r=e.observers;r.length;)r.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(e){return this._throwIfClosed(),i.prototype._trySubscribe.call(this,e)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var r=this,n=this,s=n.hasError,o=n.isStopped,a=n.observers;return s||o?Pe:(this.currentObservers=null,a.push(e),new Y(function(){r.currentObservers=null,he(a,e)}))},t.prototype._checkFinalizedStatuses=function(e){var r=this,n=r.hasError,s=r.thrownError,o=r.isStopped;n?e.error(s):o&&e.complete()},t.prototype.asObservable=function(){var e=new ge;return e.source=this,e},t.create=function(e,r){return new Se(e,r)},t}(ge),Se=function(i){U(t,i);function t(e,r){var n=i.call(this)||this;return n.destination=e,n.source=r,n}return t.prototype.next=function(e){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.next)===null||n===void 0||n.call(r,e)},t.prototype.error=function(e){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.error)===null||n===void 0||n.call(r,e)},t.prototype.complete=function(){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||r===void 0||r.call(e)},t.prototype._subscribe=function(e){var r,n;return(n=(r=this.source)===null||r===void 0?void 0:r.subscribe(e))!==null&&n!==void 0?n:Pe},t}(Ue),Rr=function(i){U(t,i);function t(e){var r=i.call(this)||this;return r._value=e,r}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(e){var r=i.prototype._subscribe.call(this,e);return!r.closed&&e.next(this._value),r},t.prototype.getValue=function(){var e=this,r=e.hasError,n=e.thrownError,s=e._value;if(r)throw n;return this._throwIfClosed(),s},t.prototype.next=function(e){i.prototype.next.call(this,this._value=e)},t}(Ue);export{Rr as B,Or as c};
