import{S as st,i as rt,s as at,h as dt,m as ct,p as ft,q as _t,r as ut,w as he,x as gt,z as mt,b as r,c as b,d as f,a as y,f as o,l as F,H as it,g as k,v as ye,t as S,o as J,j as ce,k as j,e as pt,u as vt}from"./index.ed0d3f73.js";import{I as bt}from"./IonPage.3ba1b6e7.js";import{g as wt,p as ht}from"./index.a57b79e0.js";import{m as yt}from"./controllers.b2681d91.js";import{y as kt,C as Dt,r as St,B as Ct,D as Ft,E as Qe,F as Ot}from"./index.6903e97e.js";import It from"./FoodEntryModal.e8ba89bd.js";import{a as Bt,s as zt}from"./alert.cb831d57.js";import{S as Et,U as Tt}from"./supabase.data.service.02f13fa6.js";import{c as Wt}from"./user.store.36050250.js";import"./overlays-ab6211c7.8f005edc.js";import"./FoodSearchModal.6dfe19ff.js";import"./BehaviorSubject.3a174332.js";import"./loadingMessage.1748f252.js";function Xe(l,i,e){const n=l.slice();return n[26]=i[e],n[28]=e,n}function Ze(l){let i,e,n,a,u,s,c;return{c(){i=r("ion-button"),e=r("ion-icon"),n=b(),a=r("ion-button"),u=r("ion-icon"),f(e,"slot","icon-only"),f(e,"icon",kt),f(u,"slot","icon-only"),f(u,"icon",Dt)},m(_,t){y(_,i,t),o(i,e),y(_,n,t),y(_,a,t),o(a,u),s||(c=[F(i,"click",l[6]),F(a,"click",l[16])],s=!0)},p:it,d(_){_&&k(i),_&&k(n),_&&k(a),s=!1,ye(c)}}}function xe(l){let i,e,n,a,u,s,c;return{c(){i=r("ion-button"),e=r("ion-icon"),n=b(),a=r("ion-button"),u=r("ion-icon"),f(e,"slot","icon-only"),f(e,"icon",St),f(u,"slot","icon-only"),f(u,"icon",Ct)},m(_,t){y(_,i,t),o(i,e),y(_,n,t),y(_,a,t),o(a,u),s||(c=[F(i,"click",l[17]),F(a,"click",l[18])],s=!0)},p:it,d(_){_&&k(i),_&&k(n),_&&k(a),s=!1,ye(c)}}}function $e(l){var a,u,s;let i,e=(((u=(a=l[3])==null?void 0:a.user_metadata)==null?void 0:u.daily_budget)-((s=l[2])==null?void 0:s.food_total)||0).toFixed(2)+"",n;return{c(){i=S("Left: "),n=S(e)},m(c,_){y(c,i,_),y(c,n,_)},p(c,_){var t,p,w;_&12&&e!==(e=(((p=(t=c[3])==null?void 0:t.user_metadata)==null?void 0:p.daily_budget)-((w=c[2])==null?void 0:w.food_total)||0).toFixed(2)+"")&&J(n,e)},d(c){c&&k(i),c&&k(n)}}}function et(l){let i,e,n,a,u,s;return{c(){i=r("div"),e=r("ion-label"),e.textContent="Date:",n=r("ion-input"),f(e,"class","svelte-15ns3sv"),f(n,"value",a=l[2].date),f(n,"required",""),f(n,"name","date"),f(n,"type","text"),f(n,"class","svelte-15ns3sv"),ce(i,"text-align","center")},m(c,_){y(c,i,_),o(i,e),o(i,n),u||(s=F(n,"ionChange",l[4]),u=!0)},p(c,_){_&4&&a!==(a=c[2].date)&&f(n,"value",a)},d(c){c&&k(i),u=!1,s()}}}function tt(l){var a;let i,e=((a=l[2])==null?void 0:a.notes)+"",n;return{c(){i=r("div"),n=S(e),j(i,"class","ion-padding")},m(u,s){y(u,i,s),o(i,n)},p(u,s){var c;s&4&&e!==(e=((c=u[2])==null?void 0:c.notes)+"")&&J(n,e)},d(u){u&&k(i)}}}function ot(l){let i,e,n,a,u;return{c(){i=r("ion-label"),i.textContent="Notes:",e=r("ion-input"),f(i,"class","svelte-15ns3sv"),f(e,"value",n=l[2].notes),f(e,"required",""),f(e,"name","notes"),f(e,"type","text"),f(e,"class","svelte-15ns3sv")},m(s,c){y(s,i,c),y(s,e,c),a||(u=F(e,"ionChange",l[4]),a=!0)},p(s,c){c&4&&n!==(n=s[2].notes)&&f(e,"value",n)},d(s){s&&k(i),s&&k(e),a=!1,u()}}}function lt(l){var a,u;let i,e=(u=(a=l[2])==null?void 0:a.food_log)==null?void 0:u.entries,n=[];for(let s=0;s<e.length;s+=1)n[s]=nt(Xe(l,e,s));return{c(){for(let s=0;s<n.length;s+=1)n[s].c();i=pt()},m(s,c){for(let _=0;_<n.length;_+=1)n[_].m(s,c);y(s,i,c)},p(s,c){var _,t;if(c&516){e=(t=(_=s[2])==null?void 0:_.food_log)==null?void 0:t.entries;let p;for(p=0;p<e.length;p+=1){const w=Xe(s,e,p);n[p]?n[p].p(w,c):(n[p]=nt(w),n[p].c(),n[p].m(i.parentNode,i))}for(;p<n.length;p+=1)n[p].d(1);n.length=e.length}},d(s){vt(n,s),s&&k(i)}}}function nt(l){var d,m,h,M;let i,e,n,a,u=((d=l[26])==null?void 0:d.title)+"",s,c,_,t,p=(((m=l[26])==null?void 0:m.desc)||"")+"",w,C,K,v,U,q=(((h=l[26])==null?void 0:h.amt)||0).toFixed(2)+"",A,Q,R,H,$,P=(((M=l[26])==null?void 0:M.cat)||"")+"",ee,te,X,oe;function Y(){return l[19](l[28])}return{c(){i=r("ion-item"),e=r("ion-reorder"),n=b(),a=r("div"),s=S(u),c=r("br"),_=b(),t=r("span"),w=S(p),C=S("\xA0"),K=b(),v=r("ion-note"),U=r("div"),A=S(q),Q=r("br"),R=b(),H=r("span"),$=S("\xA0"),ee=S(P),te=b(),f(e,"slot","start"),j(t,"class","description svelte-15ns3sv"),j(H,"class","description svelte-15ns3sv"),f(v,"slot","end"),f(v,"class","right svelte-15ns3sv")},m(O,V){y(O,i,V),o(i,e),o(i,n),o(i,a),o(a,s),o(a,c),o(a,_),o(a,t),o(t,w),o(t,C),o(i,K),o(i,v),o(v,U),o(U,A),o(U,Q),o(U,R),o(U,H),o(H,$),o(H,ee),o(i,te),X||(oe=F(i,"click",Y),X=!0)},p(O,V){var G,ne,Z,ie;l=O,V&4&&u!==(u=((G=l[26])==null?void 0:G.title)+"")&&J(s,u),V&4&&p!==(p=(((ne=l[26])==null?void 0:ne.desc)||"")+"")&&J(w,p),V&4&&q!==(q=(((Z=l[26])==null?void 0:Z.amt)||0).toFixed(2)+"")&&J(A,q),V&4&&P!==(P=(((ie=l[26])==null?void 0:ie.cat)||"")+"")&&J(ee,P)},d(O){O&&k(i),X=!1,oe()}}}function Nt(l){var Te,We,Ne,qe,Pe,Ue,Ae,Me;let i,e,n,a,u,s,c,_=new Date(new Date((Te=l[2])==null?void 0:Te.date).getTime()+new Date((We=l[2])==null?void 0:We.date).getTimezoneOffset()*6e4).toDateString()+"",t,p,w,C,K,v,U,q,A,Q,R=(((Ne=l[2])==null?void 0:Ne.food_total)||0).toFixed(2)+"",H,$,P,ee,te,X,oe,Y,d,m,h,M,O,V,G,ne,Z,ie,se,fe,ke,_e,L,ue,De,ve,re,ge,Se,x,le,me,Ce,ae,Fe,pe=(l[2].water_total||0)+"",be,Oe,Ie,de,Be,ze,we,Ee,I=l[1]==="view"&&Ze(l),B=l[1]==="edit"&&xe(l),z=((Pe=(qe=l[3])==null?void 0:qe.user_metadata)==null?void 0:Pe.daily_budget)&&$e(l),E=l[1]==="edit"&&et(l),T=l[1]==="view"&&((Ue=l[2])==null?void 0:Ue.notes)&&tt(l),W=l[1]==="edit"&&ot(l),N=((Me=(Ae=l[2])==null?void 0:Ae.food_log)==null?void 0:Me.entries)&&lt(l);return{c(){var g;i=r("ion-header"),e=r("ion-toolbar"),n=r("ion-buttons"),a=r("ion-button"),u=r("ion-icon"),s=b(),c=r("ion-title"),t=S(_),p=b(),w=r("ion-buttons"),I&&I.c(),C=b(),B&&B.c(),K=b(),v=r("ion-content"),U=r("ion-grid"),q=r("ion-row"),A=r("ion-col"),Q=S("Total: "),H=S(R),$=b(),P=r("ion-col"),z&&z.c(),ee=b(),E&&E.c(),te=b(),T&&T.c(),X=b(),W&&W.c(),oe=b(),Y=r("ion-list"),d=r("ion-reorder-group"),N&&N.c(),m=b(),h=r("ion-item"),M=r("ion-icon"),O=S(`
				new food entry`),V=b(),G=r("ion-footer"),ne=r("ion-grid"),Z=r("ion-row"),ie=r("ion-col"),se=r("div"),fe=r("div"),fe.textContent="Weight",ke=b(),_e=r("div"),L=r("ion-input"),De=b(),ve=r("ion-col"),re=r("div"),ge=r("div"),ge.textContent="Water",Se=b(),x=r("div"),le=r("ion-icon"),Ce=b(),ae=r("span"),Fe=S("\xA0"),be=S(pe),Oe=S("\xA0"),Ie=b(),de=r("ion-icon"),Be=b(),ze=r("br"),f(u,"slot","icon-only"),f(u,"icon",Ft),f(n,"slot","start"),f(w,"slot","end"),f(i,"translucent","true"),ce(A,"text-align","left"),ce(A,"font-weight","bold"),ce(P,"text-align","right"),ce(P,"font-weight","bold"),f(d,"id","food_log_group"),f(d,"disabled","false"),f(M,"icon",Qe),f(M,"slot","start"),f(h,"lines","none"),f(Y,"lines","full"),f(v,"class","ion-padding"),j(fe,"class","footertitle svelte-15ns3sv"),f(L,"name","weight"),f(L,"class","weightBox svelte-15ns3sv"),f(L,"type","decimal"),f(L,"inputmode","decimal"),f(L,"value",ue=(g=l[2])==null?void 0:g.weight),j(_e,"class","footertitle svelte-15ns3sv"),j(se,"class","left svelte-15ns3sv"),j(ge,"class","footertitle svelte-15ns3sv"),f(le,"color",me=l[2].water_total<=0?"medium":"dark"),f(le,"icon",Ot),f(le,"size","large"),j(ae,"class","water-digits svelte-15ns3sv"),f(de,"icon",Qe),f(de,"size","large"),j(x,"class","footertitle together svelte-15ns3sv"),j(re,"class","right svelte-15ns3sv")},m(g,D){y(g,i,D),o(i,e),o(e,n),o(n,a),o(a,u),o(e,s),o(e,c),o(c,t),o(e,p),o(e,w),I&&I.m(w,null),o(w,C),B&&B.m(w,null),y(g,K,D),y(g,v,D),o(v,U),o(U,q),o(q,A),o(A,Q),o(A,H),o(q,$),o(q,P),z&&z.m(P,null),o(v,ee),E&&E.m(v,null),o(v,te),T&&T.m(v,null),o(v,X),W&&W.m(v,null),o(v,oe),o(v,Y),o(Y,d),N&&N.m(d,null),o(Y,m),o(Y,h),o(h,M),o(h,O),y(g,V,D),y(g,G,D),o(G,ne),o(ne,Z),o(Z,ie),o(ie,se),o(se,fe),o(se,ke),o(se,_e),o(_e,L),o(Z,De),o(Z,ve),o(ve,re),o(re,ge),o(re,Se),o(re,x),o(x,le),o(x,Ce),o(x,ae),o(ae,Fe),o(ae,be),o(ae,Oe),o(x,Ie),o(x,de),o(G,Be),o(G,ze),we||(Ee=[F(a,"click",l[15]),F(d,"ionItemReorder",l[10]),F(h,"click",l[8]),F(L,"ionChange",l[13]),F(L,"ionFocus",Pt),F(L,"ionBlur",l[14]),F(le,"click",l[12]),F(de,"click",l[11])],we=!0)},p(g,D){var He,Le,Ve,je,Re,Ye,Ge,Je,Ke;D&4&&_!==(_=new Date(new Date((He=g[2])==null?void 0:He.date).getTime()+new Date((Le=g[2])==null?void 0:Le.date).getTimezoneOffset()*6e4).toDateString()+"")&&J(t,_),g[1]==="view"?I?I.p(g,D):(I=Ze(g),I.c(),I.m(w,C)):I&&(I.d(1),I=null),g[1]==="edit"?B?B.p(g,D):(B=xe(g),B.c(),B.m(w,null)):B&&(B.d(1),B=null),D&4&&R!==(R=(((Ve=g[2])==null?void 0:Ve.food_total)||0).toFixed(2)+"")&&J(H,R),(Re=(je=g[3])==null?void 0:je.user_metadata)!=null&&Re.daily_budget?z?z.p(g,D):(z=$e(g),z.c(),z.m(P,null)):z&&(z.d(1),z=null),g[1]==="edit"?E?E.p(g,D):(E=et(g),E.c(),E.m(v,te)):E&&(E.d(1),E=null),g[1]==="view"&&((Ye=g[2])==null?void 0:Ye.notes)?T?T.p(g,D):(T=tt(g),T.c(),T.m(v,X)):T&&(T.d(1),T=null),g[1]==="edit"?W?W.p(g,D):(W=ot(g),W.c(),W.m(v,oe)):W&&(W.d(1),W=null),(Je=(Ge=g[2])==null?void 0:Ge.food_log)!=null&&Je.entries?N?N.p(g,D):(N=lt(g),N.c(),N.m(d,null)):N&&(N.d(1),N=null),D&4&&ue!==(ue=(Ke=g[2])==null?void 0:Ke.weight)&&f(L,"value",ue),D&4&&me!==(me=g[2].water_total<=0?"medium":"dark")&&f(le,"color",me),D&4&&pe!==(pe=(g[2].water_total||0)+"")&&J(be,pe)},d(g){g&&k(i),I&&I.d(),B&&B.d(),g&&k(K),g&&k(v),z&&z.d(),E&&E.d(),T&&T.d(),W&&W.d(),N&&N.d(),g&&k(V),g&&k(G),we=!1,ye(Ee)}}}function qt(l){let i,e;return i=new bt({props:{$$slots:{default:[Nt]},$$scope:{ctx:l}}}),{c(){dt(i.$$.fragment)},m(n,a){ct(i,n,a),e=!0},p(n,[a]){const u={};a&536870927&&(u.$$scope={dirty:a,ctx:n}),i.$set(u)},i(n){e||(ft(i.$$.fragment,n),e=!0)},o(n){_t(i.$$.fragment,n),e=!1},d(n){ut(i,n)}}}function Pt(l){l.target.scrollTop=0;try{(parseFloat(l.target.value)||0)===0&&(l.target.value="")}catch(i){console.error("error clearing zero value",i)}}function Ut(l,i,e){let n,a,u;he(l,wt,d=>e(21,n=d)),he(l,Wt,d=>e(3,a=d)),he(l,ht,d=>e(22,u=d));const s=Et.getInstance();Tt.getInstance();let c=u.id,_="view",t={};console.log("*** id",c);let p;c==="new"?(console.log("it is new"),t={id:s.gen_random_uuid(),user_id:(a==null?void 0:a.id)||null,created_at:new Date().toISOString(),date:new Date().toISOString().substring(0,10),food_log:{entries:[]},food_total:0,activity_log:{entries:[]},water_log:{entries:[]},water_total:0,weight:0,notes:""},_="edit",console.log("*** new day",t)):p=s.getDataSubscription("day",{id:c}).subscribe(d=>{e(2,t=d),console.log("*** day",t)}),gt(async()=>{if(!a){n("/info");return}if(c==="new")try{const{data:d,error:m}=await s.getCurrentWeight();m?(console.error("getCurrentWeight error",m),e(2,t.weight=0,t)):e(2,t.weight=d.weight,t)}catch(d){console.log("exception",d),e(2,t.weight=0,t)}}),mt(()=>{try{p&&p.unsubscribe()}catch(d){console.error("error unsubscribing",d)}});const w=d=>{if(typeof t[d.target.name]=="number")try{e(2,t[d.target.name]=parseFloat(d.target.value),t)}catch{e(2,t[d.target.name]=0,t)}else e(2,t[d.target.name]=d.target.value,t)},C=async()=>{let d=!1;c==="new"&&(d=!0),t.user_id||e(2,t.user_id=a.id,t);try{e(2,t.food_total=0,t),t.food_log.entries.forEach(h=>{e(2,t.food_total+=h.amt,t)})}catch(h){console.error("error calculating food total",h)}const{error:m}=await s.save_day(t);m?(console.log("error message is: ",m.message),m.message.startsWith("duplicate key value violates unique constraint")?(console.log("DUPLICATE DAY"),Bt({header:"Duplicate Day",message:"This day already exists.  Please edit the existing day."})):console.error("save day error",m)):(e(0,c=t.id),e(1,_="view")),d&&(console.log("*** day is new, redirect to","/day/"+t.id),n("/day/"+t.id))},K=async()=>{await zt({header:"Delete Day",message:"Are you sure?",okHander:async()=>{const{data:d,error:m}=await s.delete_day(t);m?console.error("Error deleting day",m):v()}})},v=()=>{n("/calendar")},U=async d=>{t.food_log.entries||e(2,t.food_log.entries=[],t);const m={id:s.gen_random_uuid(),food_id:"",title:"",desc:"",cat:"",cps:0,qty:1,amt:0,created:new Date().toISOString()},h=await Q(m,t.food_log.entries.length,!0);console.log("done calling openFoodEntryBox",h),console.log("day.food_log.entries",t.food_log.entries),e(2,t.food_log.entries=[...t.food_log.entries],t),C()},q=async d=>{const m=await Q(t.food_log.entries[d],d,!1);console.log("edit_food_log_entry is done calling openFoodEntryBox",m),console.log("day.food_log.entries",t.food_log.entries),e(2,t.food_log.entries=[...t.food_log.entries],t),C()},A=({detail:d})=>{const{from:m,to:h}=d,M=t.food_log.entries.splice(m,1)[0];t.food_log.entries.splice(h,0,M),d.complete(),console.log("reorder_food_log: day",t),C()},Q=async(d,m,h)=>{const M=await yt.create({component:It,componentProps:{entry:d,isNew:h},showBackdrop:!0,backdropDismiss:!0});await M.present();const{data:O}=await M.onWillDismiss();return(O==null?void 0:O.data)!==null?(O.data.deleted?t.food_log.entries.splice(m,1):e(2,t.food_log.entries[m]=O.data,t),console.log("*** day.food_log.entries",t.food_log.entries),!0):!1};async function R(){t.water_log.entries.push({id:s.gen_random_uuid(),amt:1,created:new Date().toISOString()}),e(2,t.water_total++,t),C()}async function H(){t.water_total<=0||(t.water_log.entries.pop(),e(2,t.water_total--,t),C())}function $(d){try{e(2,t[d.target.name]=parseFloat(d.target.value)||0,t)}catch(m){console.error("handleNumberValue error",m),e(2,t[d.target.name]=0,t)}}function P(d){C()}return[c,_,t,a,w,C,K,v,U,q,A,R,H,$,P,()=>{v()},()=>{e(1,_="edit")},()=>{e(1,_="view"),c==="add"&&v()},()=>{C()},d=>{q(d)}]}class Zt extends st{constructor(i){super(),rt(this,i,Ut,qt,at,{})}}export{Zt as default};
