import{S as ft,i as _t,s as ut,b as r,c as k,d,a as C,f as t,l as z,H as ye,g as F,v as Ie,t as O,j as ce,k as G,o as R,e as gt,u as pt,w as Be,x as mt,z as bt}from"./index.578304cd.js";import{g as yt,p as kt}from"./index.766fcfcd.js";import{m as wt}from"./controllers.cefc7c1d.js";import{y as vt,C as ht,r as Dt,B as St,D as et,E as Ct,F as Ft}from"./index.f1a9933f.js";import Ot from"./FoodEntryModal.59476037.js";import{a as Bt,s as It}from"./alert.ce3515c2.js";import{S as Et,U as Tt}from"./supabase.data.service.279a5283.js";import{c as zt}from"./user.store.176ec192.js";import"./overlays-ab6211c7.8af6336b.js";import"./FoodSearchModal.5c90c629.js";import"./BehaviorSubject.a8d2a033.js";import"./loadingMessage.820316f7.js";function tt(n,l,e){const s=n.slice();return s[27]=l[e],s[29]=e,s}function ot(n){let l,e,s,a,c,i,u;return{c(){l=r("ion-button"),e=r("ion-icon"),s=k(),a=r("ion-button"),c=r("ion-icon"),d(e,"slot","icon-only"),d(e,"icon",vt),d(c,"slot","icon-only"),d(c,"icon",ht)},m(f,p){C(f,l,p),t(l,e),C(f,s,p),C(f,a,p),t(a,c),i||(u=[z(l,"click",n[6]),z(a,"click",n[16])],i=!0)},p:ye,d(f){f&&F(l),f&&F(s),f&&F(a),i=!1,Ie(u)}}}function lt(n){let l,e,s,a,c,i,u;return{c(){l=r("ion-button"),e=r("ion-icon"),s=k(),a=r("ion-button"),c=r("ion-icon"),d(e,"slot","icon-only"),d(e,"icon",Dt),d(c,"slot","icon-only"),d(c,"icon",St)},m(f,p){C(f,l,p),t(l,e),C(f,s,p),C(f,a,p),t(a,c),i||(u=[z(l,"click",n[17]),z(a,"click",n[18])],i=!0)},p:ye,d(f){f&&F(l),f&&F(s),f&&F(a),i=!1,Ie(u)}}}function nt(n){var He,Re,Ve,je,Ye,Ge;let l,e,s,a,c,i,u,f=(((He=n[3])==null?void 0:He.food_total)||0).toFixed(2)+"",p,o,D,W,S=(n[0].daily_budget-((Re=n[3])==null?void 0:Re.food_total)||0).toFixed(2)+"",N,y,b,v,h,g,H,J,Y,K,V,U,ee,Q,X,_,w,B,I,T,ie,x=new Date((Ve=n[3])==null?void 0:Ve.created_at).toLocaleDateString()+"",te,re,de=new Date((je=n[3])==null?void 0:je.created_at).toLocaleTimeString()+"",ke,Ee,Te,ze,we,fe,ve,he,De,se,Se,oe,_e,We,ue,j,ge,Ne,Ce,le,pe,Le,Z,$,me,qe,ne,Me,be=(n[3].water_total||0)+"",Fe,Ae,Pe,ae,Oe,Ue,L=n[2]==="view"&&it(n),q=n[2]==="edit"&&rt(n),M=n[2]==="view"&&st(n),A=n[2]==="edit"&&at(n),P=((Ge=(Ye=n[3])==null?void 0:Ye.food_log)==null?void 0:Ge.entries)&&ct(n);return{c(){var m;l=r("ion-card"),e=r("ion-card-header"),s=r("ion-card-subtitle"),a=r("ion-grid"),c=r("ion-row"),i=r("ion-col"),u=O("Total: "),p=O(f),o=k(),D=r("ion-col"),W=O("Left: "),N=O(S),y=k(),b=r("ion-card-title"),L&&L.c(),v=k(),q&&q.c(),h=k(),g=r("ion-card-content"),M&&M.c(),H=k(),A&&A.c(),J=k(),Y=r("br"),K=k(),V=r("ion-list"),U=r("ion-reorder-group"),P&&P.c(),ee=k(),Q=r("ion-item"),X=r("ion-icon"),_=O(`
						new food entry`),w=k(),B=r("br"),I=k(),T=r("br"),ie=O(`
				created: `),te=O(x),re=k(),ke=O(de),Ee=r("br"),Te=k(),ze=r("br"),we=k(),fe=r("ion-footer"),ve=r("ion-card"),he=r("ion-card-content"),De=r("ion-grid"),se=r("ion-row"),Se=r("ion-col"),oe=r("div"),_e=r("div"),_e.textContent="Weight",We=k(),ue=r("div"),j=r("ion-input"),Ne=k(),Ce=r("ion-col"),le=r("div"),pe=r("div"),pe.textContent="Water",Le=k(),Z=r("div"),$=r("ion-icon"),qe=k(),ne=r("span"),Me=O("\xA0"),Fe=O(be),Ae=O("\xA0"),Pe=k(),ae=r("ion-icon"),ce(i,"text-align","left"),ce(i,"font-weight","bold"),ce(D,"text-align","right"),ce(D,"font-weight","bold"),ce(b,"text-align","center"),d(U,"id","food_log_group"),d(U,"disabled","false"),d(X,"icon",et),d(X,"slot","start"),d(V,"lines","full"),G(_e,"class","footertitle svelte-1nypkbx"),d(j,"name","weight"),d(j,"class","weightBox svelte-1nypkbx"),d(j,"type","number"),d(j,"value",ge=(m=n[3])==null?void 0:m.weight),G(ue,"class","footertitle svelte-1nypkbx"),G(oe,"class","left svelte-1nypkbx"),G(pe,"class","footertitle svelte-1nypkbx"),d($,"color",me=n[3].water_total<=0?"medium":"dark"),d($,"icon",Ct),d($,"size","large"),G(ne,"class","water-digits svelte-1nypkbx"),d(ae,"icon",et),d(ae,"size","large"),G(Z,"class","footertitle together svelte-1nypkbx"),G(le,"class","right svelte-1nypkbx")},m(m,E){C(m,l,E),t(l,e),t(e,s),t(s,a),t(a,c),t(c,i),t(i,u),t(i,p),t(c,o),t(c,D),t(D,W),t(D,N),t(e,y),t(e,b),L&&L.m(b,null),t(b,v),q&&q.m(b,null),t(l,h),t(l,g),M&&M.m(g,null),t(g,H),A&&A.m(g,null),t(g,J),t(g,Y),t(g,K),t(g,V),t(V,U),P&&P.m(U,null),t(V,ee),t(V,Q),t(Q,X),t(Q,_),t(g,w),t(g,B),t(g,I),t(g,T),t(g,ie),t(g,te),t(g,re),t(g,ke),t(g,Ee),t(g,Te),t(g,ze),C(m,we,E),C(m,fe,E),t(fe,ve),t(ve,he),t(he,De),t(De,se),t(se,Se),t(Se,oe),t(oe,_e),t(oe,We),t(oe,ue),t(ue,j),t(se,Ne),t(se,Ce),t(Ce,le),t(le,pe),t(le,Le),t(le,Z),t(Z,$),t(Z,qe),t(Z,ne),t(ne,Me),t(ne,Fe),t(ne,Ae),t(Z,Pe),t(Z,ae),Oe||(Ue=[z(U,"ionItemReorder",n[10]),z(Q,"click",n[8]),z(j,"ionChange",n[13]),z(j,"ionFocus",Nt),z(j,"ionBlur",n[14]),z($,"click",n[12]),z(ae,"click",n[11])],Oe=!0)},p(m,E){var Je,Ke,Qe,Xe,Ze,xe,$e;E&8&&f!==(f=(((Je=m[3])==null?void 0:Je.food_total)||0).toFixed(2)+"")&&R(p,f),E&9&&S!==(S=(m[0].daily_budget-((Ke=m[3])==null?void 0:Ke.food_total)||0).toFixed(2)+"")&&R(N,S),m[2]==="view"?L?L.p(m,E):(L=it(m),L.c(),L.m(b,v)):L&&(L.d(1),L=null),m[2]==="edit"?q?q.p(m,E):(q=rt(m),q.c(),q.m(b,null)):q&&(q.d(1),q=null),m[2]==="view"?M?M.p(m,E):(M=st(m),M.c(),M.m(g,H)):M&&(M.d(1),M=null),m[2]==="edit"?A?A.p(m,E):(A=at(m),A.c(),A.m(g,J)):A&&(A.d(1),A=null),(Xe=(Qe=m[3])==null?void 0:Qe.food_log)!=null&&Xe.entries?P?P.p(m,E):(P=ct(m),P.c(),P.m(U,null)):P&&(P.d(1),P=null),E&8&&x!==(x=new Date((Ze=m[3])==null?void 0:Ze.created_at).toLocaleDateString()+"")&&R(te,x),E&8&&de!==(de=new Date((xe=m[3])==null?void 0:xe.created_at).toLocaleTimeString()+"")&&R(ke,de),E&8&&ge!==(ge=($e=m[3])==null?void 0:$e.weight)&&d(j,"value",ge),E&8&&me!==(me=m[3].water_total<=0?"medium":"dark")&&d($,"color",me),E&8&&be!==(be=(m[3].water_total||0)+"")&&R(Fe,be)},d(m){m&&F(l),L&&L.d(),q&&q.d(),M&&M.d(),A&&A.d(),P&&P.d(),m&&F(we),m&&F(fe),Oe=!1,Ie(Ue)}}}function it(n){var s,a;let l=new Date(new Date((s=n[3])==null?void 0:s.date).getTime()+new Date((a=n[3])==null?void 0:a.date).getTimezoneOffset()*6e4).toDateString()+"",e;return{c(){e=O(l)},m(c,i){C(c,e,i)},p(c,i){var u,f;i&8&&l!==(l=new Date(new Date((u=c[3])==null?void 0:u.date).getTime()+new Date((f=c[3])==null?void 0:f.date).getTimezoneOffset()*6e4).toDateString()+"")&&R(e,l)},d(c){c&&F(e)}}}function rt(n){let l,e,s,a,c;return{c(){l=r("ion-label"),l.textContent="Date:",e=r("ion-input"),d(l,"class","svelte-1nypkbx"),d(e,"value",s=n[3].date),d(e,"required",""),d(e,"name","date"),d(e,"type","text"),d(e,"class","svelte-1nypkbx")},m(i,u){C(i,l,u),C(i,e,u),a||(c=z(e,"ionChange",n[4]),a=!0)},p(i,u){u&8&&s!==(s=i[3].date)&&d(e,"value",s)},d(i){i&&F(l),i&&F(e),a=!1,c()}}}function st(n){var s;let l=((s=n[3])==null?void 0:s.notes)+"",e;return{c(){e=O(l)},m(a,c){C(a,e,c)},p(a,c){var i;c&8&&l!==(l=((i=a[3])==null?void 0:i.notes)+"")&&R(e,l)},d(a){a&&F(e)}}}function at(n){let l,e,s,a,c;return{c(){l=r("ion-label"),l.textContent="Notes:",e=r("ion-input"),d(l,"class","svelte-1nypkbx"),d(e,"value",s=n[3].notes),d(e,"required",""),d(e,"name","notes"),d(e,"type","text"),d(e,"class","svelte-1nypkbx")},m(i,u){C(i,l,u),C(i,e,u),a||(c=z(e,"ionChange",n[4]),a=!0)},p(i,u){u&8&&s!==(s=i[3].notes)&&d(e,"value",s)},d(i){i&&F(l),i&&F(e),a=!1,c()}}}function ct(n){var a,c;let l,e=(c=(a=n[3])==null?void 0:a.food_log)==null?void 0:c.entries,s=[];for(let i=0;i<e.length;i+=1)s[i]=dt(tt(n,e,i));return{c(){for(let i=0;i<s.length;i+=1)s[i].c();l=gt()},m(i,u){for(let f=0;f<s.length;f+=1)s[f].m(i,u);C(i,l,u)},p(i,u){var f,p;if(u&520){e=(p=(f=i[3])==null?void 0:f.food_log)==null?void 0:p.entries;let o;for(o=0;o<e.length;o+=1){const D=tt(i,e,o);s[o]?s[o].p(D,u):(s[o]=dt(D),s[o].c(),s[o].m(l.parentNode,l))}for(;o<s.length;o+=1)s[o].d(1);s.length=e.length}},d(i){pt(s,i),i&&F(l)}}}function dt(n){var X,_,w,B;let l,e,s,a,c=((X=n[27])==null?void 0:X.title)+"",i,u,f,p,o=(((_=n[27])==null?void 0:_.desc)||"")+"",D,W,S,N,y,b=(((w=n[27])==null?void 0:w.amt)||0).toFixed(2)+"",v,h,g,H,J,Y=(((B=n[27])==null?void 0:B.cat)||"")+"",K,V,U,ee;function Q(){return n[19](n[29])}return{c(){l=r("ion-item"),e=r("ion-reorder"),s=k(),a=r("div"),i=O(c),u=r("br"),f=k(),p=r("span"),D=O(o),W=O("\xA0"),S=k(),N=r("ion-note"),y=r("div"),v=O(b),h=r("br"),g=k(),H=r("span"),J=O("\xA0"),K=O(Y),V=k(),d(e,"slot","start"),G(p,"class","description svelte-1nypkbx"),G(H,"class","description svelte-1nypkbx"),d(N,"slot","end"),d(N,"class","right svelte-1nypkbx")},m(I,T){C(I,l,T),t(l,e),t(l,s),t(l,a),t(a,i),t(a,u),t(a,f),t(a,p),t(p,D),t(p,W),t(l,S),t(l,N),t(N,y),t(y,v),t(y,h),t(y,g),t(y,H),t(H,J),t(H,K),t(l,V),U||(ee=z(l,"click",Q),U=!0)},p(I,T){var ie,x,te,re;n=I,T&8&&c!==(c=((ie=n[27])==null?void 0:ie.title)+"")&&R(i,c),T&8&&o!==(o=(((x=n[27])==null?void 0:x.desc)||"")+"")&&R(D,o),T&8&&b!==(b=(((te=n[27])==null?void 0:te.amt)||0).toFixed(2)+"")&&R(v,b),T&8&&Y!==(Y=(((re=n[27])==null?void 0:re.cat)||"")+"")&&R(K,Y)},d(I){I&&F(l),U=!1,ee()}}}function Wt(n){let l,e,s,a,c,i,u,f,p,o,D,W,S,N,y=n[2]==="view"&&ot(n),b=n[2]==="edit"&&lt(n),v=n[3]&&nt(n);return{c(){l=r("ion-header"),e=r("ion-toolbar"),s=r("ion-buttons"),a=r("ion-button"),c=r("ion-icon"),i=k(),u=r("ion-title"),u.textContent="Day",f=k(),p=r("ion-buttons"),y&&y.c(),o=k(),b&&b.c(),D=k(),W=r("ion-content"),v&&v.c(),d(c,"slot","icon-only"),d(c,"icon",Ft),d(s,"slot","start"),d(p,"slot","end"),d(l,"translucent","true"),d(W,"class","ion-padding")},m(h,g){C(h,l,g),t(l,e),t(e,s),t(s,a),t(a,c),t(e,i),t(e,u),t(e,f),t(e,p),y&&y.m(p,null),t(p,o),b&&b.m(p,null),C(h,D,g),C(h,W,g),v&&v.m(W,null),S||(N=z(a,"click",n[15]),S=!0)},p(h,[g]){h[2]==="view"?y?y.p(h,g):(y=ot(h),y.c(),y.m(p,o)):y&&(y.d(1),y=null),h[2]==="edit"?b?b.p(h,g):(b=lt(h),b.c(),b.m(p,null)):b&&(b.d(1),b=null),h[3]?v?v.p(h,g):(v=nt(h),v.c(),v.m(W,null)):v&&(v.d(1),v=null)},i:ye,o:ye,d(h){h&&F(l),y&&y.d(),b&&b.d(),h&&F(D),h&&F(W),v&&v.d(),S=!1,N()}}}function Nt(n){try{(parseFloat(n.target.value)||0)===0&&(n.target.value="")}catch(l){console.error("error clearing zero value",l)}n.target.getInputElement().then(l=>{console.log("input",l),l.type="text",l.setSelectionRange(l.value.length,l.value.length),l.type="number"})}function Lt(n,l,e){let s,a,c;Be(n,yt,_=>e(21,s=_)),Be(n,zt,_=>e(22,a=_)),Be(n,kt,_=>e(23,c=_));const i=Et.getInstance();Tt.getInstance();let u={daily_budget:0,target_weight:0},f=c.id,p="view",o={};console.log("*** id",f);let D;f==="new"?(console.log("it is new"),o={id:i.gen_random_uuid(),user_id:(a==null?void 0:a.id)||null,created_at:new Date().toISOString(),date:new Date().toISOString().substring(0,10),food_log:{entries:[]},food_total:0,activity_log:{entries:[]},water_log:{entries:[]},water_total:0,weight:0,notes:""},p="edit",console.log("*** new day",o)):D=i.getDataSubscription("day",{id:f}).subscribe(_=>{e(3,o=_),console.log("*** day",o)}),mt(async()=>{if(console.log("day onMount, $currentUser",a),!a){s("/info");return}const{data:_,error:w}=await i.getSettings(a==null?void 0:a.id);if(console.log("*** settings",_,w),e(0,u=_.settings||{}),f==="new"){const{data:B,error:I}=await i.getCurrentWeight();I?console.error("getCurrentWeight error",I):e(3,o.weight=B.weight,o)}}),bt(()=>{try{D&&D.unsubscribe()}catch(_){console.error("error unsubscribing",_)}});const W=_=>{if(typeof o[_.target.name]=="number")try{e(3,o[_.target.name]=parseFloat(_.target.value),o)}catch{e(3,o[_.target.name]=0,o)}else e(3,o[_.target.name]=_.target.value,o)},S=async()=>{console.log("save the day",o),console.log("id is currently",f);let _=!1;f==="new"&&(_=!0),o.user_id||e(3,o.user_id=user.id,o);try{e(3,o.food_total=0,o),o.food_log.entries.forEach(B=>{e(3,o.food_total+=B.amt,o)})}catch(B){console.error("error calculating food total",B)}const{error:w}=await i.save_day(o);w?(console.log("error message is: ",w.message),w.message.startsWith("duplicate key value violates unique constraint")?(console.log("DUPLICATE DAY"),Bt({header:"Duplicate Day",message:"This day already exists.  Please edit the existing day."})):console.error("save day error",w)):(e(1,f=o.id),e(2,p="view")),_&&(console.log("*** day is new, redirect to","/day/"+o.id),s("/day/"+o.id))},N=async()=>{await It({header:"Delete Day",message:"Are you sure?",okHander:async()=>{const{data:_,error:w}=await i.delete_day(o);w?console.error("Error deleting day",w):y()}})},y=()=>{s("/calendar")},b=async _=>{o.food_log.entries||e(3,o.food_log.entries=[],o);const w={id:i.gen_random_uuid(),food_id:"",title:"",desc:"",cat:"",cps:0,qty:1,amt:0,created:new Date().toISOString()},B=await g(w,o.food_log.entries.length,!0);console.log("done calling openFoodEntryBox",B),console.log("day.food_log.entries",o.food_log.entries),e(3,o.food_log.entries=[...o.food_log.entries],o),S()},v=async _=>{const w=await g(o.food_log.entries[_],_,!1);console.log("edit_food_log_entry is done calling openFoodEntryBox",w),console.log("day.food_log.entries",o.food_log.entries),e(3,o.food_log.entries=[...o.food_log.entries],o),S()},h=({detail:_})=>{const{from:w,to:B}=_,I=o.food_log.entries.splice(w,1)[0];o.food_log.entries.splice(B,0,I),_.complete(),console.log("reorder_food_log: day",o),S()},g=async(_,w,B)=>{const I=await wt.create({component:Ot,componentProps:{entry:_,isNew:B},showBackdrop:!0,backdropDismiss:!0});await I.present();const{data:T}=await I.onWillDismiss();return(T==null?void 0:T.data)!==null?(T.data.deleted?o.food_log.entries.splice(w,1):e(3,o.food_log.entries[w]=T.data,o),console.log("*** day.food_log.entries",o.food_log.entries),!0):!1};async function H(){o.water_log.entries.push({id:i.gen_random_uuid(),amt:1,created:new Date().toISOString()}),e(3,o.water_total++,o),S()}async function J(){o.water_total<=0||(o.water_log.entries.pop(),e(3,o.water_total--,o),S())}function Y(_){try{e(3,o[_.target.name]=parseFloat(_.target.value)||0,o)}catch(w){console.error("handleNumberValue error",w),e(3,o[_.target.name]=0,o)}}function K(_){S()}return[u,f,p,o,W,S,N,y,b,v,h,H,J,Y,K,()=>{y()},()=>{e(2,p="edit")},()=>{e(2,p="view"),f==="add"&&y()},()=>{S()},_=>{v(_)}]}class Kt extends ft{constructor(l){super(),_t(this,l,Lt,Wt,ut,{})}}export{Kt as default};
