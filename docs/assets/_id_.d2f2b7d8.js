import{S as Ve,i as Xe,s as Ze,e as r,a as h,b as d,d as C,f as t,l as R,n as ie,h as F,r as de,t as z,c as We,j as ce,z as Y,x as $e,w as xe,B as Ne,y as et,D as tt}from"./index.3d16749a.js";import{g as ot,p as lt}from"./index.13f48f12.js";import{m as it}from"./controllers.05ed1f0b.js";import{x as nt,B as st,o as at,A as rt,C as Me,D as ct,E as dt}from"./index.b72425f7.js";import ft from"./FoodEntryModal.e11e84f8.js";import{a as _t,s as ut}from"./alert.effc42fc.js";import{S as gt}from"./supabase.data.service.c819a408.js";import{S as mt}from"./supabase.auth.service.fa5b69a8.js";import"./overlays-ab6211c7.ea2658e9.js";import"./FoodSearchModal.ac1677ea.js";import"./BehaviorSubject.0b3a8d03.js";import"./network.service.98057fa4.js";function Pe(i,l,e){const s=i.slice();return s[25]=l[e],s[27]=e,s}function Ue(i){let l,e,s,a,c,n,m;return{c(){l=r("ion-button"),e=r("ion-icon"),s=h(),a=r("ion-button"),c=r("ion-icon"),d(e,"slot","icon-only"),d(e,"icon",nt),d(c,"slot","icon-only"),d(c,"icon",st)},m(u,_){C(u,l,_),t(l,e),C(u,s,_),C(u,a,_),t(a,c),n||(m=[R(l,"click",i[6]),R(a,"click",i[14])],n=!0)},p:ie,d(u){u&&F(l),u&&F(s),u&&F(a),n=!1,de(m)}}}function je(i){let l,e,s,a,c,n,m;return{c(){l=r("ion-button"),e=r("ion-icon"),s=h(),a=r("ion-button"),c=r("ion-icon"),d(e,"slot","icon-only"),d(e,"icon",at),d(c,"slot","icon-only"),d(c,"icon",rt)},m(u,_){C(u,l,_),t(l,e),C(u,s,_),C(u,a,_),t(a,c),n||(m=[R(l,"click",i[15]),R(a,"click",i[16])],n=!0)},p:ie,d(u){u&&F(l),u&&F(s),u&&F(a),n=!1,de(m)}}}function He(i){var Se,ze,Ce,Fe,Oe,Be;let l,e,s,a,c,n,m,u=(((Se=i[3])==null?void 0:Se.food_total)||0).toFixed(2)+"",_,b,o,E,N=(i[0].daily_budget-((ze=i[3])==null?void 0:ze.food_total)||0).toFixed(2)+"",S,w,p,D,y,g,P,Q,J,X,U,j,$,V,f,v,O,H,I,B,G,Z,x,K,fe,te=(i[3].water_total||0)+"",ne,_e,ue,ee,ge,me,pe,be,we,oe=new Date((Ce=i[3])==null?void 0:Ce.created_at).toLocaleDateString()+"",se,ye,le=new Date((Fe=i[3])==null?void 0:Fe.created_at).toLocaleTimeString()+"",ae,ke,he,ve,re,De,L=i[2]==="view"&&Re(i),q=i[2]==="edit"&&Ye(i),A=i[2]==="view"&&Ge(i),T=i[2]==="edit"&&Je(i),W=((Be=(Oe=i[3])==null?void 0:Oe.food_log)==null?void 0:Be.entries)&&Ke(i);return{c(){l=r("ion-card"),e=r("ion-card-header"),s=r("ion-card-subtitle"),a=r("ion-grid"),c=r("ion-row"),n=r("ion-col"),m=z("Total: "),_=z(u),b=h(),o=r("ion-col"),E=z("Left: "),S=z(N),w=h(),p=r("ion-card-title"),L&&L.c(),D=h(),q&&q.c(),y=h(),g=r("ion-card-content"),A&&A.c(),P=h(),T&&T.c(),Q=h(),J=r("br"),X=h(),U=r("ion-list"),j=r("ion-reorder-group"),W&&W.c(),$=h(),V=r("ion-item"),f=r("ion-icon"),v=z(`
						new food entry`),O=h(),H=r("ion-item"),I=z("Water"),B=r("ion-label"),G=r("ion-icon"),x=h(),K=r("span"),fe=z("\xA0"),ne=z(te),_e=z("\xA0"),ue=h(),ee=r("ion-icon"),ge=h(),me=r("br"),pe=h(),be=r("br"),we=z(`
				created: `),se=z(oe),ye=h(),ae=z(le),ke=r("br"),he=h(),ve=r("br"),We(o,"text-align","right"),We(o,"font-weight","bold"),d(j,"id","food_log_group"),d(j,"disabled","false"),d(f,"icon",Me),d(f,"slot","start"),d(G,"color",Z=i[3].water_total<=0?"medium":"dark"),d(G,"icon",ct),d(G,"size","large"),ce(K,"class","water-digits svelte-1ufanz"),d(ee,"icon",Me),d(ee,"size","large"),d(B,"slot","end"),d(B,"class","svelte-1ufanz"),d(U,"lines","full")},m(k,M){C(k,l,M),t(l,e),t(e,s),t(s,a),t(a,c),t(c,n),t(n,m),t(n,_),t(c,b),t(c,o),t(o,E),t(o,S),t(e,w),t(e,p),L&&L.m(p,null),t(p,D),q&&q.m(p,null),t(l,y),t(l,g),A&&A.m(g,null),t(g,P),T&&T.m(g,null),t(g,Q),t(g,J),t(g,X),t(g,U),t(U,j),W&&W.m(j,null),t(U,$),t(U,V),t(V,f),t(V,v),t(U,O),t(U,H),t(H,I),t(H,B),t(B,G),t(B,x),t(B,K),t(K,fe),t(K,ne),t(K,_e),t(B,ue),t(B,ee),t(g,ge),t(g,me),t(g,pe),t(g,be),t(g,we),t(g,se),t(g,ye),t(g,ae),t(g,ke),t(g,he),t(g,ve),re||(De=[R(j,"ionItemReorder",i[10]),R(V,"click",i[8]),R(G,"click",i[12]),R(ee,"click",i[11])],re=!0)},p(k,M){var Ee,Ie,Le,qe,Ae,Te;M&8&&u!==(u=(((Ee=k[3])==null?void 0:Ee.food_total)||0).toFixed(2)+"")&&Y(_,u),M&9&&N!==(N=(k[0].daily_budget-((Ie=k[3])==null?void 0:Ie.food_total)||0).toFixed(2)+"")&&Y(S,N),k[2]==="view"?L?L.p(k,M):(L=Re(k),L.c(),L.m(p,D)):L&&(L.d(1),L=null),k[2]==="edit"?q?q.p(k,M):(q=Ye(k),q.c(),q.m(p,null)):q&&(q.d(1),q=null),k[2]==="view"?A?A.p(k,M):(A=Ge(k),A.c(),A.m(g,P)):A&&(A.d(1),A=null),k[2]==="edit"?T?T.p(k,M):(T=Je(k),T.c(),T.m(g,Q)):T&&(T.d(1),T=null),(qe=(Le=k[3])==null?void 0:Le.food_log)!=null&&qe.entries?W?W.p(k,M):(W=Ke(k),W.c(),W.m(j,null)):W&&(W.d(1),W=null),M&8&&Z!==(Z=k[3].water_total<=0?"medium":"dark")&&d(G,"color",Z),M&8&&te!==(te=(k[3].water_total||0)+"")&&Y(ne,te),M&8&&oe!==(oe=new Date((Ae=k[3])==null?void 0:Ae.created_at).toLocaleDateString()+"")&&Y(se,oe),M&8&&le!==(le=new Date((Te=k[3])==null?void 0:Te.created_at).toLocaleTimeString()+"")&&Y(ae,le)},d(k){k&&F(l),L&&L.d(),q&&q.d(),A&&A.d(),T&&T.d(),W&&W.d(),re=!1,de(De)}}}function Re(i){var s;let l=((s=i[3])==null?void 0:s.date)+"",e;return{c(){e=z(l)},m(a,c){C(a,e,c)},p(a,c){var n;c&8&&l!==(l=((n=a[3])==null?void 0:n.date)+"")&&Y(e,l)},d(a){a&&F(e)}}}function Ye(i){let l,e,s,a,c;return{c(){l=r("ion-label"),l.textContent="Date:",e=r("ion-input"),d(l,"class","svelte-1ufanz"),d(e,"value",s=i[3].date),d(e,"required",""),d(e,"name","date"),d(e,"type","text"),d(e,"class","svelte-1ufanz")},m(n,m){C(n,l,m),C(n,e,m),a||(c=R(e,"ionChange",i[4]),a=!0)},p(n,m){m&8&&s!==(s=n[3].date)&&d(e,"value",s)},d(n){n&&F(l),n&&F(e),a=!1,c()}}}function Ge(i){var s;let l=((s=i[3])==null?void 0:s.notes)+"",e;return{c(){e=z(l)},m(a,c){C(a,e,c)},p(a,c){var n;c&8&&l!==(l=((n=a[3])==null?void 0:n.notes)+"")&&Y(e,l)},d(a){a&&F(e)}}}function Je(i){let l,e,s,a,c;return{c(){l=r("ion-label"),l.textContent="Notes:",e=r("ion-input"),d(l,"class","svelte-1ufanz"),d(e,"value",s=i[3].notes),d(e,"required",""),d(e,"name","notes"),d(e,"type","text"),d(e,"class","svelte-1ufanz")},m(n,m){C(n,l,m),C(n,e,m),a||(c=R(e,"ionChange",i[4]),a=!0)},p(n,m){m&8&&s!==(s=n[3].notes)&&d(e,"value",s)},d(n){n&&F(l),n&&F(e),a=!1,c()}}}function Ke(i){var a,c;let l,e=(c=(a=i[3])==null?void 0:a.food_log)==null?void 0:c.entries,s=[];for(let n=0;n<e.length;n+=1)s[n]=Qe(Pe(i,e,n));return{c(){for(let n=0;n<s.length;n+=1)s[n].c();l=$e()},m(n,m){for(let u=0;u<s.length;u+=1)s[u].m(n,m);C(n,l,m)},p(n,m){var u,_;if(m&520){e=(_=(u=n[3])==null?void 0:u.food_log)==null?void 0:_.entries;let b;for(b=0;b<e.length;b+=1){const o=Pe(n,e,b);s[b]?s[b].p(o,m):(s[b]=Qe(o),s[b].c(),s[b].m(l.parentNode,l))}for(;b<s.length;b+=1)s[b].d(1);s.length=e.length}},d(n){xe(s,n),n&&F(l)}}}function Qe(i){var f,v,O,H;let l,e,s,a,c=((f=i[25])==null?void 0:f.title)+"",n,m,u,_,b=(((v=i[25])==null?void 0:v.desc)||"")+"",o,E,N,S,w,p=(((O=i[25])==null?void 0:O.amt)||0).toFixed(2)+"",D,y,g,P,Q,J=(((H=i[25])==null?void 0:H.cat)||"")+"",X,U,j,$;function V(){return i[17](i[27])}return{c(){l=r("ion-item"),e=r("ion-reorder"),s=h(),a=r("div"),n=z(c),m=r("br"),u=h(),_=r("span"),o=z(b),E=z("\xA0"),N=h(),S=r("ion-note"),w=r("div"),D=z(p),y=r("br"),g=h(),P=r("span"),Q=z("\xA0"),X=z(J),U=h(),d(e,"slot","start"),ce(_,"class","description svelte-1ufanz"),ce(P,"class","description svelte-1ufanz"),d(S,"slot","end"),d(S,"class","right svelte-1ufanz")},m(I,B){C(I,l,B),t(l,e),t(l,s),t(l,a),t(a,n),t(a,m),t(a,u),t(a,_),t(_,o),t(_,E),t(l,N),t(l,S),t(S,w),t(w,D),t(w,y),t(w,g),t(w,P),t(P,Q),t(P,X),t(l,U),j||($=R(l,"click",V),j=!0)},p(I,B){var G,Z,x,K;i=I,B&8&&c!==(c=((G=i[25])==null?void 0:G.title)+"")&&Y(n,c),B&8&&b!==(b=(((Z=i[25])==null?void 0:Z.desc)||"")+"")&&Y(o,b),B&8&&p!==(p=(((x=i[25])==null?void 0:x.amt)||0).toFixed(2)+"")&&Y(D,p),B&8&&J!==(J=(((K=i[25])==null?void 0:K.cat)||"")+"")&&Y(X,J)},d(I){I&&F(l),j=!1,$()}}}function pt(i){let l,e,s,a,c,n,m,u,_,b,o,E,N,S,w=i[2]==="view"&&Ue(i),p=i[2]==="edit"&&je(i),D=i[3]&&He(i);return{c(){l=r("ion-header"),e=r("ion-toolbar"),s=r("ion-buttons"),a=r("ion-button"),c=r("ion-icon"),n=h(),m=r("ion-title"),m.textContent="Day",u=h(),_=r("ion-buttons"),w&&w.c(),b=h(),p&&p.c(),o=h(),E=r("ion-content"),D&&D.c(),d(c,"slot","icon-only"),d(c,"icon",dt),d(s,"slot","start"),d(_,"slot","end"),d(l,"translucent","true"),d(E,"class","ion-padding")},m(y,g){C(y,l,g),t(l,e),t(e,s),t(s,a),t(a,c),t(e,n),t(e,m),t(e,u),t(e,_),w&&w.m(_,null),t(_,b),p&&p.m(_,null),C(y,o,g),C(y,E,g),D&&D.m(E,null),N||(S=R(a,"click",i[13]),N=!0)},p(y,[g]){y[2]==="view"?w?w.p(y,g):(w=Ue(y),w.c(),w.m(_,b)):w&&(w.d(1),w=null),y[2]==="edit"?p?p.p(y,g):(p=je(y),p.c(),p.m(_,null)):p&&(p.d(1),p=null),y[3]?D?D.p(y,g):(D=He(y),D.c(),D.m(E,null)):D&&(D.d(1),D=null)},i:ie,o:ie,d(y){y&&F(l),w&&w.d(),p&&p.d(),y&&F(o),y&&F(E),D&&D.d(),N=!1,S()}}}function bt(i,l,e){let s,a;Ne(i,ot,f=>e(21,s=f)),Ne(i,lt,f=>e(22,a=f));const c=gt.getInstance();let n=null,m,u={daily_budget:0,target_weight:0},_=a.id,b="view",o={};console.log("*** id",_);let E;_==="new"?(console.log("it is new"),o={id:c.gen_random_uuid(),user_id:(n==null?void 0:n.id)||null,created_at:new Date().toISOString(),date:new Date().toISOString().substring(0,10),food_log:{entries:[]},food_total:0,activity_log:{entries:[]},water_log:{entries:[]},water_total:0,weight:0,notes:""},b="edit",console.log("*** new day",o)):E=c.getDataSubscription("day",{id:_}).subscribe(f=>{e(3,o=f),console.log("*** day",o)}),et(async()=>{const{data:f,error:v}=await c.getSettings();console.log("*** settings",f,v),e(0,u=f.settings||{}),m=mt.user.subscribe(O=>{n=O})}),tt(()=>{try{E.unsubscribe(),m.unsubscribe()}catch(f){console.error("error unsubscribing",f)}});const N=f=>{if(typeof o[f.target.name]=="number")try{e(3,o[f.target.name]=parseFloat(f.target.value),o)}catch{e(3,o[f.target.name]=0,o)}else e(3,o[f.target.name]=f.target.value,o)},S=async()=>{console.log("save the day",o),console.log("id is currently",_);let f=!1;_==="new"&&(f=!0),o.user_id||e(3,o.user_id=n.id,o);try{e(3,o.food_total=0,o),o.food_log.entries.forEach(O=>{e(3,o.food_total+=O.amt,o)})}catch(O){console.error("error calculating food total",O)}const{error:v}=await c.save_day(o);v?(console.log("error message is: ",v.message),v.message.startsWith("duplicate key value violates unique constraint")?(console.log("DUPLICATE DAY"),_t({header:"Duplicate Day",message:"This day already exists.  Please edit the existing day."})):console.error("save day error",v)):(e(1,_=o.id),e(2,b="view")),f&&(console.log("*** day is new, redirect to","/day/"+o.id),s("/day/"+o.id))},w=async()=>{await ut({header:"Delete Day",message:"Are you sure?",okHander:async()=>{const{data:f,error:v}=await c.delete_day(o);v?console.error("Error deleting day",v):p()}})},p=()=>{s("/days")},D=async f=>{o.food_log.entries||e(3,o.food_log.entries=[],o);const v={id:c.gen_random_uuid(),food_id:"",title:"",desc:"",cat:"",cps:0,qty:1,amt:0,created:new Date().toISOString()},O=await P(v,o.food_log.entries.length,!0);console.log("done calling openFoodEntryBox",O),console.log("day.food_log.entries",o.food_log.entries),e(3,o.food_log.entries=[...o.food_log.entries],o),S()},y=async f=>{const v=await P(o.food_log.entries[f],f,!1);console.log("edit_food_log_entry is done calling openFoodEntryBox",v),console.log("day.food_log.entries",o.food_log.entries),e(3,o.food_log.entries=[...o.food_log.entries],o),S()},g=({detail:f})=>{const{from:v,to:O}=f,H=o.food_log.entries.splice(v,1)[0];o.food_log.entries.splice(O,0,H),f.complete(),console.log("reorder_food_log: day",o),S()},P=async(f,v,O)=>{const H=await it.create({component:ft,componentProps:{entry:f,isNew:O},showBackdrop:!0,backdropDismiss:!0});await H.present();const{data:I}=await H.onWillDismiss();return(I==null?void 0:I.data)!==null?(I.data.deleted?o.food_log.entries.splice(v,1):e(3,o.food_log.entries[v]=I.data,o),console.log("*** day.food_log.entries",o.food_log.entries),!0):!1};async function Q(){o.water_log.entries.push({id:c.gen_random_uuid(),amt:1,created:new Date().toISOString()}),e(3,o.water_total++,o),S()}async function J(){o.water_total<=0||(o.water_log.entries.pop(),e(3,o.water_total--,o),S())}return[u,_,b,o,N,S,w,p,D,y,g,Q,J,()=>{p()},()=>{e(2,b="edit")},()=>{e(2,b="view"),_==="add"&&p()},()=>{S()},f=>{y(f)}]}class Et extends Ve{constructor(l){super(),Xe(this,l,bt,pt,Ze,{})}}export{Et as default};
