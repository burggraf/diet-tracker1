import{S as Ge,i as Je,s as Ke,e as a,a as v,b as _,d as F,f as t,l as j,n as le,h as O,r as de,t as S,c as re,j as ce,z as Y,x as Qe,w as Ve,B as Ae,y as Xe,D as Ze}from"./index.c7d6b215.js";import{g as $e,p as xe}from"./index.35fbe3c4.js";import{m as et}from"./controllers.c951796e.js";import{x as tt,B as ot,o as lt,A as it,C as Le,D as nt,E as st}from"./index.b72425f7.js";import at from"./FoodEntryModal.f97d9823.js";import{a as rt,s as ct}from"./alert.43f554ad.js";import{S as dt}from"./supabase.data.service.6a64c5bc.js";import{S as _t}from"./supabase.auth.service.52a8ff3f.js";import"./overlays-ab6211c7.f96df8d6.js";import"./FoodSearchModal.e4cd42bf.js";import"./BehaviorSubject.61e7888d.js";import"./network.service.e574dd90.js";function Te(i,l,e){const s=i.slice();return s[25]=l[e],s[27]=e,s}function We(i){let l,e,s,r,c,n,g;return{c(){l=a("ion-button"),e=a("ion-icon"),s=v(),r=a("ion-button"),c=a("ion-icon"),_(e,"slot","icon-only"),_(e,"icon",tt),_(c,"slot","icon-only"),_(c,"icon",ot)},m(f,u){F(f,l,u),t(l,e),F(f,s,u),F(f,r,u),t(r,c),n||(g=[j(l,"click",i[6]),j(r,"click",i[14])],n=!0)},p:le,d(f){f&&O(l),f&&O(s),f&&O(r),n=!1,de(g)}}}function Ne(i){let l,e,s,r,c,n,g;return{c(){l=a("ion-button"),e=a("ion-icon"),s=v(),r=a("ion-button"),c=a("ion-icon"),_(e,"slot","icon-only"),_(e,"icon",lt),_(c,"slot","icon-only"),_(c,"icon",it)},m(f,u){F(f,l,u),t(l,e),F(f,s,u),F(f,r,u),t(r,c),n||(g=[j(l,"click",i[15]),j(r,"click",i[16])],n=!0)},p:le,d(f){f&&O(l),f&&O(s),f&&O(r),n=!1,de(g)}}}function Me(i){var De,Se,ze,Ce,Fe;let l,e,s,r,c,n,g,f,u,p=(((De=i[3])==null?void 0:De.food_total)||0).toFixed(2)+"",o,C,A,b,w,y,d,h,I,H,Q,q,P,X,G,K,Z,m,k,B,E,z,R,$,J,x,V=(i[3].water_total||0)+"",ie,_e,fe,ee,ue,ge,me,pe,be,te=new Date((Se=i[3])==null?void 0:Se.created_at).toLocaleDateString()+"",ne,we,oe=new Date((ze=i[3])==null?void 0:ze.created_at).toLocaleTimeString()+"",se,ye,he,ke,ae,ve,L=i[2]==="view"&&Pe(i),T=i[2]==="edit"&&Ue(i),W=i[2]==="view"&&je(i),N=i[2]==="edit"&&He(i),M=((Fe=(Ce=i[3])==null?void 0:Ce.food_log)==null?void 0:Fe.entries)&&Re(i);return{c(){l=a("ion-card"),e=a("ion-card-header"),s=a("ion-card-subtitle"),r=a("ion-grid"),c=a("ion-row"),n=a("ion-col"),n.textContent="\xA0",g=v(),f=a("ion-col"),u=S("Total: "),o=S(p),C=S("\xA0\xA0"),A=v(),b=a("ion-card-title"),L&&L.c(),w=v(),T&&T.c(),y=v(),d=a("ion-card-content"),W&&W.c(),h=v(),N&&N.c(),I=v(),H=a("br"),Q=v(),q=a("ion-list"),P=a("ion-reorder-group"),M&&M.c(),X=v(),G=a("ion-item"),K=a("ion-icon"),Z=S(`
						new food entry`),m=v(),k=a("ion-item"),B=S("Water"),E=a("ion-label"),z=a("ion-icon"),$=v(),J=a("span"),x=S("\xA0"),ie=S(V),_e=S("\xA0"),fe=v(),ee=a("ion-icon"),ue=v(),ge=a("br"),me=v(),pe=a("br"),be=S(`
				created: `),ne=S(te),we=v(),se=S(oe),ye=a("br"),he=v(),ke=a("br"),re(f,"text-align","right"),re(f,"font-weight","bold"),_(P,"id","food_log_group"),_(P,"disabled","false"),_(K,"icon",Le),_(K,"slot","start"),_(z,"color",R=i[3].water_total<=0?"medium":"dark"),_(z,"icon",nt),_(z,"size","large"),ce(J,"class","water-digits svelte-1ufanz"),_(ee,"icon",Le),_(ee,"size","large"),_(E,"slot","end"),_(E,"class","svelte-1ufanz"),_(q,"lines","full")},m(D,U){F(D,l,U),t(l,e),t(e,s),t(s,r),t(r,c),t(c,n),t(c,g),t(c,f),t(f,u),t(f,o),t(f,C),t(e,A),t(e,b),L&&L.m(b,null),t(b,w),T&&T.m(b,null),t(l,y),t(l,d),W&&W.m(d,null),t(d,h),N&&N.m(d,null),t(d,I),t(d,H),t(d,Q),t(d,q),t(q,P),M&&M.m(P,null),t(q,X),t(q,G),t(G,K),t(G,Z),t(q,m),t(q,k),t(k,B),t(k,E),t(E,z),t(E,$),t(E,J),t(J,x),t(J,ie),t(J,_e),t(E,fe),t(E,ee),t(d,ue),t(d,ge),t(d,me),t(d,pe),t(d,be),t(d,ne),t(d,we),t(d,se),t(d,ye),t(d,he),t(d,ke),ae||(ve=[j(P,"ionItemReorder",i[10]),j(G,"click",i[8]),j(z,"click",i[12]),j(ee,"click",i[11])],ae=!0)},p(D,U){var Oe,Be,Ee,Ie,qe;U&8&&p!==(p=(((Oe=D[3])==null?void 0:Oe.food_total)||0).toFixed(2)+"")&&Y(o,p),D[2]==="view"?L?L.p(D,U):(L=Pe(D),L.c(),L.m(b,w)):L&&(L.d(1),L=null),D[2]==="edit"?T?T.p(D,U):(T=Ue(D),T.c(),T.m(b,null)):T&&(T.d(1),T=null),D[2]==="view"?W?W.p(D,U):(W=je(D),W.c(),W.m(d,h)):W&&(W.d(1),W=null),D[2]==="edit"?N?N.p(D,U):(N=He(D),N.c(),N.m(d,I)):N&&(N.d(1),N=null),(Ee=(Be=D[3])==null?void 0:Be.food_log)!=null&&Ee.entries?M?M.p(D,U):(M=Re(D),M.c(),M.m(P,null)):M&&(M.d(1),M=null),U&8&&R!==(R=D[3].water_total<=0?"medium":"dark")&&_(z,"color",R),U&8&&V!==(V=(D[3].water_total||0)+"")&&Y(ie,V),U&8&&te!==(te=new Date((Ie=D[3])==null?void 0:Ie.created_at).toLocaleDateString()+"")&&Y(ne,te),U&8&&oe!==(oe=new Date((qe=D[3])==null?void 0:qe.created_at).toLocaleTimeString()+"")&&Y(se,oe)},d(D){D&&O(l),L&&L.d(),T&&T.d(),W&&W.d(),N&&N.d(),M&&M.d(),ae=!1,de(ve)}}}function Pe(i){var C,A;let l,e,s,r=((C=i[3])==null?void 0:C.date)+"",c,n,g,f,u=(i[0].daily_budget-((A=i[3])==null?void 0:A.food_total)||0).toFixed(2)+"",p,o;return{c(){l=a("ion-grid"),e=a("ion-row"),s=a("ion-col"),c=S(r),n=v(),g=a("ion-col"),f=S("["),p=S(u),o=S("]"),re(g,"text-align","right")},m(b,w){F(b,l,w),t(l,e),t(e,s),t(s,c),t(e,n),t(e,g),t(g,f),t(g,p),t(g,o)},p(b,w){var y,d;w&8&&r!==(r=((y=b[3])==null?void 0:y.date)+"")&&Y(c,r),w&9&&u!==(u=(b[0].daily_budget-((d=b[3])==null?void 0:d.food_total)||0).toFixed(2)+"")&&Y(p,u)},d(b){b&&O(l)}}}function Ue(i){let l,e,s,r,c;return{c(){l=a("ion-label"),l.textContent="Date:",e=a("ion-input"),_(l,"class","svelte-1ufanz"),_(e,"value",s=i[3].date),_(e,"required",""),_(e,"name","date"),_(e,"type","text"),_(e,"class","svelte-1ufanz")},m(n,g){F(n,l,g),F(n,e,g),r||(c=j(e,"ionChange",i[4]),r=!0)},p(n,g){g&8&&s!==(s=n[3].date)&&_(e,"value",s)},d(n){n&&O(l),n&&O(e),r=!1,c()}}}function je(i){var s;let l=((s=i[3])==null?void 0:s.notes)+"",e;return{c(){e=S(l)},m(r,c){F(r,e,c)},p(r,c){var n;c&8&&l!==(l=((n=r[3])==null?void 0:n.notes)+"")&&Y(e,l)},d(r){r&&O(e)}}}function He(i){let l,e,s,r,c;return{c(){l=a("ion-label"),l.textContent="Notes:",e=a("ion-input"),_(l,"class","svelte-1ufanz"),_(e,"value",s=i[3].notes),_(e,"required",""),_(e,"name","notes"),_(e,"type","text"),_(e,"class","svelte-1ufanz")},m(n,g){F(n,l,g),F(n,e,g),r||(c=j(e,"ionChange",i[4]),r=!0)},p(n,g){g&8&&s!==(s=n[3].notes)&&_(e,"value",s)},d(n){n&&O(l),n&&O(e),r=!1,c()}}}function Re(i){var r,c;let l,e=(c=(r=i[3])==null?void 0:r.food_log)==null?void 0:c.entries,s=[];for(let n=0;n<e.length;n+=1)s[n]=Ye(Te(i,e,n));return{c(){for(let n=0;n<s.length;n+=1)s[n].c();l=Qe()},m(n,g){for(let f=0;f<s.length;f+=1)s[f].m(n,g);F(n,l,g)},p(n,g){var f,u;if(g&520){e=(u=(f=n[3])==null?void 0:f.food_log)==null?void 0:u.entries;let p;for(p=0;p<e.length;p+=1){const o=Te(n,e,p);s[p]?s[p].p(o,g):(s[p]=Ye(o),s[p].c(),s[p].m(l.parentNode,l))}for(;p<s.length;p+=1)s[p].d(1);s.length=e.length}},d(n){Ve(s,n),n&&O(l)}}}function Ye(i){var m,k,B,E;let l,e,s,r,c=((m=i[25])==null?void 0:m.title)+"",n,g,f,u,p=(((k=i[25])==null?void 0:k.desc)||"")+"",o,C,A,b,w,y=(((B=i[25])==null?void 0:B.amt)||0).toFixed(2)+"",d,h,I,H,Q,q=(((E=i[25])==null?void 0:E.cat)||"")+"",P,X,G,K;function Z(){return i[17](i[27])}return{c(){l=a("ion-item"),e=a("ion-reorder"),s=v(),r=a("div"),n=S(c),g=a("br"),f=v(),u=a("span"),o=S(p),C=S("\xA0"),A=v(),b=a("ion-note"),w=a("div"),d=S(y),h=a("br"),I=v(),H=a("span"),Q=S("\xA0"),P=S(q),X=v(),_(e,"slot","start"),ce(u,"class","description svelte-1ufanz"),ce(H,"class","description svelte-1ufanz"),_(b,"slot","end"),_(b,"class","right svelte-1ufanz")},m(z,R){F(z,l,R),t(l,e),t(l,s),t(l,r),t(r,n),t(r,g),t(r,f),t(r,u),t(u,o),t(u,C),t(l,A),t(l,b),t(b,w),t(w,d),t(w,h),t(w,I),t(w,H),t(H,Q),t(H,P),t(l,X),G||(K=j(l,"click",Z),G=!0)},p(z,R){var $,J,x,V;i=z,R&8&&c!==(c=(($=i[25])==null?void 0:$.title)+"")&&Y(n,c),R&8&&p!==(p=(((J=i[25])==null?void 0:J.desc)||"")+"")&&Y(o,p),R&8&&y!==(y=(((x=i[25])==null?void 0:x.amt)||0).toFixed(2)+"")&&Y(d,y),R&8&&q!==(q=(((V=i[25])==null?void 0:V.cat)||"")+"")&&Y(P,q)},d(z){z&&O(l),G=!1,K()}}}function ft(i){let l,e,s,r,c,n,g,f,u,p,o,C,A,b,w=i[2]==="view"&&We(i),y=i[2]==="edit"&&Ne(i),d=i[3]&&Me(i);return{c(){l=a("ion-header"),e=a("ion-toolbar"),s=a("ion-buttons"),r=a("ion-button"),c=a("ion-icon"),n=v(),g=a("ion-title"),g.textContent="Day",f=v(),u=a("ion-buttons"),w&&w.c(),p=v(),y&&y.c(),o=v(),C=a("ion-content"),d&&d.c(),_(c,"slot","icon-only"),_(c,"icon",st),_(s,"slot","start"),_(u,"slot","end"),_(l,"translucent","true"),_(C,"class","ion-padding")},m(h,I){F(h,l,I),t(l,e),t(e,s),t(s,r),t(r,c),t(e,n),t(e,g),t(e,f),t(e,u),w&&w.m(u,null),t(u,p),y&&y.m(u,null),F(h,o,I),F(h,C,I),d&&d.m(C,null),A||(b=j(r,"click",i[13]),A=!0)},p(h,[I]){h[2]==="view"?w?w.p(h,I):(w=We(h),w.c(),w.m(u,p)):w&&(w.d(1),w=null),h[2]==="edit"?y?y.p(h,I):(y=Ne(h),y.c(),y.m(u,null)):y&&(y.d(1),y=null),h[3]?d?d.p(h,I):(d=Me(h),d.c(),d.m(C,null)):d&&(d.d(1),d=null)},i:le,o:le,d(h){h&&O(l),w&&w.d(),y&&y.d(),h&&O(o),h&&O(C),d&&d.d(),A=!1,b()}}}function ut(i,l,e){let s,r;Ae(i,$e,m=>e(21,s=m)),Ae(i,xe,m=>e(22,r=m));const c=dt.getInstance();let n=null,g,f={daily_budget:0,target_weight:0},u=r.id,p="view",o={};console.log("*** id",u);let C;u==="new"?(console.log("it is new"),o={id:c.gen_random_uuid(),user_id:(n==null?void 0:n.id)||null,created_at:new Date().toISOString(),date:new Date().toISOString().substring(0,10),food_log:{entries:[]},food_total:0,activity_log:{entries:[]},water_log:{entries:[]},water_total:0,weight:0,notes:""},p="edit",console.log("*** new day",o)):C=c.getDataSubscription("day",{id:u}).subscribe(m=>{e(3,o=m),console.log("*** day",o)}),Xe(async()=>{const{data:m,error:k}=await c.getSettings();console.log("*** settings",m,k),e(0,f=m.settings||{}),g=_t.user.subscribe(B=>{n=B})}),Ze(()=>{try{C.unsubscribe(),g.unsubscribe()}catch(m){console.error("error unsubscribing",m)}});const A=m=>{if(typeof o[m.target.name]=="number")try{e(3,o[m.target.name]=parseFloat(m.target.value),o)}catch{e(3,o[m.target.name]=0,o)}else e(3,o[m.target.name]=m.target.value,o)},b=async()=>{console.log("save the day",o),console.log("id is currently",u);let m=!1;u==="new"&&(m=!0),o.user_id||e(3,o.user_id=n.id,o);try{e(3,o.food_total=0,o),o.food_log.entries.forEach(B=>{e(3,o.food_total+=B.amt,o)})}catch(B){console.error("error calculating food total",B)}const{error:k}=await c.save_day(o);k?(console.log("error message is: ",k.message),k.message.startsWith("duplicate key value violates unique constraint")?(console.log("DUPLICATE DAY"),rt({header:"Duplicate Day",message:"This day already exists.  Please edit the existing day."})):console.error("save day error",k)):(e(1,u=o.id),e(2,p="view")),m&&(console.log("*** day is new, redirect to","/day/"+o.id),s("/day/"+o.id))},w=async()=>{await ct({header:"Delete Day",message:"Are you sure?",okHander:async()=>{const{data:m,error:k}=await c.delete_day(o);k?console.error("Error deleting day",k):y()}})},y=()=>{s("/days")},d=async m=>{o.food_log.entries||e(3,o.food_log.entries=[],o);const k={id:c.gen_random_uuid(),food_id:"",title:"",desc:"",cat:"",cps:0,qty:1,amt:0,created:new Date().toISOString()},B=await H(k,o.food_log.entries.length,!0);console.log("done calling openFoodEntryBox",B),console.log("day.food_log.entries",o.food_log.entries),e(3,o.food_log.entries=[...o.food_log.entries],o),b()},h=async m=>{const k=await H(o.food_log.entries[m],m,!1);console.log("edit_food_log_entry is done calling openFoodEntryBox",k),console.log("day.food_log.entries",o.food_log.entries),e(3,o.food_log.entries=[...o.food_log.entries],o),b()},I=({detail:m})=>{const{from:k,to:B}=m,E=o.food_log.entries.splice(k,1)[0];o.food_log.entries.splice(B,0,E),m.complete(),console.log("reorder_food_log: day",o),b()},H=async(m,k,B)=>{const E=await et.create({component:at,componentProps:{entry:m,isNew:B},showBackdrop:!0,backdropDismiss:!0});await E.present();const{data:z}=await E.onWillDismiss();return(z==null?void 0:z.data)!==null?(z.data.deleted?o.food_log.entries.splice(k,1):e(3,o.food_log.entries[k]=z.data,o),console.log("*** day.food_log.entries",o.food_log.entries),!0):!1};async function Q(){o.water_log.entries.push({id:c.gen_random_uuid(),amt:1,created:new Date().toISOString()}),e(3,o.water_total++,o),b()}async function q(){o.water_total<=0||(o.water_log.entries.pop(),e(3,o.water_total--,o),b())}return[f,u,p,o,A,b,w,y,d,h,I,Q,q,()=>{y()},()=>{e(2,p="edit")},()=>{e(2,p="view"),u==="add"&&y()},()=>{b()},m=>{h(m)}]}class Ct extends Ge{constructor(l){super(),Je(this,l,ut,ft,Ke,{})}}export{Ct as default};
