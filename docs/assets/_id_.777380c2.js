import{S as _t,i as ut,s as gt,b as s,c as b,d as _,a as D,f as o,l as W,H as ye,g as S,v as Be,t as F,j as de,k as Q,o as R,e as pt,u as mt,w as Oe,x as bt,z as yt}from"./index.eb52a671.js";import{g as kt,p as wt}from"./index.35f69efb.js";import{m as vt}from"./controllers.9a432cb6.js";import{y as ht,C as Dt,r as St,B as Ct,D as et,E as Ft,F as Ot}from"./index.f1a9933f.js";import Bt from"./FoodEntryModal.1ad3bc4e.js";import{a as It,s as Et}from"./alert.9c3dc46f.js";import{S as Tt,U as zt}from"./supabase.data.service.a8f3749a.js";import{c as Wt}from"./user.store.3bd0d5f8.js";import"./overlays-ab6211c7.3188e648.js";import"./FoodSearchModal.0c558486.js";import"./BehaviorSubject.8ebd0647.js";import"./loadingMessage.b127c548.js";function tt(n,l,e){const r=n.slice();return r[26]=l[e],r[28]=e,r}function ot(n){let l,e,r,a,d,i,c;return{c(){l=s("ion-button"),e=s("ion-icon"),r=b(),a=s("ion-button"),d=s("ion-icon"),_(e,"slot","icon-only"),_(e,"icon",ht),_(d,"slot","icon-only"),_(d,"icon",Dt)},m(f,t){D(f,l,t),o(l,e),D(f,r,t),D(f,a,t),o(a,d),i||(c=[W(l,"click",n[6]),W(a,"click",n[16])],i=!0)},p:ye,d(f){f&&S(l),f&&S(r),f&&S(a),i=!1,Be(c)}}}function lt(n){let l,e,r,a,d,i,c;return{c(){l=s("ion-button"),e=s("ion-icon"),r=b(),a=s("ion-button"),d=s("ion-icon"),_(e,"slot","icon-only"),_(e,"icon",St),_(d,"slot","icon-only"),_(d,"icon",Ct)},m(f,t){D(f,l,t),o(l,e),D(f,r,t),D(f,a,t),o(a,d),i||(c=[W(l,"click",n[17]),W(a,"click",n[18])],i=!0)},p:ye,d(f){f&&S(l),f&&S(r),f&&S(a),i=!1,Be(c)}}}function nt(n){var Ae,Pe,He,Re,Ve,je,Ye;let l,e,r,a,d,i,c,f=(((Ae=n[2])==null?void 0:Ae.food_total)||0).toFixed(2)+"",t,m,h,C,O,B,w,g,v,k,T,V,H,N,Z,J,K,ee,ie,u,y,z,j,I=new Date((Pe=n[2])==null?void 0:Pe.created_at).toLocaleDateString()+"",Y,re,x=new Date((He=n[2])==null?void 0:He.created_at).toLocaleTimeString()+"",te,se,Ie,Ee,ke,fe,we,ve,he,ae,De,oe,_e,Te,ue,G,ge,ze,Se,le,pe,We,X,$,me,Ne,ne,Le,be=(n[2].water_total||0)+"",Ce,qe,Ue,ce,Fe,Me,L=((Ve=(Re=n[3])==null?void 0:Re.user_metadata)==null?void 0:Ve.daily_budget)&&it(n),q=n[1]==="view"&&rt(n),U=n[1]==="edit"&&st(n),M=n[1]==="view"&&at(n),A=n[1]==="edit"&&ct(n),P=((Ye=(je=n[2])==null?void 0:je.food_log)==null?void 0:Ye.entries)&&dt(n);return{c(){var p;l=s("ion-card"),e=s("ion-card-header"),r=s("ion-card-subtitle"),a=s("ion-grid"),d=s("ion-row"),i=s("ion-col"),c=F("Total: "),t=F(f),m=b(),h=s("ion-col"),L&&L.c(),C=b(),O=s("ion-card-title"),q&&q.c(),B=b(),U&&U.c(),w=b(),g=s("ion-card-content"),M&&M.c(),v=b(),A&&A.c(),k=b(),T=s("br"),V=b(),H=s("ion-list"),N=s("ion-reorder-group"),P&&P.c(),Z=b(),J=s("ion-item"),K=s("ion-icon"),ee=F(`
						new food entry`),ie=b(),u=s("br"),y=b(),z=s("br"),j=F(`
				created: `),Y=F(I),re=b(),te=F(x),se=s("br"),Ie=b(),Ee=s("br"),ke=b(),fe=s("ion-footer"),we=s("ion-card"),ve=s("ion-card-content"),he=s("ion-grid"),ae=s("ion-row"),De=s("ion-col"),oe=s("div"),_e=s("div"),_e.textContent="Weight",Te=b(),ue=s("div"),G=s("ion-input"),ze=b(),Se=s("ion-col"),le=s("div"),pe=s("div"),pe.textContent="Water",We=b(),X=s("div"),$=s("ion-icon"),Ne=b(),ne=s("span"),Le=F("\xA0"),Ce=F(be),qe=F("\xA0"),Ue=b(),ce=s("ion-icon"),de(i,"text-align","left"),de(i,"font-weight","bold"),de(h,"text-align","right"),de(h,"font-weight","bold"),de(O,"text-align","center"),_(N,"id","food_log_group"),_(N,"disabled","false"),_(K,"icon",et),_(K,"slot","start"),_(H,"lines","full"),Q(_e,"class","footertitle svelte-1nypkbx"),_(G,"name","weight"),_(G,"class","weightBox svelte-1nypkbx"),_(G,"type","number"),_(G,"value",ge=(p=n[2])==null?void 0:p.weight),Q(ue,"class","footertitle svelte-1nypkbx"),Q(oe,"class","left svelte-1nypkbx"),Q(pe,"class","footertitle svelte-1nypkbx"),_($,"color",me=n[2].water_total<=0?"medium":"dark"),_($,"icon",Ft),_($,"size","large"),Q(ne,"class","water-digits svelte-1nypkbx"),_(ce,"icon",et),_(ce,"size","large"),Q(X,"class","footertitle together svelte-1nypkbx"),Q(le,"class","right svelte-1nypkbx")},m(p,E){D(p,l,E),o(l,e),o(e,r),o(r,a),o(a,d),o(d,i),o(i,c),o(i,t),o(d,m),o(d,h),L&&L.m(h,null),o(e,C),o(e,O),q&&q.m(O,null),o(O,B),U&&U.m(O,null),o(l,w),o(l,g),M&&M.m(g,null),o(g,v),A&&A.m(g,null),o(g,k),o(g,T),o(g,V),o(g,H),o(H,N),P&&P.m(N,null),o(H,Z),o(H,J),o(J,K),o(J,ee),o(g,ie),o(g,u),o(g,y),o(g,z),o(g,j),o(g,Y),o(g,re),o(g,te),o(g,se),o(g,Ie),o(g,Ee),D(p,ke,E),D(p,fe,E),o(fe,we),o(we,ve),o(ve,he),o(he,ae),o(ae,De),o(De,oe),o(oe,_e),o(oe,Te),o(oe,ue),o(ue,G),o(ae,ze),o(ae,Se),o(Se,le),o(le,pe),o(le,We),o(le,X),o(X,$),o(X,Ne),o(X,ne),o(ne,Le),o(ne,Ce),o(ne,qe),o(X,Ue),o(X,ce),Fe||(Me=[W(N,"ionItemReorder",n[10]),W(J,"click",n[8]),W(G,"ionChange",n[13]),W(G,"ionFocus",Lt),W(G,"ionBlur",n[14]),W($,"click",n[12]),W(ce,"click",n[11])],Fe=!0)},p(p,E){var Ge,Je,Ke,Qe,Xe,Ze,xe,$e;E&4&&f!==(f=(((Ge=p[2])==null?void 0:Ge.food_total)||0).toFixed(2)+"")&&R(t,f),(Ke=(Je=p[3])==null?void 0:Je.user_metadata)!=null&&Ke.daily_budget?L?L.p(p,E):(L=it(p),L.c(),L.m(h,null)):L&&(L.d(1),L=null),p[1]==="view"?q?q.p(p,E):(q=rt(p),q.c(),q.m(O,B)):q&&(q.d(1),q=null),p[1]==="edit"?U?U.p(p,E):(U=st(p),U.c(),U.m(O,null)):U&&(U.d(1),U=null),p[1]==="view"?M?M.p(p,E):(M=at(p),M.c(),M.m(g,v)):M&&(M.d(1),M=null),p[1]==="edit"?A?A.p(p,E):(A=ct(p),A.c(),A.m(g,k)):A&&(A.d(1),A=null),(Xe=(Qe=p[2])==null?void 0:Qe.food_log)!=null&&Xe.entries?P?P.p(p,E):(P=dt(p),P.c(),P.m(N,null)):P&&(P.d(1),P=null),E&4&&I!==(I=new Date((Ze=p[2])==null?void 0:Ze.created_at).toLocaleDateString()+"")&&R(Y,I),E&4&&x!==(x=new Date((xe=p[2])==null?void 0:xe.created_at).toLocaleTimeString()+"")&&R(te,x),E&4&&ge!==(ge=($e=p[2])==null?void 0:$e.weight)&&_(G,"value",ge),E&4&&me!==(me=p[2].water_total<=0?"medium":"dark")&&_($,"color",me),E&4&&be!==(be=(p[2].water_total||0)+"")&&R(Ce,be)},d(p){p&&S(l),L&&L.d(),q&&q.d(),U&&U.d(),M&&M.d(),A&&A.d(),P&&P.d(),p&&S(ke),p&&S(fe),Fe=!1,Be(Me)}}}function it(n){var a,d,i;let l,e=(((d=(a=n[3])==null?void 0:a.user_metadata)==null?void 0:d.daily_budget)-((i=n[2])==null?void 0:i.food_total)||0).toFixed(2)+"",r;return{c(){l=F("Left: "),r=F(e)},m(c,f){D(c,l,f),D(c,r,f)},p(c,f){var t,m,h;f&12&&e!==(e=(((m=(t=c[3])==null?void 0:t.user_metadata)==null?void 0:m.daily_budget)-((h=c[2])==null?void 0:h.food_total)||0).toFixed(2)+"")&&R(r,e)},d(c){c&&S(l),c&&S(r)}}}function rt(n){var r,a;let l=new Date(new Date((r=n[2])==null?void 0:r.date).getTime()+new Date((a=n[2])==null?void 0:a.date).getTimezoneOffset()*6e4).toDateString()+"",e;return{c(){e=F(l)},m(d,i){D(d,e,i)},p(d,i){var c,f;i&4&&l!==(l=new Date(new Date((c=d[2])==null?void 0:c.date).getTime()+new Date((f=d[2])==null?void 0:f.date).getTimezoneOffset()*6e4).toDateString()+"")&&R(e,l)},d(d){d&&S(e)}}}function st(n){let l,e,r,a,d;return{c(){l=s("ion-label"),l.textContent="Date:",e=s("ion-input"),_(l,"class","svelte-1nypkbx"),_(e,"value",r=n[2].date),_(e,"required",""),_(e,"name","date"),_(e,"type","text"),_(e,"class","svelte-1nypkbx")},m(i,c){D(i,l,c),D(i,e,c),a||(d=W(e,"ionChange",n[4]),a=!0)},p(i,c){c&4&&r!==(r=i[2].date)&&_(e,"value",r)},d(i){i&&S(l),i&&S(e),a=!1,d()}}}function at(n){var r;let l=((r=n[2])==null?void 0:r.notes)+"",e;return{c(){e=F(l)},m(a,d){D(a,e,d)},p(a,d){var i;d&4&&l!==(l=((i=a[2])==null?void 0:i.notes)+"")&&R(e,l)},d(a){a&&S(e)}}}function ct(n){let l,e,r,a,d;return{c(){l=s("ion-label"),l.textContent="Notes:",e=s("ion-input"),_(l,"class","svelte-1nypkbx"),_(e,"value",r=n[2].notes),_(e,"required",""),_(e,"name","notes"),_(e,"type","text"),_(e,"class","svelte-1nypkbx")},m(i,c){D(i,l,c),D(i,e,c),a||(d=W(e,"ionChange",n[4]),a=!0)},p(i,c){c&4&&r!==(r=i[2].notes)&&_(e,"value",r)},d(i){i&&S(l),i&&S(e),a=!1,d()}}}function dt(n){var a,d;let l,e=(d=(a=n[2])==null?void 0:a.food_log)==null?void 0:d.entries,r=[];for(let i=0;i<e.length;i+=1)r[i]=ft(tt(n,e,i));return{c(){for(let i=0;i<r.length;i+=1)r[i].c();l=pt()},m(i,c){for(let f=0;f<r.length;f+=1)r[f].m(i,c);D(i,l,c)},p(i,c){var f,t;if(c&516){e=(t=(f=i[2])==null?void 0:f.food_log)==null?void 0:t.entries;let m;for(m=0;m<e.length;m+=1){const h=tt(i,e,m);r[m]?r[m].p(h,c):(r[m]=ft(h),r[m].c(),r[m].m(l.parentNode,l))}for(;m<r.length;m+=1)r[m].d(1);r.length=e.length}},d(i){mt(r,i),i&&S(l)}}}function ft(n){var u,y,z,j;let l,e,r,a,d=((u=n[26])==null?void 0:u.title)+"",i,c,f,t,m=(((y=n[26])==null?void 0:y.desc)||"")+"",h,C,O,B,w,g=(((z=n[26])==null?void 0:z.amt)||0).toFixed(2)+"",v,k,T,V,H,N=(((j=n[26])==null?void 0:j.cat)||"")+"",Z,J,K,ee;function ie(){return n[19](n[28])}return{c(){l=s("ion-item"),e=s("ion-reorder"),r=b(),a=s("div"),i=F(d),c=s("br"),f=b(),t=s("span"),h=F(m),C=F("\xA0"),O=b(),B=s("ion-note"),w=s("div"),v=F(g),k=s("br"),T=b(),V=s("span"),H=F("\xA0"),Z=F(N),J=b(),_(e,"slot","start"),Q(t,"class","description svelte-1nypkbx"),Q(V,"class","description svelte-1nypkbx"),_(B,"slot","end"),_(B,"class","right svelte-1nypkbx")},m(I,Y){D(I,l,Y),o(l,e),o(l,r),o(l,a),o(a,i),o(a,c),o(a,f),o(a,t),o(t,h),o(t,C),o(l,O),o(l,B),o(B,w),o(w,v),o(w,k),o(w,T),o(w,V),o(V,H),o(V,Z),o(l,J),K||(ee=W(l,"click",ie),K=!0)},p(I,Y){var re,x,te,se;n=I,Y&4&&d!==(d=((re=n[26])==null?void 0:re.title)+"")&&R(i,d),Y&4&&m!==(m=(((x=n[26])==null?void 0:x.desc)||"")+"")&&R(h,m),Y&4&&g!==(g=(((te=n[26])==null?void 0:te.amt)||0).toFixed(2)+"")&&R(v,g),Y&4&&N!==(N=(((se=n[26])==null?void 0:se.cat)||"")+"")&&R(Z,N)},d(I){I&&S(l),K=!1,ee()}}}function Nt(n){let l,e,r,a,d,i,c,f,t,m,h,C,O,B,w=n[1]==="view"&&ot(n),g=n[1]==="edit"&&lt(n),v=n[2]&&nt(n);return{c(){l=s("ion-header"),e=s("ion-toolbar"),r=s("ion-buttons"),a=s("ion-button"),d=s("ion-icon"),i=b(),c=s("ion-title"),c.textContent="Day",f=b(),t=s("ion-buttons"),w&&w.c(),m=b(),g&&g.c(),h=b(),C=s("ion-content"),v&&v.c(),_(d,"slot","icon-only"),_(d,"icon",Ot),_(r,"slot","start"),_(t,"slot","end"),_(l,"translucent","true"),_(C,"class","ion-padding")},m(k,T){D(k,l,T),o(l,e),o(e,r),o(r,a),o(a,d),o(e,i),o(e,c),o(e,f),o(e,t),w&&w.m(t,null),o(t,m),g&&g.m(t,null),D(k,h,T),D(k,C,T),v&&v.m(C,null),O||(B=W(a,"click",n[15]),O=!0)},p(k,[T]){k[1]==="view"?w?w.p(k,T):(w=ot(k),w.c(),w.m(t,m)):w&&(w.d(1),w=null),k[1]==="edit"?g?g.p(k,T):(g=lt(k),g.c(),g.m(t,null)):g&&(g.d(1),g=null),k[2]?v?v.p(k,T):(v=nt(k),v.c(),v.m(C,null)):v&&(v.d(1),v=null)},i:ye,o:ye,d(k){k&&S(l),w&&w.d(),g&&g.d(),k&&S(h),k&&S(C),v&&v.d(),O=!1,B()}}}function Lt(n){try{(parseFloat(n.target.value)||0)===0&&(n.target.value="")}catch(l){console.error("error clearing zero value",l)}n.target.getInputElement().then(l=>{console.log("input",l),l.type="text",l.setSelectionRange(l.value.length,l.value.length),l.type="number"})}function qt(n,l,e){let r,a,d;Oe(n,kt,u=>e(21,r=u)),Oe(n,Wt,u=>e(3,a=u)),Oe(n,wt,u=>e(22,d=u));const i=Tt.getInstance();zt.getInstance();let c=d.id,f="view",t={};console.log("*** id",c);let m;c==="new"?(console.log("it is new"),t={id:i.gen_random_uuid(),user_id:(a==null?void 0:a.id)||null,created_at:new Date().toISOString(),date:new Date().toISOString().substring(0,10),food_log:{entries:[]},food_total:0,activity_log:{entries:[]},water_log:{entries:[]},water_total:0,weight:0,notes:""},f="edit",console.log("*** new day",t)):m=i.getDataSubscription("day",{id:c}).subscribe(u=>{e(2,t=u),console.log("*** day",t)}),bt(async()=>{if(console.log("day onMount, $currentUser",a),!a){r("/info");return}if(c==="new")try{const{data:u,error:y}=await i.getCurrentWeight();y?(console.error("getCurrentWeight error",y),e(2,t.weight=0,t)):e(2,t.weight=u.weight,t)}catch(u){console.log("exception",u),e(2,t.weight=0,t)}}),yt(()=>{try{m&&m.unsubscribe()}catch(u){console.error("error unsubscribing",u)}});const h=u=>{if(typeof t[u.target.name]=="number")try{e(2,t[u.target.name]=parseFloat(u.target.value),t)}catch{e(2,t[u.target.name]=0,t)}else e(2,t[u.target.name]=u.target.value,t)},C=async()=>{console.log("save the day",t),console.log("id is currently",c);let u=!1;c==="new"&&(u=!0),t.user_id||e(2,t.user_id=user.id,t);try{e(2,t.food_total=0,t),t.food_log.entries.forEach(z=>{e(2,t.food_total+=z.amt,t)})}catch(z){console.error("error calculating food total",z)}const{error:y}=await i.save_day(t);y?(console.log("error message is: ",y.message),y.message.startsWith("duplicate key value violates unique constraint")?(console.log("DUPLICATE DAY"),It({header:"Duplicate Day",message:"This day already exists.  Please edit the existing day."})):console.error("save day error",y)):(e(0,c=t.id),e(1,f="view")),u&&(console.log("*** day is new, redirect to","/day/"+t.id),r("/day/"+t.id))},O=async()=>{await Et({header:"Delete Day",message:"Are you sure?",okHander:async()=>{const{data:u,error:y}=await i.delete_day(t);y?console.error("Error deleting day",y):B()}})},B=()=>{r("/calendar")},w=async u=>{t.food_log.entries||e(2,t.food_log.entries=[],t);const y={id:i.gen_random_uuid(),food_id:"",title:"",desc:"",cat:"",cps:0,qty:1,amt:0,created:new Date().toISOString()},z=await k(y,t.food_log.entries.length,!0);console.log("done calling openFoodEntryBox",z),console.log("day.food_log.entries",t.food_log.entries),e(2,t.food_log.entries=[...t.food_log.entries],t),C()},g=async u=>{const y=await k(t.food_log.entries[u],u,!1);console.log("edit_food_log_entry is done calling openFoodEntryBox",y),console.log("day.food_log.entries",t.food_log.entries),e(2,t.food_log.entries=[...t.food_log.entries],t),C()},v=({detail:u})=>{const{from:y,to:z}=u,j=t.food_log.entries.splice(y,1)[0];t.food_log.entries.splice(z,0,j),u.complete(),console.log("reorder_food_log: day",t),C()},k=async(u,y,z)=>{const j=await vt.create({component:Bt,componentProps:{entry:u,isNew:z},showBackdrop:!0,backdropDismiss:!0});await j.present();const{data:I}=await j.onWillDismiss();return(I==null?void 0:I.data)!==null?(I.data.deleted?t.food_log.entries.splice(y,1):e(2,t.food_log.entries[y]=I.data,t),console.log("*** day.food_log.entries",t.food_log.entries),!0):!1};async function T(){t.water_log.entries.push({id:i.gen_random_uuid(),amt:1,created:new Date().toISOString()}),e(2,t.water_total++,t),C()}async function V(){t.water_total<=0||(t.water_log.entries.pop(),e(2,t.water_total--,t),C())}function H(u){try{e(2,t[u.target.name]=parseFloat(u.target.value)||0,t)}catch(y){console.error("handleNumberValue error",y),e(2,t[u.target.name]=0,t)}}function N(u){C()}return[c,f,t,a,h,C,O,B,w,g,v,T,V,H,N,()=>{B()},()=>{e(1,f="edit")},()=>{e(1,f="view"),c==="add"&&B()},()=>{C()},u=>{g(u)}]}class Qt extends _t{constructor(l){super(),ut(this,l,qt,Nt,gt,{})}}export{Qt as default};
