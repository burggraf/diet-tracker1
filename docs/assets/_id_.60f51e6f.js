import{S as Ze,i as $e,s as xe,e as r,a as y,b as c,d as C,f as t,l as P,n as de,h as O,r as be,t as F,c as te,j as me,z as j,x as et,w as tt,B as Ne,y as ot,D as lt}from"./index.3b99544b.js";import{g as it,p as nt}from"./index.adc0f02e.js";import{m as st}from"./controllers.4cd5a482.js";import{y as rt,C as at,o as dt,B as ct,D as Pe,E as _t,F as ft}from"./index.8307df69.js";import ut from"./FoodEntryModal.f951d753.js";import{a as gt,s as pt}from"./alert.09d60774.js";import{S as mt,U as bt}from"./supabase.data.service.9bca2e3e.js";import{S as wt}from"./supabase.auth.service.c79e3f60.js";import"./overlays-ab6211c7.940f661b.js";import"./FoodSearchModal.5460be05.js";import"./BehaviorSubject.76cebf4d.js";import"./network.service.3f421770.js";function je(n,l,e){const s=n.slice();return s[26]=l[e],s[28]=e,s}function He(n){let l,e,s,d,a,i,g;return{c(){l=r("ion-button"),e=r("ion-icon"),s=y(),d=r("ion-button"),a=r("ion-icon"),c(e,"slot","icon-only"),c(e,"icon",rt),c(a,"slot","icon-only"),c(a,"icon",at)},m(f,u){C(f,l,u),t(l,e),C(f,s,u),C(f,d,u),t(d,a),i||(g=[P(l,"click",n[6]),P(d,"click",n[14])],i=!0)},p:de,d(f){f&&O(l),f&&O(s),f&&O(d),i=!1,be(g)}}}function Re(n){let l,e,s,d,a,i,g;return{c(){l=r("ion-button"),e=r("ion-icon"),s=y(),d=r("ion-button"),a=r("ion-icon"),c(e,"slot","icon-only"),c(e,"icon",dt),c(a,"slot","icon-only"),c(a,"icon",ct)},m(f,u){C(f,l,u),t(l,e),C(f,s,u),C(f,d,u),t(d,a),i||(g=[P(l,"click",n[15]),P(d,"click",n[16])],i=!0)},p:de,d(f){f&&O(l),f&&O(s),f&&O(d),i=!1,be(g)}}}function Ye(n){var Oe,Be,Ee,Te,Ie,ze;let l,e,s,d,a,i,g,f=(((Oe=n[3])==null?void 0:Oe.food_total)||0).toFixed(2)+"",u,b,o,E,U=(n[0].daily_budget-((Be=n[3])==null?void 0:Be.food_total)||0).toFixed(2)+"",S,h,m,D,k,p,M,K,Y,V,H,N,$,Q,_,v,B,R,I,G,oe,X=new Date((Ee=n[3])==null?void 0:Ee.created_at).toLocaleDateString()+"",x,le,ne=new Date((Te=n[3])==null?void 0:Te.created_at).toLocaleTimeString()+"",ce,we,he,ke,_e,se,fe,ue,J,ye,Z,re,ve,ee,De,ae=(n[3].water_total||0)+"",ge,Se,Fe,ie,pe,Ce,z=n[2]==="view"&&Ge(n),L=n[2]==="edit"&&Je(n),q=n[2]==="view"&&Ke(n),W=n[2]==="edit"&&Qe(n),A=((ze=(Ie=n[3])==null?void 0:Ie.food_log)==null?void 0:ze.entries)&&Ve(n);return{c(){l=r("ion-card"),e=r("ion-card-header"),s=r("ion-card-subtitle"),d=r("ion-grid"),a=r("ion-row"),i=r("ion-col"),g=F("Total: "),u=F(f),b=y(),o=r("ion-col"),E=F("Left: "),S=F(U),h=y(),m=r("ion-card-title"),z&&z.c(),D=y(),L&&L.c(),k=y(),p=r("ion-card-content"),q&&q.c(),M=y(),W&&W.c(),K=y(),Y=r("br"),V=y(),H=r("ion-list"),N=r("ion-reorder-group"),A&&A.c(),$=y(),Q=r("ion-item"),_=r("ion-icon"),v=F(`
						new food entry`),B=y(),R=r("br"),I=y(),G=r("br"),oe=F(`
				created: `),x=F(X),le=y(),ce=F(ne),we=r("br"),he=y(),ke=r("br"),_e=y(),se=r("ion-footer"),fe=r("ion-card"),ue=r("ion-card-content"),J=r("h1"),ye=F(`Water\xA0\xA0
						`),Z=r("ion-icon"),ve=y(),ee=r("span"),De=F("\xA0"),ge=F(ae),Se=F("\xA0"),Fe=y(),ie=r("ion-icon"),te(i,"text-align","left"),te(i,"font-weight","bold"),te(o,"text-align","right"),te(o,"font-weight","bold"),te(m,"text-align","center"),c(N,"id","food_log_group"),c(N,"disabled","false"),c(_,"icon",Pe),c(_,"slot","start"),c(H,"lines","full"),c(Z,"color",re=n[3].water_total<=0?"medium":"dark"),c(Z,"icon",_t),c(Z,"size","large"),me(ee,"class","water-digits svelte-wghhpk"),c(ie,"icon",Pe),c(ie,"size","large"),te(J,"text-align","right")},m(w,T){C(w,l,T),t(l,e),t(e,s),t(s,d),t(d,a),t(a,i),t(i,g),t(i,u),t(a,b),t(a,o),t(o,E),t(o,S),t(e,h),t(e,m),z&&z.m(m,null),t(m,D),L&&L.m(m,null),t(l,k),t(l,p),q&&q.m(p,null),t(p,M),W&&W.m(p,null),t(p,K),t(p,Y),t(p,V),t(p,H),t(H,N),A&&A.m(N,null),t(H,$),t(H,Q),t(Q,_),t(Q,v),t(p,B),t(p,R),t(p,I),t(p,G),t(p,oe),t(p,x),t(p,le),t(p,ce),t(p,we),t(p,he),t(p,ke),C(w,_e,T),C(w,se,T),t(se,fe),t(fe,ue),t(ue,J),t(J,ye),t(J,Z),t(J,ve),t(J,ee),t(ee,De),t(ee,ge),t(ee,Se),t(J,Fe),t(J,ie),pe||(Ce=[P(N,"ionItemReorder",n[10]),P(Q,"click",n[8]),P(Z,"click",n[12]),P(ie,"click",n[11])],pe=!0)},p(w,T){var Le,qe,We,Ae,Ue,Me;T&8&&f!==(f=(((Le=w[3])==null?void 0:Le.food_total)||0).toFixed(2)+"")&&j(u,f),T&9&&U!==(U=(w[0].daily_budget-((qe=w[3])==null?void 0:qe.food_total)||0).toFixed(2)+"")&&j(S,U),w[2]==="view"?z?z.p(w,T):(z=Ge(w),z.c(),z.m(m,D)):z&&(z.d(1),z=null),w[2]==="edit"?L?L.p(w,T):(L=Je(w),L.c(),L.m(m,null)):L&&(L.d(1),L=null),w[2]==="view"?q?q.p(w,T):(q=Ke(w),q.c(),q.m(p,M)):q&&(q.d(1),q=null),w[2]==="edit"?W?W.p(w,T):(W=Qe(w),W.c(),W.m(p,K)):W&&(W.d(1),W=null),(Ae=(We=w[3])==null?void 0:We.food_log)!=null&&Ae.entries?A?A.p(w,T):(A=Ve(w),A.c(),A.m(N,null)):A&&(A.d(1),A=null),T&8&&X!==(X=new Date((Ue=w[3])==null?void 0:Ue.created_at).toLocaleDateString()+"")&&j(x,X),T&8&&ne!==(ne=new Date((Me=w[3])==null?void 0:Me.created_at).toLocaleTimeString()+"")&&j(ce,ne),T&8&&re!==(re=w[3].water_total<=0?"medium":"dark")&&c(Z,"color",re),T&8&&ae!==(ae=(w[3].water_total||0)+"")&&j(ge,ae)},d(w){w&&O(l),z&&z.d(),L&&L.d(),q&&q.d(),W&&W.d(),A&&A.d(),w&&O(_e),w&&O(se),pe=!1,be(Ce)}}}function Ge(n){var s,d;let l=new Date(new Date((s=n[3])==null?void 0:s.date).getTime()+new Date((d=n[3])==null?void 0:d.date).getTimezoneOffset()*6e4).toDateString()+"",e;return{c(){e=F(l)},m(a,i){C(a,e,i)},p(a,i){var g,f;i&8&&l!==(l=new Date(new Date((g=a[3])==null?void 0:g.date).getTime()+new Date((f=a[3])==null?void 0:f.date).getTimezoneOffset()*6e4).toDateString()+"")&&j(e,l)},d(a){a&&O(e)}}}function Je(n){let l,e,s,d,a;return{c(){l=r("ion-label"),l.textContent="Date:",e=r("ion-input"),c(l,"class","svelte-wghhpk"),c(e,"value",s=n[3].date),c(e,"required",""),c(e,"name","date"),c(e,"type","text"),c(e,"class","svelte-wghhpk")},m(i,g){C(i,l,g),C(i,e,g),d||(a=P(e,"ionChange",n[4]),d=!0)},p(i,g){g&8&&s!==(s=i[3].date)&&c(e,"value",s)},d(i){i&&O(l),i&&O(e),d=!1,a()}}}function Ke(n){var s;let l=((s=n[3])==null?void 0:s.notes)+"",e;return{c(){e=F(l)},m(d,a){C(d,e,a)},p(d,a){var i;a&8&&l!==(l=((i=d[3])==null?void 0:i.notes)+"")&&j(e,l)},d(d){d&&O(e)}}}function Qe(n){let l,e,s,d,a;return{c(){l=r("ion-label"),l.textContent="Notes:",e=r("ion-input"),c(l,"class","svelte-wghhpk"),c(e,"value",s=n[3].notes),c(e,"required",""),c(e,"name","notes"),c(e,"type","text"),c(e,"class","svelte-wghhpk")},m(i,g){C(i,l,g),C(i,e,g),d||(a=P(e,"ionChange",n[4]),d=!0)},p(i,g){g&8&&s!==(s=i[3].notes)&&c(e,"value",s)},d(i){i&&O(l),i&&O(e),d=!1,a()}}}function Ve(n){var d,a;let l,e=(a=(d=n[3])==null?void 0:d.food_log)==null?void 0:a.entries,s=[];for(let i=0;i<e.length;i+=1)s[i]=Xe(je(n,e,i));return{c(){for(let i=0;i<s.length;i+=1)s[i].c();l=et()},m(i,g){for(let f=0;f<s.length;f+=1)s[f].m(i,g);C(i,l,g)},p(i,g){var f,u;if(g&520){e=(u=(f=i[3])==null?void 0:f.food_log)==null?void 0:u.entries;let b;for(b=0;b<e.length;b+=1){const o=je(i,e,b);s[b]?s[b].p(o,g):(s[b]=Xe(o),s[b].c(),s[b].m(l.parentNode,l))}for(;b<s.length;b+=1)s[b].d(1);s.length=e.length}},d(i){tt(s,i),i&&O(l)}}}function Xe(n){var _,v,B,R;let l,e,s,d,a=((_=n[26])==null?void 0:_.title)+"",i,g,f,u,b=(((v=n[26])==null?void 0:v.desc)||"")+"",o,E,U,S,h,m=(((B=n[26])==null?void 0:B.amt)||0).toFixed(2)+"",D,k,p,M,K,Y=(((R=n[26])==null?void 0:R.cat)||"")+"",V,H,N,$;function Q(){return n[17](n[28])}return{c(){l=r("ion-item"),e=r("ion-reorder"),s=y(),d=r("div"),i=F(a),g=r("br"),f=y(),u=r("span"),o=F(b),E=F("\xA0"),U=y(),S=r("ion-note"),h=r("div"),D=F(m),k=r("br"),p=y(),M=r("span"),K=F("\xA0"),V=F(Y),H=y(),c(e,"slot","start"),me(u,"class","description svelte-wghhpk"),me(M,"class","description svelte-wghhpk"),c(S,"slot","end"),c(S,"class","right svelte-wghhpk")},m(I,G){C(I,l,G),t(l,e),t(l,s),t(l,d),t(d,i),t(d,g),t(d,f),t(d,u),t(u,o),t(u,E),t(l,U),t(l,S),t(S,h),t(h,D),t(h,k),t(h,p),t(h,M),t(M,K),t(M,V),t(l,H),N||($=P(l,"click",Q),N=!0)},p(I,G){var oe,X,x,le;n=I,G&8&&a!==(a=((oe=n[26])==null?void 0:oe.title)+"")&&j(i,a),G&8&&b!==(b=(((X=n[26])==null?void 0:X.desc)||"")+"")&&j(o,b),G&8&&m!==(m=(((x=n[26])==null?void 0:x.amt)||0).toFixed(2)+"")&&j(D,m),G&8&&Y!==(Y=(((le=n[26])==null?void 0:le.cat)||"")+"")&&j(V,Y)},d(I){I&&O(l),N=!1,$()}}}function ht(n){let l,e,s,d,a,i,g,f,u,b,o,E,U,S,h=n[2]==="view"&&He(n),m=n[2]==="edit"&&Re(n),D=n[3]&&Ye(n);return{c(){l=r("ion-header"),e=r("ion-toolbar"),s=r("ion-buttons"),d=r("ion-button"),a=r("ion-icon"),i=y(),g=r("ion-title"),g.textContent="Day",f=y(),u=r("ion-buttons"),h&&h.c(),b=y(),m&&m.c(),o=y(),E=r("ion-content"),D&&D.c(),c(a,"slot","icon-only"),c(a,"icon",ft),c(s,"slot","start"),c(u,"slot","end"),c(l,"translucent","true"),c(E,"class","ion-padding")},m(k,p){C(k,l,p),t(l,e),t(e,s),t(s,d),t(d,a),t(e,i),t(e,g),t(e,f),t(e,u),h&&h.m(u,null),t(u,b),m&&m.m(u,null),C(k,o,p),C(k,E,p),D&&D.m(E,null),U||(S=P(d,"click",n[13]),U=!0)},p(k,[p]){k[2]==="view"?h?h.p(k,p):(h=He(k),h.c(),h.m(u,b)):h&&(h.d(1),h=null),k[2]==="edit"?m?m.p(k,p):(m=Re(k),m.c(),m.m(u,null)):m&&(m.d(1),m=null),k[3]?D?D.p(k,p):(D=Ye(k),D.c(),D.m(E,null)):D&&(D.d(1),D=null)},i:de,o:de,d(k){k&&O(l),h&&h.d(),m&&m.d(),k&&O(o),k&&O(E),D&&D.d(),U=!1,S()}}}function kt(n,l,e){let s,d;Ne(n,it,_=>e(21,s=_)),Ne(n,nt,_=>e(22,d=_));const a=mt.getInstance();bt.getInstance();let i=null,g,f={daily_budget:0,target_weight:0},u=d.id,b="view",o={};console.log("*** id",u);let E;u==="new"?(console.log("it is new"),o={id:a.gen_random_uuid(),user_id:(i==null?void 0:i.id)||null,created_at:new Date().toISOString(),date:new Date().toISOString().substring(0,10),food_log:{entries:[]},food_total:0,activity_log:{entries:[]},water_log:{entries:[]},water_total:0,weight:0,notes:""},b="edit",console.log("*** new day",o)):E=a.getDataSubscription("day",{id:u}).subscribe(_=>{e(3,o=_),console.log("*** day",o)}),ot(async()=>{const{data:_,error:v}=await a.getSettings();console.log("*** settings",_,v),e(0,f=_.settings||{}),g=wt.user.subscribe(B=>{i=B})}),lt(()=>{try{E.unsubscribe(),g.unsubscribe()}catch(_){console.error("error unsubscribing",_)}});const U=_=>{if(typeof o[_.target.name]=="number")try{e(3,o[_.target.name]=parseFloat(_.target.value),o)}catch{e(3,o[_.target.name]=0,o)}else e(3,o[_.target.name]=_.target.value,o)},S=async()=>{console.log("save the day",o),console.log("id is currently",u);let _=!1;u==="new"&&(_=!0),o.user_id||e(3,o.user_id=i.id,o);try{e(3,o.food_total=0,o),o.food_log.entries.forEach(B=>{e(3,o.food_total+=B.amt,o)})}catch(B){console.error("error calculating food total",B)}const{error:v}=await a.save_day(o);v?(console.log("error message is: ",v.message),v.message.startsWith("duplicate key value violates unique constraint")?(console.log("DUPLICATE DAY"),gt({header:"Duplicate Day",message:"This day already exists.  Please edit the existing day."})):console.error("save day error",v)):(e(1,u=o.id),e(2,b="view")),_&&(console.log("*** day is new, redirect to","/day/"+o.id),s("/day/"+o.id))},h=async()=>{await pt({header:"Delete Day",message:"Are you sure?",okHander:async()=>{const{data:_,error:v}=await a.delete_day(o);v?console.error("Error deleting day",v):m()}})},m=()=>{s("/calendar")},D=async _=>{o.food_log.entries||e(3,o.food_log.entries=[],o);const v={id:a.gen_random_uuid(),food_id:"",title:"",desc:"",cat:"",cps:0,qty:1,amt:0,created:new Date().toISOString()},B=await M(v,o.food_log.entries.length,!0);console.log("done calling openFoodEntryBox",B),console.log("day.food_log.entries",o.food_log.entries),e(3,o.food_log.entries=[...o.food_log.entries],o),S()},k=async _=>{const v=await M(o.food_log.entries[_],_,!1);console.log("edit_food_log_entry is done calling openFoodEntryBox",v),console.log("day.food_log.entries",o.food_log.entries),e(3,o.food_log.entries=[...o.food_log.entries],o),S()},p=({detail:_})=>{const{from:v,to:B}=_,R=o.food_log.entries.splice(v,1)[0];o.food_log.entries.splice(B,0,R),_.complete(),console.log("reorder_food_log: day",o),S()},M=async(_,v,B)=>{const R=await st.create({component:ut,componentProps:{entry:_,isNew:B},showBackdrop:!0,backdropDismiss:!0});await R.present();const{data:I}=await R.onWillDismiss();return(I==null?void 0:I.data)!==null?(I.data.deleted?o.food_log.entries.splice(v,1):e(3,o.food_log.entries[v]=I.data,o),console.log("*** day.food_log.entries",o.food_log.entries),!0):!1};async function K(){o.water_log.entries.push({id:a.gen_random_uuid(),amt:1,created:new Date().toISOString()}),e(3,o.water_total++,o),S()}async function Y(){o.water_total<=0||(o.water_log.entries.pop(),e(3,o.water_total--,o),S())}return[f,u,b,o,U,S,h,m,D,k,p,K,Y,()=>{m()},()=>{e(2,b="edit")},()=>{e(2,b="view"),u==="add"&&m()},()=>{S()},_=>{k(_)}]}class Lt extends Ze{constructor(l){super(),$e(this,l,kt,ht,xe,{})}}export{Lt as default};
