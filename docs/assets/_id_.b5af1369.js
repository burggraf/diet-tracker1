import{S as Te,i as Me,s as Pe,e as d,a as D,b as u,d as q,f as t,l as R,n as te,h as C,r as ie,t as F,c as ve,z as H,x as ze,j as we,w as Ne,B as De,y as Ue,D as We}from"./index.00450e9e.js";import{g as je,p as He}from"./index.f502aa51.js";import{m as Re}from"./controllers.edeb5e7f.js";import{x as Ye,B as Ge,o as Je,A as Ke,C as Qe,D as Ve}from"./index.b561a64b.js";import Xe from"./FoodEntryModal.193a722f.js";import{a as Ze,s as xe}from"./alert.046307a8.js";import{S as $e}from"./supabase.data.service.09fcdf72.js";import{S as et}from"./supabase.auth.service.c16da4ce.js";import"./overlays-ab6211c7.c2d6fb0a.js";import"./FoodSearchModal.224b8df7.js";import"./BehaviorSubject.f6ee691a.js";import"./network.service.1aac107c.js";function Se(i,o,e){const s=i.slice();return s[23]=o[e],s[25]=e,s}function qe(i){let o,e,s,r,a,l,p;return{c(){o=d("ion-button"),e=d("ion-icon"),s=D(),r=d("ion-button"),a=d("ion-icon"),u(e,"slot","icon-only"),u(e,"icon",Ye),u(a,"slot","icon-only"),u(a,"icon",Ge)},m(_,f){q(_,o,f),t(o,e),q(_,s,f),q(_,r,f),t(r,a),l||(p=[R(o,"click",i[6]),R(r,"click",i[12])],l=!0)},p:te,d(_){_&&C(o),_&&C(s),_&&C(r),l=!1,ie(p)}}}function Ce(i){let o,e,s,r,a,l,p;return{c(){o=d("ion-button"),e=d("ion-icon"),s=D(),r=d("ion-button"),a=d("ion-icon"),u(e,"slot","icon-only"),u(e,"icon",Je),u(a,"slot","icon-only"),u(a,"icon",Ke)},m(_,f){q(_,o,f),t(o,e),q(_,s,f),q(_,r,f),t(r,a),l||(p=[R(o,"click",i[13]),R(r,"click",i[14])],l=!0)},p:te,d(_){_&&C(o),_&&C(s),_&&C(r),l=!1,ie(p)}}}function Fe(i){var de,ce,_e,fe,ue,ge;let o,e,s,r,a,l,p,_=(((de=i[3])==null?void 0:de.food_total)||0).toFixed(2)+"",f,b,n,B,M=(i[0].daily_budget-((ce=i[3])==null?void 0:ce.food_total)||0).toFixed(2)+"",S,y,m,v,h,g,P,K,G,Q,W,z,c,k,O,j,N,Z,J,Y,x,V=new Date((_e=i[3])==null?void 0:_e.created_at).toLocaleDateString()+"",X,$,ee=new Date((fe=i[3])==null?void 0:fe.created_at).toLocaleTimeString()+"",oe,ne,se,re,le,ae,E=i[2]==="view"&&Be(i),I=i[2]==="edit"&&Oe(i),L=i[2]==="view"&&Ee(i),A=i[2]==="edit"&&Ie(i),T=((ge=(ue=i[3])==null?void 0:ue.food_log)==null?void 0:ge.entries)&&Le(i);return{c(){o=d("ion-card"),e=d("ion-card-header"),s=d("ion-card-subtitle"),r=d("ion-grid"),a=d("ion-row"),l=d("ion-col"),p=F("Total: "),f=F(_),b=D(),n=d("ion-col"),B=F("Left: "),S=F(M),y=D(),m=d("ion-card-title"),E&&E.c(),v=D(),I&&I.c(),h=D(),g=d("ion-card-content"),L&&L.c(),P=D(),A&&A.c(),K=D(),G=d("br"),Q=D(),W=d("ion-list"),z=d("ion-reorder-group"),T&&T.c(),c=D(),k=d("ion-item"),O=d("ion-icon"),j=F(`
						add new entry`),N=D(),Z=d("br"),J=D(),Y=d("br"),x=F(`
				created: `),X=F(V),$=D(),oe=F(ee),ne=d("br"),se=D(),re=d("br"),ve(n,"text-align","right"),ve(n,"font-weight","bold"),u(z,"id","food_log_group"),u(z,"disabled","false"),u(O,"icon",Qe),u(O,"slot","start"),u(W,"lines","full")},m(w,U){q(w,o,U),t(o,e),t(e,s),t(s,r),t(r,a),t(a,l),t(l,p),t(l,f),t(a,b),t(a,n),t(n,B),t(n,S),t(e,y),t(e,m),E&&E.m(m,null),t(m,v),I&&I.m(m,null),t(o,h),t(o,g),L&&L.m(g,null),t(g,P),A&&A.m(g,null),t(g,K),t(g,G),t(g,Q),t(g,W),t(W,z),T&&T.m(z,null),t(W,c),t(W,k),t(k,O),t(k,j),t(g,N),t(g,Z),t(g,J),t(g,Y),t(g,x),t(g,X),t(g,$),t(g,oe),t(g,ne),t(g,se),t(g,re),le||(ae=[R(z,"ionItemReorder",i[10]),R(k,"click",i[8])],le=!0)},p(w,U){var pe,me,be,ye,he,ke;U&8&&_!==(_=(((pe=w[3])==null?void 0:pe.food_total)||0).toFixed(2)+"")&&H(f,_),U&9&&M!==(M=(w[0].daily_budget-((me=w[3])==null?void 0:me.food_total)||0).toFixed(2)+"")&&H(S,M),w[2]==="view"?E?E.p(w,U):(E=Be(w),E.c(),E.m(m,v)):E&&(E.d(1),E=null),w[2]==="edit"?I?I.p(w,U):(I=Oe(w),I.c(),I.m(m,null)):I&&(I.d(1),I=null),w[2]==="view"?L?L.p(w,U):(L=Ee(w),L.c(),L.m(g,P)):L&&(L.d(1),L=null),w[2]==="edit"?A?A.p(w,U):(A=Ie(w),A.c(),A.m(g,K)):A&&(A.d(1),A=null),(ye=(be=w[3])==null?void 0:be.food_log)!=null&&ye.entries?T?T.p(w,U):(T=Le(w),T.c(),T.m(z,null)):T&&(T.d(1),T=null),U&8&&V!==(V=new Date((he=w[3])==null?void 0:he.created_at).toLocaleDateString()+"")&&H(X,V),U&8&&ee!==(ee=new Date((ke=w[3])==null?void 0:ke.created_at).toLocaleTimeString()+"")&&H(oe,ee)},d(w){w&&C(o),E&&E.d(),I&&I.d(),L&&L.d(),A&&A.d(),T&&T.d(),le=!1,ie(ae)}}}function Be(i){var s;let o=((s=i[3])==null?void 0:s.date)+"",e;return{c(){e=F(o)},m(r,a){q(r,e,a)},p(r,a){var l;a&8&&o!==(o=((l=r[3])==null?void 0:l.date)+"")&&H(e,o)},d(r){r&&C(e)}}}function Oe(i){let o,e,s,r,a;return{c(){o=d("ion-label"),o.textContent="Date:",e=d("ion-input"),u(o,"class","svelte-8l8qbx"),u(e,"value",s=i[3].date),u(e,"required",""),u(e,"name","date"),u(e,"type","text"),u(e,"class","svelte-8l8qbx")},m(l,p){q(l,o,p),q(l,e,p),r||(a=R(e,"ionChange",i[4]),r=!0)},p(l,p){p&8&&s!==(s=l[3].date)&&u(e,"value",s)},d(l){l&&C(o),l&&C(e),r=!1,a()}}}function Ee(i){var s;let o=((s=i[3])==null?void 0:s.notes)+"",e;return{c(){e=F(o)},m(r,a){q(r,e,a)},p(r,a){var l;a&8&&o!==(o=((l=r[3])==null?void 0:l.notes)+"")&&H(e,o)},d(r){r&&C(e)}}}function Ie(i){let o,e,s,r,a;return{c(){o=d("ion-label"),o.textContent="Notes:",e=d("ion-input"),u(o,"class","svelte-8l8qbx"),u(e,"value",s=i[3].notes),u(e,"required",""),u(e,"name","notes"),u(e,"type","text"),u(e,"class","svelte-8l8qbx")},m(l,p){q(l,o,p),q(l,e,p),r||(a=R(e,"ionChange",i[4]),r=!0)},p(l,p){p&8&&s!==(s=l[3].notes)&&u(e,"value",s)},d(l){l&&C(o),l&&C(e),r=!1,a()}}}function Le(i){var r,a;let o,e=(a=(r=i[3])==null?void 0:r.food_log)==null?void 0:a.entries,s=[];for(let l=0;l<e.length;l+=1)s[l]=Ae(Se(i,e,l));return{c(){for(let l=0;l<s.length;l+=1)s[l].c();o=ze()},m(l,p){for(let _=0;_<s.length;_+=1)s[_].m(l,p);q(l,o,p)},p(l,p){var _,f;if(p&520){e=(f=(_=l[3])==null?void 0:_.food_log)==null?void 0:f.entries;let b;for(b=0;b<e.length;b+=1){const n=Se(l,e,b);s[b]?s[b].p(n,p):(s[b]=Ae(n),s[b].c(),s[b].m(o.parentNode,o))}for(;b<s.length;b+=1)s[b].d(1);s.length=e.length}},d(l){Ne(s,l),l&&C(o)}}}function Ae(i){var O,j,N,Z;let o,e,s,r,a=((O=i[23])==null?void 0:O.title)+"",l,p,_,f,b=(((j=i[23])==null?void 0:j.desc)||"")+"",n,B,M,S,y,m=(((N=i[23])==null?void 0:N.amt)||0).toFixed(2)+"",v,h,g,P,K,G=(((Z=i[23])==null?void 0:Z.cat)||"")+"",Q,W,z,c;function k(){return i[15](i[25])}return{c(){o=d("ion-item"),e=d("ion-reorder"),s=D(),r=d("div"),l=F(a),p=d("br"),_=D(),f=d("span"),n=F(b),B=F("\xA0"),M=D(),S=d("ion-note"),y=d("div"),v=F(m),h=d("br"),g=D(),P=d("span"),K=F("\xA0"),Q=F(G),W=D(),u(e,"slot","start"),we(f,"class","description svelte-8l8qbx"),we(P,"class","description svelte-8l8qbx"),u(S,"slot","end"),u(S,"class","right svelte-8l8qbx")},m(J,Y){q(J,o,Y),t(o,e),t(o,s),t(o,r),t(r,l),t(r,p),t(r,_),t(r,f),t(f,n),t(f,B),t(o,M),t(o,S),t(S,y),t(y,v),t(y,h),t(y,g),t(y,P),t(P,K),t(P,Q),t(o,W),z||(c=R(o,"click",k),z=!0)},p(J,Y){var x,V,X,$;i=J,Y&8&&a!==(a=((x=i[23])==null?void 0:x.title)+"")&&H(l,a),Y&8&&b!==(b=(((V=i[23])==null?void 0:V.desc)||"")+"")&&H(n,b),Y&8&&m!==(m=(((X=i[23])==null?void 0:X.amt)||0).toFixed(2)+"")&&H(v,m),Y&8&&G!==(G=((($=i[23])==null?void 0:$.cat)||"")+"")&&H(Q,G)},d(J){J&&C(o),z=!1,c()}}}function tt(i){let o,e,s,r,a,l,p,_,f,b,n,B,M,S,y=i[2]==="view"&&qe(i),m=i[2]==="edit"&&Ce(i),v=i[3]&&Fe(i);return{c(){o=d("ion-header"),e=d("ion-toolbar"),s=d("ion-buttons"),r=d("ion-button"),a=d("ion-icon"),l=D(),p=d("ion-title"),p.textContent="Day",_=D(),f=d("ion-buttons"),y&&y.c(),b=D(),m&&m.c(),n=D(),B=d("ion-content"),v&&v.c(),u(a,"slot","icon-only"),u(a,"icon",Ve),u(s,"slot","start"),u(f,"slot","end"),u(o,"translucent","true"),u(B,"class","ion-padding")},m(h,g){q(h,o,g),t(o,e),t(e,s),t(s,r),t(r,a),t(e,l),t(e,p),t(e,_),t(e,f),y&&y.m(f,null),t(f,b),m&&m.m(f,null),q(h,n,g),q(h,B,g),v&&v.m(B,null),M||(S=R(r,"click",i[11]),M=!0)},p(h,[g]){h[2]==="view"?y?y.p(h,g):(y=qe(h),y.c(),y.m(f,b)):y&&(y.d(1),y=null),h[2]==="edit"?m?m.p(h,g):(m=Ce(h),m.c(),m.m(f,null)):m&&(m.d(1),m=null),h[3]?v?v.p(h,g):(v=Fe(h),v.c(),v.m(B,null)):v&&(v.d(1),v=null)},i:te,o:te,d(h){h&&C(o),y&&y.d(),m&&m.d(),h&&C(n),h&&C(B),v&&v.d(),M=!1,S()}}}function ot(i,o,e){let s,r;De(i,je,c=>e(19,s=c)),De(i,He,c=>e(20,r=c));const a=$e.getInstance();let l=null,p,_={daily_budget:0,target_weight:0},f=r.id,b="view",n={};console.log("*** id",f);let B;f==="new"?(console.log("it is new"),n={id:a.gen_random_uuid(),user_id:(l==null?void 0:l.id)||null,created_at:new Date().toISOString(),date:new Date().toISOString().substring(0,10),food_log:{entries:[]},activity_log:{entries:[]},water_log:{entries:[]},weight:0,notes:""},b="edit",console.log("*** new day",n)):B=a.getDataSubscription("day",{id:f}).subscribe(c=>{e(3,n=c),console.log("*** day",n)}),Ue(async()=>{const{data:c,error:k}=await a.getSettings();console.log("*** settings",c,k),e(0,_=c.settings||{}),p=et.user.subscribe(O=>{l=O})}),We(()=>{try{B.unsubscribe(),p.unsubscribe()}catch(c){console.error("error unsubscribing",c)}});const M=c=>{if(typeof n[c.target.name]=="number")try{e(3,n[c.target.name]=parseFloat(c.target.value),n)}catch{e(3,n[c.target.name]=0,n)}else e(3,n[c.target.name]=c.target.value,n)},S=async()=>{console.log("save the day",n),n.user_id||e(3,n.user_id=l.id,n);try{e(3,n.food_total=0,n),n.food_log.entries.forEach(k=>{e(3,n.food_total+=k.amt,n)})}catch(k){console.error("error calculating food total",k)}const{error:c}=await a.save_day(n);c?(console.log("error message is: ",c.message),c.message.startsWith("duplicate key value violates unique constraint")?(console.log("DUPLICATE DAY"),Ze({header:"Duplicate Day",message:"This day already exists.  Please edit the existing day."})):console.error("save day error",c)):(e(1,f=n.id),e(2,b="view"))},y=async()=>{await xe({header:"Delete Day",message:"Are you sure?",okHander:async()=>{const{data:c,error:k}=await a.delete_day(n);k?console.error("Error deleting day",k):m()}})},m=()=>{s("/days")},v=async c=>{n.food_log.entries||e(3,n.food_log.entries=[],n);const k={id:a.gen_random_uuid(),food_id:"",title:"",desc:"",cat:"",cps:0,qty:1,amt:0,created:new Date().toISOString()},O=await P(k,n.food_log.entries.length,!0);console.log("done calling openFoodEntryBox",O),console.log("day.food_log.entries",n.food_log.entries),e(3,n.food_log.entries=[...n.food_log.entries],n),S()},h=async c=>{const k=await P(n.food_log.entries[c],c,!1);console.log("edit_food_log_entry is done calling openFoodEntryBox",k),console.log("day.food_log.entries",n.food_log.entries),e(3,n.food_log.entries=[...n.food_log.entries],n),S()},g=({detail:c})=>{const{from:k,to:O}=c,j=n.food_log.entries.splice(k,1)[0];n.food_log.entries.splice(O,0,j),c.complete(),console.log("reorder_food_log: day",n),S()},P=async(c,k,O)=>{const j=await Re.create({component:Xe,componentProps:{entry:c,isNew:O},showBackdrop:!0,backdropDismiss:!0});await j.present();const{data:N}=await j.onWillDismiss();return(N==null?void 0:N.data)!==null?(N.data.deleted?n.food_log.entries.splice(k,1):e(3,n.food_log.entries[k]=N.data,n),console.log("*** day.food_log.entries",n.food_log.entries),!0):!1};return[_,f,b,n,M,S,y,m,v,h,g,()=>{m()},()=>{e(2,b="edit")},()=>{e(2,b="view"),f==="add"&&m()},()=>{S()},c=>{h(c)}]}class pt extends Te{constructor(o){super(),Me(this,o,ot,tt,Pe,{})}}export{pt as default};
